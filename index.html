<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PomodoroCycle Timer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@700&display=swap" rel="stylesheet">
    <link id="favicon" rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text x="50" y="50" font-size="90" dominant-baseline="middle" text-anchor="middle">üçÖ</text></svg>'>
    <style>
        body { font-family: 'Inter', sans-serif; transition: background-color 0.5s ease; overflow-y: scroll; }
        .timer-text { font-family: 'Roboto Mono', monospace; font-size: 5rem; line-height: 1; letter-spacing: -0.05em; font-weight: 700; }
        @media (min-width: 640px) { .timer-text { font-size: 6rem; } }
        .tab-button { position: relative; border-bottom: 4px solid transparent; min-height: 54px; display: flex; align-items: center; justify-content: center; }
        .tab-button.active { border-bottom-color: #38bdf8; }
        #tabContent { height: 21rem; overflow: hidden; transition: height 0.35s ease-in-out; }
        .tab-pane { display: flex; flex-direction: column; width: 100%; height: 100%; }
        #tabContent.collapsed { height: 0; }
        #achievementsListContainer { max-height: 17rem; overflow-y: auto; padding-right: 0.5rem; }
        #achievementsContent { padding-bottom: 1rem; }
        .achievement-item { display: flex; flex-direction: column; justify-content: space-between; overflow: hidden; position: relative; min-height: 7rem; }
        .progress-bar-container { width: 100%; background-color: #334155; height: 6px; border-radius: 3px; overflow: hidden; }
        .progress-bar { height: 100%; transition: width 0.4s ease-in-out; border-radius: 3px; }
        .modal { display: none; }
        .modal.show { display: flex; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #475569; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #cbd5e1; }
        @keyframes gradient-flow { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        #goalProgressBar { background: linear-gradient(90deg, #06b6d4, #38bdf8, #06b6d4); background-size: 200% 200%; animation: gradient-flow 3s ease infinite; transition: width 0.5s cubic-bezier(0.25, 1, 0.5, 1); }
        #goalProgressBar.completed { box-shadow: 0 0 15px #38bdf8, 0 0 5px #06b6d4; }
        .help-content ul { list-style-type: none; padding-left: 0; margin-bottom: 10px; }
        .help-content li { margin-bottom: 5px; }
        .help-content li.break-session { color: #a0aec0; }
        #toastNotification { position: fixed; top: 20px; right: 20px; padding: 1rem; border-radius: 0.5rem; color: white; font-size: 0.875rem; z-index: 1000; opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; max-width: 300px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transform: translateX(100%); }
        #toastNotification.show { opacity: 1; transform: translateX(0); }
        #toastNotification.success { background-color: #34d399; }
        #toastNotification.error { background-color: #ef4444; }
        #toastNotification.info { background-color: #3b82f6; }
        #toastNotification.warning { background-color: #f59e0b; }
        .tab-badge { position: absolute; top: 0.2rem; right: 0.2rem; height: 0.65rem; width: 0.65rem; background-color: #ef4444; border-radius: 9999px; display: none; }
        .new-indicator { font-size: 0.65rem; padding: 0.1rem 0.3rem; border-radius: 0.25rem; line-height: 1; }
        .cycle-dot { width: 0.75rem; height: 0.75rem; border-radius: 9999px; transition: all 0.3s ease; }
        @media (max-width: 639px) {
            #tabContent { height: 20rem; }
            .tab-button { flex-direction: column; padding-top: 0.5rem; padding-bottom: 0.5rem; font-size: 0.75rem; line-height: 1.2; min-height: 58px; }
            .tab-button i { margin-right: 0; margin-bottom: 0.25rem; font-size: 1rem; }
            .stats-grid-container { gap: 0.75rem; }
            #statsContent h4 { font-size: 1rem; }
            .stats-text-size { font-size: 0.875rem; }
            .space-y-3 { --tw-space-y-reverse: 0; margin-top: calc(0.5rem * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(0.5rem * var(--tw-space-y-reverse)); }
            .space-y-3 > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(0.5rem * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(0.5rem * var(--tw-space-y-reverse)); }
            .stats-bottom-warning { padding-bottom: 0.5rem; }
        }
        .donation-section { text-align: center; font-size: 0.75em; color: #5a687d; margin-top: 20px; max-width: 320px; opacity: 0.75; line-height: 1.4; }
        .donation-section a { color: #5a687d; text-decoration: none; white-space: nowrap; transition: color 0.3s ease; }
        .donation-section a:hover { color: #FFDD00; }
        #goalProgressText { font-family: 'Inter', sans-serif; }
        #statsContent { overflow-y: auto; overflow-x: hidden; }
        #goalEditView { overflow-y: auto; padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .goal-mode-selector{display:flex;border-radius:.5rem;border:1px solid #475569;overflow:hidden;margin-bottom:1.5rem}.goal-mode-selector label{flex:1;padding:.5rem .25rem;text-align:center;cursor:pointer;transition:background-color .2s ease-in-out;font-size:.8rem;color:#cbd5e1;position:relative}.goal-mode-selector input[type=radio]{display:none}.goal-mode-selector input[type=radio]:checked+label{background-color:#38bdf8;color:#fff;font-weight:600}.goal-mode-selector label:not(:last-child){border-right:1px solid #475569}.custom-day-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(60px,1fr));gap:.75rem}.custom-day-input-group{text-align:center}.custom-day-input-group label{font-size:.75rem;color:#94a3b8}
    </style>
</head>
<body class="bg-slate-900 text-white flex flex-col items-center min-h-screen p-4 selection:bg-sky-400 selection:text-sky-900">

    <div id="languageModal" class="modal fixed inset-0 bg-slate-900 bg-opacity-95 items-center justify-center p-4 z-[200]">
        <div class="bg-slate-800 p-8 rounded-2xl shadow-2xl w-full max-w-lg text-center">
            <h2 class="text-2xl font-bold mb-2 text-sky-300">Select Your Language</h2>
            <p class="text-slate-400 mb-6">Choose your preferred language to continue.</p>
            <div id="languageButtonsContainer" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
            </div>
            <p class="text-xs text-slate-500 mt-6"><i class="fas fa-info-circle fa-fw mr-1.5 opacity-70"></i>You can change this choice later in the settings.</p>
        </div>
    </div>

    <div id="app-container" class="w-full hidden">
        <div class="w-full max-w-3xl mx-auto bg-slate-800 shadow-2xl rounded-lg p-4 sm:p-6 relative mt-4 mb-4">
            <div class="absolute top-4 sm:top-6 left-4 sm:left-6 z-10">
                <button id="helpButton" data-translate-key="help_tooltip" title="Help / How to Use" class="p-2 rounded-full text-sky-400 hover:bg-slate-700 hover:text-sky-300 transition-colors focus:outline-none">
                    <i class="fas fa-question-circle text-xl"></i>
                </button>
            </div>
            <div class="absolute top-4 sm:top-6 right-4 sm:right-6 z-10">
                <button id="settingsButton" data-translate-key="settings_tooltip" title="Settings" class="p-2 rounded-full hover:bg-slate-700 transition-colors focus:outline-none">
                    <i class="fas fa-cog text-xl text-sky-400 hover:text-sky-300"></i>
                </button>
            </div>

            <div id="timerDisplay" class="relative text-center mb-6 pt-8 md:pt-4 pb-4 rounded-lg bg-slate-700 shadow-inner">
                <div id="modeIndicator" class="h-8 flex items-center justify-center mb-2 text-slate-300 font-medium">
                    <span data-translate-key="current_timer_label">Current Timer:</span>&nbsp;
                    <span id="modePill" class="py-1 px-3 rounded-full text-sm font-semibold transition-all duration-500" data-translate-key="mode_study">Focus</span>
                </div>
                <p id="timerText" class="timer-text text-sky-400 transition-colors duration-500">25:00</p>
                <div class="flex justify-center items-center mt-4 h-8">
                    <div id="cycleDotsContainer" data-translate-key="cycle_tooltip" title="Focus Sessions in Current Cycle" class="flex items-center justify-center space-x-2.5">
                        <div class="cycle-dot"></div>
                        <div class="cycle-dot"></div>
                        <div class="cycle-dot"></div>
                        <div class="cycle-dot"></div>
                    </div>
                    <button id="resetCycleCountButton" data-translate-key="reset_cycle_tooltip" title="Reset Cycle" class="ml-3 text-slate-500 hover:text-sky-400 transition-colors focus:outline-none focus:ring-0 text-[11px]">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <button id="skipBreakButton" class="absolute bottom-3 right-3 hidden bg-slate-600 hover:bg-slate-500 text-slate-300 text-xs py-1.5 px-3 rounded-md shadow-md transition-colors">
                    <i class="fas fa-forward fa-xs mr-1"></i><span data-translate-key="skip_break_button">Skip Break</span>
                </button>
            </div>

            <div class="flex justify-center items-center space-x-4 mb-8">
                <button id="startPauseButton" class="bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-transform transform hover:scale-105">
                    <i class="fas fa-play mr-2"></i><span data-translate-key="start_button">Start</span>
                </button>
                <button id="resetButton" class="bg-slate-600 hover:bg-slate-500 text-slate-300 py-2 px-4 rounded-lg shadow-md transition-colors text-xs">
                    <i class="fas fa-undo fa-sm mr-1"></i><span data-translate-key="reset_current_button">Reset Current</span>
                </button>
            </div>

            <div class="mb-6 border-b border-slate-700">
                <nav class="flex space-x-1 -mb-px">
                    <button data-tab="stats" class="tab-button active text-sky-400 py-3 px-3 md:px-4 text-sm md:text-base font-medium text-center hover:text-sky-300 transition-colors">
                        <i class="fas fa-chart-line mr-2"></i><span data-translate-key="tab_stats">Statistics</span>
                    </button>
                    <button data-tab="dailyGoal" class="tab-button text-slate-400 py-3 px-3 md:px-4 text-sm md:text-base font-medium text-center hover:text-sky-300 transition-colors">
                        <i class="fas fa-bullseye mr-2"></i><span data-translate-key="tab_daily_goal">Daily Goal</span> <span id="rewardsTabBadge" class="tab-badge"></span>
                    </button>
                    <button data-tab="achievements" class="tab-button text-slate-400 py-3 px-3 md:px-4 text-sm md:text-base font-medium text-center hover:text-sky-300 transition-colors">
                        <i class="fas fa-trophy mr-2"></i><span data-translate-key="tab_achievements">Achievements</span> <span id="achievementsTabBadge" class="tab-badge"></span>
                    </button>
                    <div class="flex-grow"></div>
                    <button id="collapseTabsButton" title="Collapse/Expand Tabs" class="py-3 px-3 md:px-4 text-slate-400 hover:text-sky-300 transition-colors">
                        <i id="collapseIcon" class="fas fa-chevron-up"></i>
                    </button>
                </nav>
            </div>

            <div id="tabContent">
                <div id="statsContent" class="tab-pane active p-2 sm:p-4 bg-slate-700 rounded-b-lg justify-center">
                    <div class="w-full flex flex-col h-full">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
                            <h3 class="text-base sm:text-lg font-semibold text-sky-300 mb-2 sm:mb-0" data-translate-key="stats_title">Your Statistics</h3>
                            <p id="streakContainerHeader" class="text-sm text-slate-300">
                                <span data-translate-key="stats_streak">Daily Streak</span>: <span id="streakCounterHeader" class="font-semibold">0</span> <span id="streakFireIconContainer"><i class="fas fa-fire"></i></span>
                            </p>
                        </div>
                        <div class="flex-grow flex justify-center items-center">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-2xl mx-auto stats-grid-container">
                                <div class="bg-slate-600 p-5 rounded-lg shadow">
                                    <h4 class="font-bold text-sky-400 mb-3 text-lg flex items-center"><i class="fas fa-globe-americas mr-2 opacity-80"></i><span data-translate-key="stats_general_title">General:</span></h4>
                                    <div class="space-y-3 stats-text-size">
                                        <p><span data-translate-key="stats_general_days">Total Focus Days</span>: <span id="totalDaysStudied" class="font-semibold">0</span></p>
                                        <p><span data-translate-key="stats_general_study_time">Total Focus Time</span>: <span id="totalStudyTime" class="font-semibold">0h 0m</span></p>
                                        <p><span data-translate-key="stats_general_sessions">Total Focus Sessions</span>: <span id="totalFocusSessions" class="font-semibold">0</span></p>
                                        <p><span data-translate-key="stats_general_cycles">Total Cycles Completed</span>: <span id="totalCycles" class="font-semibold">0</span></p>
                                    </div>
                                </div>
                                <div class="bg-slate-600 p-5 rounded-lg shadow">
                                    <h4 class="font-bold text-sky-400 mb-3 text-lg flex items-center"><i class="fas fa-calendar-day mr-2 opacity-80"></i><span data-translate-key="stats_daily_title">Daily:</span></h4>
                                    <div class="space-y-3 stats-text-size">
                                        <p><span data-translate-key="stats_daily_total_time">Total Time Today</span>: <span id="dailyTotalTime" class="font-semibold">0h 0m</span></p>
                                        <p><span data-translate-key="stats_daily_study_time">Focus Time Today</span>: <span id="dailyStudyTime" class="font-semibold">0h 0m</span></p>
                                        <p><span data-translate-key="stats_daily_focus_sessions">Focus Sessions Today</span>: <span id="dailyFocusSessions" class="font-semibold">0</span></p>
                                        <p><span data-translate-key="stats_daily_cycles">Cycles Completed Today</span>: <span id="dailyCycles" class="font-semibold">0</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-auto pt-4 text-center stats-bottom-warning">
                            <p class="text-xs text-slate-400">
                                <i class="fas fa-info-circle mr-1"></i><span data-translate-key="storage_warning">Your progress is saved in your browser's local storage. Clearing browser data may delete your progress.</span>
                            </p>
                        </div>
                    </div>
                </div>
                <div id="dailyGoalContent" class="tab-pane hidden p-2 sm:p-4 bg-slate-700 rounded-b-lg justify-between">
                    <div id="goalDisplayView" class="h-full flex flex-col">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-base sm:text-lg font-semibold text-sky-300" data-translate-key="daily_goal_title">Today's Goal</h3>
                            <button id="editGoalButton" class="text-sm text-sky-400 hover:text-sky-300"><i class="fas fa-edit mr-1"></i> <span data-translate-key="edit_goal_button">Edit Goal</span></button>
                        </div>
                        <div id="goalProgressContainer" class="bg-slate-800/50 p-4 rounded-lg mb-4">
                            <div class="flex items-center justify-between mb-2">
                                <p id="goalText" class="font-semibold text-base leading-tight"></p>
                                <p id="goalProgressText" class="text-sm text-slate-300"></p>
                            </div>
                            <div class="w-full bg-slate-900/70 rounded-full h-3 shadow-inner">
                                <div id="goalProgressBar" class="h-3 rounded-full"></div>
                            </div>
                        </div>
                        <div class="relative flex-grow min-h-0">
                            <canvas id="goalHistoryChart"></canvas>
                        </div>
                    </div>
                    <div id="goalEditView" class="hidden h-full flex flex-col justify-center p-2">
                        <div class="w-full max-w-sm">
                            <h3 class="text-lg font-semibold mb-4 text-sky-300 text-center" data-translate-key="set_goal_title">Set Your Daily Goal</h3>
                            <div id="goalModeSelector" class="goal-mode-selector">
                                <input type="radio" id="goalModeAllDays" name="goalMode" value="all_days" checked>
                                <label for="goalModeAllDays" data-translate-key="goal_mode_all">All Days</label>
                                <input type="radio" id="goalModeWeekend" name="goalMode" value="weekend">
                                <label for="goalModeWeekend" data-translate-key="goal_mode_week_weekend">Week/Weekend</label>
                                <input type="radio" id="goalModeCustom" name="goalMode" value="custom">
                                <label for="goalModeCustom" data-translate-key="goal_mode_custom">Custom Days</label>
                            </div>
                            <div id="goalInputsAllDays" class="space-y-4">
                                <div>
                                    <label for="goalValueInputAll" class="block text-sm font-medium text-slate-300 mb-1" data-translate-key="goal_sessions_per_day">Sessions per day:</label>
                                    <input type="number" id="goalValueInputAll" min="1" class="w-full p-2 rounded bg-slate-600 text-white border border-slate-500 focus:ring-sky-500 focus:border-sky-500">
                                </div>
                            </div>
                            <div id="goalInputsWeekend" class="hidden space-y-4">
                                <div>
                                    <label for="goalValueInputWeekday" class="block text-sm font-medium text-slate-300 mb-1" data-translate-key="goal_sessions_weekdays">Sessions on Weekdays:</label>
                                    <input type="number" id="goalValueInputWeekday" min="1" class="w-full p-2 rounded bg-slate-600 text-white border border-slate-500 focus:ring-sky-500 focus:border-sky-500">
                                </div>
                                <div>
                                    <label for="goalValueInputWeekend" class="block text-sm font-medium text-slate-300 mb-1" data-translate-key="goal_sessions_weekends">Sessions on Weekends:</label>
                                    <input type="number" id="goalValueInputWeekend" min="1" class="w-full p-2 rounded bg-slate-600 text-white border border-slate-500 focus:ring-sky-500 focus:border-sky-500">
                                </div>
                            </div>
                            <div id="goalInputsCustom" class="hidden space-y-4">
                                <div class="custom-day-grid">
                                </div>
                            </div>
                            <div class="flex justify-end space-x-2 pt-6">
                                <button id="cancelGoalButton" class="bg-slate-600 hover:bg-slate-500 text-slate-300 font-bold py-2 px-4 rounded transition-colors" data-translate-key="cancel_button">Cancel</button>
                                <button id="saveGoalButton" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition-colors" data-translate-key="save_goal_button">Save Goal</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="achievementsContent" class="tab-pane hidden p-2 sm:p-4 bg-slate-700 rounded-b-lg">
                    <div class="flex-grow flex flex-col min-h-0">
                        <h3 class="text-base sm:text-lg font-semibold mb-4 text-sky-300" data-translate-key="achievements_title">Your Achievements</h3>
                        <div id="achievementsListContainer">
                            <div id="achievementsList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="donation-section mx-auto">
             <p data-translate-key="donation_text">If you'd like to support this app, you can do so <a href="https://www.buymeacoffee.com/lemonade299792458" target="_blank">here ‚òï</a></p>
        </div>
    </div>

    <div id="settingsModal" class="modal fixed inset-0 bg-black bg-opacity-75 items-center justify-center p-4 z-50 max-h-screen overflow-y-auto md:overflow-y-visible">
        <div class="bg-slate-800 p-6 rounded-2xl shadow-2xl w-full max-w-md my-8">
            <div class="p-4 bg-slate-700 rounded-lg mb-4">
                <h3 class="text-lg font-semibold mb-3 text-sky-400" data-translate-key="settings_section_timer">Timer Durations</h3>
                <div class="space-y-3">
                    <div>
                        <label for="studyTimeInput" class="block text-sm font-medium text-slate-300 mb-1" data-translate-key="settings_study_time">Focus Time (minutes):</label>
                        <input type="number" id="studyTimeInput" min="1" class="w-full p-2 bg-slate-600 border border-slate-500 rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500">
                    </div>
                    <div>
                        <label for="shortBreakTimeInput" class="block text-sm font-medium text-slate-300 mb-1" data-translate-key="settings_short_break">Short Break (minutes):</label>
                        <input type="number" id="shortBreakTimeInput" min="1" class="w-full p-2 bg-slate-600 border border-slate-500 rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500">
                    </div>
                    <div>
                        <label for="longBreakTimeInput" class="block text-sm font-medium text-slate-300 mb-1" data-translate-key="settings_long_break">Long Break (minutes):</label>
                        <input type="number" id="longBreakTimeInput" min="1" class="w-full p-2 bg-slate-600 border border-slate-500 rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500">
                    </div>
                </div>
            </div>
            <div class="p-4 bg-slate-700 rounded-lg mb-4">
                <h3 class="text-lg font-semibold mb-3 text-sky-400" data-translate-key="settings_section_prefs">Preferences</h3>
                <div class="space-y-3">
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-slate-300" data-translate-key="settings_enable_sounds">Enable Sounds:</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="soundToggle" class="sr-only peer">
                            <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-sky-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-sky-500"></div>
                        </label>
                    </div>
                    <div>
                        <label for="languageSelect" class="block text-sm font-medium text-slate-300 mb-1" data-translate-key="settings_language">Language:</label>
                        <select id="languageSelect" class="w-full p-2 bg-slate-600 border border-slate-500 rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500">
                        </select>
                    </div>
                </div>
            </div>
            <div class="p-4 bg-slate-700 rounded-lg">
                <h3 class="text-lg font-semibold mb-2 text-sky-400" data-translate-key="settings_data_management">Data Management</h3>
                <p class="text-xs text-slate-400 mb-3" data-translate-key="settings_data_info">Save your progress to a file or load it on another device.</p>
                <div class="flex flex-col sm:flex-row gap-3">
                    <button id="exportDataButton" class="flex-1 px-4 py-2 text-sm font-medium text-white bg-slate-600 hover:bg-slate-500 rounded-md transition-colors flex items-center justify-center gap-2">
                        <i class="fas fa-download"></i><span data-translate-key="settings_export_button">Export Data</span>
                    </button>
                    <button id="importDataButton" class="flex-1 px-4 py-2 text-sm font-medium text-white bg-slate-600 hover:bg-slate-500 rounded-md transition-colors flex items-center justify-center gap-2">
                        <i class="fas fa-upload"></i><span data-translate-key="settings_import_button">Import Data</span>
                    </button>
                    <input type="file" id="importFileInput" class="hidden" accept=".json">
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button id="cancelSettingsButton" class="px-4 py-2 text-sm font-medium text-slate-300 bg-slate-600 hover:bg-slate-500 rounded-md transition-colors" data-translate-key="cancel_button">Cancel</button>
                <button id="saveSettingsButton" class="px-4 py-2 text-sm font-medium text-white bg-sky-500 hover:bg-sky-600 rounded-md transition-colors" data-translate-key="save_button">Save Settings</button>
            </div>
        </div>
    </div>
    <div id="customAlertModal" class="modal fixed inset-0 bg-black bg-opacity-75 items-center justify-center p-4 z-[100]">
        <div id="customAlertContent" class="bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-md text-left">
            <div class="flex items-start">
                <div id="customAlertIcon" class="text-3xl mr-4 mt-1"></div>
                <div>
                    <h3 id="customAlertTitle" class="text-xl font-bold mb-2"></h3>
                    <div id="customAlertMessage" class="text-slate-300 mb-6 help-content text-sm"></div>
                </div>
            </div>
            <div id="customAlertButtons" class="flex justify-end space-x-3">
                <button id="customAlertCancelButton" class="px-4 py-2 text-sm font-medium text-slate-300 bg-slate-600 hover:bg-slate-500 rounded-md transition-colors">Cancel</button>
                <button id="customAlertConfirmButton" class="px-4 py-2 text-sm font-medium text-white bg-sky-500 hover:bg-sky-600 rounded-md transition-colors">OK</button>
            </div>
        </div>
    </div>
    <div id="toastNotification">
        <strong id="toastTitle" class="font-bold"></strong>
        <p id="toastBody"></p>
    </div>

    <script id="timerWorkerScript" type="javascript/worker">
        let workerTimeLeft;let workerIsRunning=!1;let workerTimerInterval;let workerCurrentMode;let workerSettings={};function startWorkerTimer(){if(workerIsRunning)return;if(workerTimeLeft<=0){postMessage({type:"end",mode:workerCurrentMode});return}workerIsRunning=!0;workerTimerInterval=setInterval(()=>{if(!workerIsRunning){clearInterval(workerTimerInterval);return}workerTimeLeft--;postMessage({type:"tick",timeLeft:workerTimeLeft,mode:workerCurrentMode});if(workerTimeLeft<=0){clearInterval(workerTimerInterval);workerIsRunning=!1;postMessage({type:"end",mode:workerCurrentMode})}},1e3)}self.onmessage=function(e){const{command:o,mode:t,duration:s,settings:i}=e.data;switch(o){case"start":workerIsRunning||startWorkerTimer();break;case"pause":workerIsRunning=!1;clearInterval(workerTimerInterval);break;case"setMode":workerCurrentMode=t;workerTimeLeft=s;workerIsRunning=!1;clearInterval(workerTimerInterval);postMessage({type:"modeSet",timeLeft:workerTimeLeft,mode:workerCurrentMode});break;case"updateSettings":workerSettings=i;if(!workerIsRunning&&workerCurrentMode){let e;e="study"===workerCurrentMode?workerSettings.studyTime*60:"shortBreak"===workerCurrentMode?workerSettings.shortBreakTime*60:"longBreak"===workerCurrentMode?workerSettings.longBreakTime*60:null;e&&workerTimeLeft!==e&&(workerTimeLeft=e,postMessage({type:"tick",timeLeft:workerTimeLeft,mode:workerCurrentMode}))}}};
    </script>

    <script>
        const baseAchievements = [{id:"days1",type:"totalDaysStudied",threshold:1,icon:"fas fa-seedling"},{id:"days7",type:"totalDaysStudied",threshold:7,icon:"fas fa-calendar-check"},{id:"days15",type:"totalDaysStudied",threshold:15,icon:"fas fa-medal"},{id:"days30",type:"totalDaysStudied",threshold:30,icon:"fas fa-award"},{id:"days50",type:"totalDaysStudied",threshold:50,icon:"fas fa-star"},{id:"days75",type:"totalDaysStudied",threshold:75,icon:"fas fa-running"},{id:"days100",type:"totalDaysStudied",threshold:100,icon:"fas fa-crown"},{id:"days120",type:"totalDaysStudied",threshold:120,icon:"fas fa-book-reader"},{id:"days150",type:"totalDaysStudied",threshold:150,icon:"fas fa-graduation-cap"},{id:"streak3",type:"streak",threshold:3,icon:"fas fa-fire"},{id:"streak7",type:"streak",threshold:7,icon:"fas fa-bolt"},{id:"streak14",type:"streak",threshold:14,icon:"fas fa-dumbbell"},{id:"streak30",type:"streak",threshold:30,icon:"fas fa-calendar-alt"},{id:"streak50",type:"streak",threshold:50,icon:"fas fa-shield-alt"},{id:"cycles1",type:"totalCyclesCompleted",threshold:1,icon:"fas fa-flag-checkered"},{id:"cycles10",type:"totalCyclesCompleted",threshold:10,icon:"fas fa-history"},{id:"cycles25",type:"totalCyclesCompleted",threshold:25,icon:"fas fa-cogs"},{id:"cycles50",type:"totalCyclesCompleted",threshold:50,icon:"fas fa-rocket"},{id:"cycles100",type:"totalCyclesCompleted",threshold:100,icon:"fas fa-gem"},{id:"hours1",type:"totalPureStudyHours",threshold:1,icon:"fas fa-hourglass-start"},{id:"hours10",type:"totalPureStudyHours",threshold:10,icon:"fas fa-brain"},{id:"hours50",type:"totalPureStudyHours",threshold:50,icon:"fas fa-microscope"},{id:"hours100",type:"totalPureStudyHours",threshold:100,icon:"fas fa-university"},{id:"sb_hours_1",type:"totalShortBreakSeconds",threshold:3600,icon:"fas fa-coffee"},{id:"sb_hours_5",type:"totalShortBreakSeconds",threshold:18e3,icon:"fas fa-mug-hot"},{id:"sb_hours_15",type:"totalShortBreakSeconds",threshold:54e3,icon:"fas fa-couch"},{id:"lb_hours_3",type:"totalLongBreakSeconds",threshold:10800,icon:"fas fa-bed"},{id:"lb_hours_10",type:"totalLongBreakSeconds",threshold:36e3,icon:"fas fa-battery-full"},{id:"lb_hours_25",type:"totalLongBreakSeconds",threshold:9e4,icon:"fas fa-umbrella-beach"},{id:"dailySessions5",type:"dailyFocusSessions",threshold:5,icon:"fas fa-bolt"},{id:"dailySessions10",type:"dailyFocusSessions",threshold:10,icon:"fas fa-rocket"},{id:"dailyCycles3",type:"dailyCyclesCompleted",threshold:3,icon:"fas fa-cogs"},{id:"dailyHours6",type:"dailyPureStudyHours",threshold:6,icon:"fas fa-brain"}];
        const translations = {
            en: {
                app_title: "PomodoroCycle Timer", goal_mode_all: "All Days", goal_mode_week_weekend: "Week/Weekend", goal_mode_custom: "Custom Days", goal_sessions_per_day: "Sessions per day:", goal_sessions_weekdays: "Sessions on Weekdays:", goal_sessions_weekends: "Sessions on Weekends:", toast_goal_too_long_title: "Goal Exceeds 24 Hours", toast_goal_too_long_body: "A daily goal cannot exceed 24 hours of focus time. Please adjust your values.", help_tooltip:"Help / How to Use",settings_tooltip:"Settings",current_timer_label:"Current Timer:",mode_study:"Focus",mode_short_break:"Short Break",mode_long_break:"Long Break",cycle_tooltip:"Focus Sessions in Current Cycle",reset_cycle_tooltip:"Reset Cycle",skip_break_button:"Skip Break",start_button:"Start",pause_button:"Pause",resume_button:"Resume",reset_current_button:"Reset Current",tab_stats:"Statistics",tab_daily_goal:"Daily Goal",tab_achievements:"Achievements",stats_title:"Your Statistics",stats_streak:"Daily Streak",stats_daily_title:"Daily:",stats_daily_total_time:"Total Time Today",stats_daily_focus_sessions:"Focus Sessions Today",stats_daily_cycles:"Cycles Completed Today",stats_daily_study_time:"Focus Time Today",stats_general_title:"General:",stats_general_cycles:"Total Cycles Completed",stats_general_sessions:"Total Focus Sessions",stats_general_study_time:"Total Focus Time",stats_general_days:"Total Focus Days",storage_warning:"Your progress is saved in your browser's local storage. Clearing browser data may delete your progress.",donation_text:"If you'd like to support this app, you can do so {0}",donation_link_text:"here ‚òï",settings_title:"Timer Settings",settings_section_timer:"Timer Durations",settings_section_prefs:"Preferences",settings_study_time:"Focus Time (minutes):",settings_short_break:"Short Break (minutes):",settings_long_break:"Long Break (minutes):",settings_language:"Language:",settings_enable_sounds:"Enable Sounds:",settings_data_management:"Data Management",settings_data_info:"Save your progress to a file or load it on another device.",settings_export_button:"Export Data",settings_import_button:"Import Data",cancel_button:"Cancel",save_button:"Save Settings",save_goal_button:"Save Goal",confirm_button:"Confirm",ok_button:"OK",got_it_button:"Got it!",new_badge:"NEW!",unlocked_on_date:"Unlocked on: {0}",progress_label:"Progress",chart_target_label:"Target",daily_goal_title:"Today's Goal",edit_goal_button:"Edit Goal",set_goal_button:"Set Goal",set_goal_title:"Set Your Daily Goal",no_goal_set:"No goal set for today.",goal_type_label:"Goal Type:",goal_type_sessions:"Focus Sessions",goal_type_cycles:"Completed Cycles",goal_value_label:"Target Value:",goal_completed_toast_title:"Goal Achieved!",goal_completed_toast_body:"Congratulations! You've reached your daily goal!",toast_goal_saved_body:"Your new daily goals have been saved.",achievements_title:"Your Achievements",toast_error_title:"Error",toast_goal_error:"Please enter a valid target value (must be a number greater than 0).",toast_settings_saved_title:"Settings Saved",toast_settings_saved_body:"Your new timer durations have been applied.",toast_achievement_unlocked_title:"Achievement Unlocked!",toast_achievement_unlocked_body:'You unlocked the achievement: "{0}"!',toast_study_complete_title:"Focus Session Complete!",toast_study_complete_body:"Time for a break. Good job!",toast_break_over_title:"Break Over!",toast_break_over_body:"Time to get back to focus!",toast_long_break_over_title:"Long Break Over!",toast_long_break_over_body:"Cycle complete! Ready for a new one?",toast_cycle_complete_title:"Cycle Complete!",toast_cycle_complete_body:"Congratulations! You've completed a full Pomodoro cycle.",toast_new_day_title:"A New Day!",toast_new_day_body:"Your daily statistics have been reset.",toast_import_success_title:"Import Successful",toast_import_success_body:"Your progress has been restored. The page will now reload.",toast_import_error_title:"Import Failed",toast_import_error_body:"The selected file is not a valid backup file or is corrupted.",alert_reset_cycle_title:"Confirm Reset",alert_reset_cycle_body:"Are you sure you want to reset the current cycle? This will set the focus session to 1/4.",alert_help_title:"How This Pomodoro Timer Works",alert_help_body:'<p class="mb-3">The <strong>Pomodoro Technique</strong> is a time management method that uses a timer to break down work into intervals, traditionally 25 minutes in length, separated by short breaks.</p><p class="mb-1 font-semibold">The timer\'s cycle:</p><ul><li>1. Focus Session (e.g., 25 min)</li><li class="break-session" style="padding-left: 35px;">Short Break (e.g., 5 min)</li><li>2. Focus Session</li><li class="break-session" style="padding-left: 35px;">Short Break</li><li>3. Focus Session</li><li class="break-session" style="padding-left: 35px;">Short Break</li><li>4. Focus Session (completes 1 cycle)</li><li class="break-session" style="padding-left: 35px;">Long Break (e.g., 15 min)</li></ul><p class="mb-3">Focus sessions and breaks begin automatically. After the long break, however, you\'ll need to start the new cycle manually.</p><p class="mb-3">The daily streak only increases after completing the first session of the day.</p><p>Reset the cycle using the <i class=\'fas fa-sync-alt fa-xs\'></i> button.</p>',alert_import_title:"Import Progress?",alert_import_body:"This will overwrite all your current progress, achievements, and settings. This action cannot be undone. Are you sure you want to continue?",alert_goal_type_change_title:"Change Goal Type?",alert_goal_type_change_body:"Changing the goal type will reset your goal history chart for the past 7 days to provide a clean slate for the new metric. Are you sure you want to proceed?",today_label:"Today",achievements:{"days1":{name:"Focused Beginner",description:"Complete your first day of focus."},"days7":{name:"Weekly Commitment",description:"Focus for 7 days."},"days15":{name:"Fortnightly Focus",description:"Focus for 15 days."},"days30":{name:"Monthly Landmark",description:"Focus for 30 days."},"days50":{name:"Shooting Star",description:"Focus for 50 days."},"days75":{name:"Focus Marathoner",description:"Focus for 75 days."},"days100":{name:"Habit Master",description:"Focus for 100 days."},"days120":{name:"Focus Legend",description:"Focus for 120 days."},"days150":{name:"Focus Sage",description:"Focus for 150 days."},"streak3":{name:"3-Day Combo!",description:"Maintain a 3-day daily streak."},"streak7":{name:"A Week Streak",description:"Maintain a 7-day daily streak."},"streak14":{name:"Habit Power-Up",description:"Maintain a 14-day daily streak."},"streak30":{name:"Unstoppable",description:"Maintain a 30-day daily streak."},"streak50":{name:"True Dedication",description:"Maintain a 50-day daily streak."},"cycles1":{name:"First Full Cycle",description:"Complete 1 Pomodoro cycle."},"cycles10":{name:"Ten Cycles of Focus",description:"Complete 10 Pomodoro cycles."},"cycles25":{name:"Productivity Pro",description:"Complete 25 Pomodoro cycles."},"cycles50":{name:"To The Moon",description:"Complete 50 Pomodoro cycles."},"cycles100":{name:"Cycle Centurion",description:"Complete 100 Pomodoro cycles."},"hours1":{name:"First Hour of Focus",description:"Accumulate 1 hour of focus."},"hours10":{name:"Immersive Thinker",description:"Accumulate 10 hours of focus."},"hours50":{name:"Knowledge Fountain",description:"Accumulate 50 hours of focus."},"hours100":{name:"Focus Scholar",description:"Accumulate 100 hours of focus."},"sb_hours_1":{name:"Quick Breather",description:"Accumulate 1 hour in short breaks."},"sb_hours_5":{name:"Relaxation Adept",description:"Accumulate 5 hours in short breaks."},"sb_hours_15":{name:"Short Break Pro",description:"Accumulate 15 hours in short breaks."},"lb_hours_3":{name:"Well Deserved Rest",description:"Accumulate 3 hours in long breaks."},"lb_hours_10":{name:"Recharge Master",description:"Accumulate 10 hours in long breaks."},"lb_hours_25":{name:"Leisure Expert",description:"Accumulate 25 hours in long breaks."},"dailySessions5":{name:"Daily Sprinter",description:"5 focus sessions in one day."},"dailySessions10":{name:"Focus Machine",description:"10 focus sessions in one day."},"dailyCycles3":{name:"Tricycler",description:"3 full cycles in one day."},"dailyHours6":{name:"Deep Work",description:"6 focus hours in one day."}},goal_text:{focusSessions_one:"{0} Focus Session",focusSessions_other:"{0} Focus Sessions",completedCycles_one:"{0} Cycle",completedCycles_other:"{0} Cycles"}},
            'pt-BR': {
                app_title: "PomodoroCycle Timer", goal_mode_all: "Todos os Dias", goal_mode_week_weekend: "Semana/Fim de Semana", goal_mode_custom: "Dias Customizados", goal_sessions_per_day: "Sess√µes por dia:", goal_sessions_weekdays: "Sess√µes na Semana:", goal_sessions_weekends: "Sess√µes no Fim de Semana:", toast_goal_too_long_title: "Meta Excede 24 Horas", toast_goal_too_long_body: "A meta di√°ria n√£o pode exceder 24h de foco. Por favor, ajuste os valores.", help_tooltip:"Ajuda / Como Usar",settings_tooltip:"Configura√ß√µes",current_timer_label:"Timer Atual:",mode_study:"Foco",mode_short_break:"Pausa Curta",mode_long_break:"Pausa Longa",cycle_tooltip:"Sess√µes de foco no ciclo atual",reset_cycle_tooltip:"Reiniciar Ciclo",skip_break_button:"Pular Pausa",start_button:"Iniciar",pause_button:"Pausar",resume_button:"Retomar",reset_current_button:"Resetar Atual",tab_stats:"Estat√≠sticas",tab_daily_goal:"Meta Di√°ria",tab_achievements:"Conquistas",stats_title:"Suas Estat√≠sticas",stats_streak:"Sequ√™ncia Di√°ria",stats_daily_title:"Hoje:",stats_daily_total_time:"Tempo Total Hoje",stats_daily_focus_sessions:"Sess√µes de Foco Hoje",stats_daily_cycles:"Ciclos Completos Hoje",stats_daily_study_time:"Tempo de Foco Hoje",stats_general_title:"Geral:",stats_general_cycles:"Total de Ciclos Completos",stats_general_sessions:"Total de Sess√µes de Foco",stats_general_study_time:"Total de Tempo de Foco",stats_general_days:"Total de Dias de Foco",storage_warning:"Seu progresso √© salvo no armazenamento local do navegador. Limpar os dados pode apagar seu progresso.",donation_text:"Se quiser apoiar este app, voc√™ pode faz√™-lo {0}",donation_link_text:"aqui ‚òï",settings_title:"Configura√ß√µes do Timer",settings_section_timer:"Dura√ß√µes do Timer",settings_section_prefs:"Prefer√™ncias",settings_study_time:"Tempo de Foco (minutos):",settings_short_break:"Pausa Curta (minutos):",settings_long_break:"Pausa Longa (minutos):",settings_language:"Idioma:",settings_enable_sounds:"Habilitar Sons:",settings_data_management:"Gest√£o de Dados",settings_data_info:"Salve seu progresso em um arquivo ou carregue-o em outro dispositivo.",settings_export_button:"Exportar Dados",settings_import_button:"Importar Dados",cancel_button:"Cancelar",save_button:"Salvar",save_goal_button:"Salvar Meta",confirm_button:"Confirmar",ok_button:"OK",got_it_button:"Entendi!",new_badge:"NOVO!",unlocked_on_date:"Desbloqueado em: {0}",progress_label:"Progresso",chart_target_label:"Meta",daily_goal_title:"Meta de Hoje",edit_goal_button:"Editar Meta",set_goal_button:"Definir Meta",set_goal_title:"Defina Sua Meta Di√°ria",no_goal_set:"Nenhuma meta definida para hoje.",goal_type_label:"Tipo de Meta:",goal_type_sessions:"Sess√µes de Foco",goal_type_cycles:"Ciclos Completos",goal_value_label:"Valor Alvo:",goal_completed_toast_title:"Meta Alcan√ßada!",goal_completed_toast_body:"Parab√©ns! Voc√™ atingiu sua meta di√°ria!",toast_goal_saved_body:"Suas novas metas di√°rias foram salvas.",achievements_title:"Suas Conquistas",toast_error_title:"Erro",toast_goal_error:"Por favor, insira um valor alvo v√°lido (deve ser um n√∫mero maior que 0).",toast_settings_saved_title:"Configura√ß√µes Salvas",toast_settings_saved_body:"As novas dura√ß√µes do timer foram aplicadas.",toast_achievement_unlocked_title:"Conquista Desbloqueada!",toast_achievement_unlocked_body:'Voc√™ desbloqueou a conquista: "{0}"!',toast_study_complete_title:"Sess√£o de Foco Completa!",toast_study_complete_body:"Hora de uma pausa. Bom trabalho!",toast_break_over_title:"Pausa Terminada!",toast_break_over_body:"Hora de voltar ao foco!",toast_long_break_over_title:"Pausa Longa Terminada!",toast_long_break_over_body:"Ciclo completo! Pronto para um novo?",toast_cycle_complete_title:"Ciclo Completo!",toast_cycle_complete_body:"Parab√©ns! Voc√™ completou um ciclo Pomodoro.",toast_new_day_title:"Um Novo Dia!",toast_new_day_body:"Suas estat√≠sticas di√°rias foram reiniciadas.",toast_import_success_title:"Importa√ß√£o Conclu√≠da",toast_import_success_body:"Seu progresso foi restaurado. A p√°gina ser√° recarregada.",toast_import_error_title:"Falha na Importa√ß√£o",toast_import_error_body:"O arquivo selecionado n√£o √© um backup v√°lido ou est√° corrompido.",alert_reset_cycle_title:"Confirmar Rein√≠cio",alert_reset_cycle_body:"Tem certeza que quer reiniciar o ciclo atual? A sess√£o de foco voltar√° para 1/4.",alert_help_title:"Como o Timer Pomodoro Funciona",alert_help_body:'<p class="mb-3">A <strong>T√©cnica Pomodoro</strong> √© um m√©todo de gerenciamento de tempo que usa um timer para dividir o trabalho em intervalos, tradicionalmente de 25 minutos, separados por pausas curtas.</p><p class="mb-1 font-semibold">O ciclo deste timer:</p><ul><li>1. Sess√£o de Foco (ex: 25 min)</li><li class="break-session" style="padding-left: 35px;">Pausa Curta (ex: 5 min)</li><li>2. Sess√£o de Foco</li><li class="break-session" style="padding-left: 35px;">Pausa Curta</li><li>3. Sess√£o de Foco</li><li class="break-session" style="padding-left: 35px;">Pausa Curta</li><li>4. Sess√£o de Foco (completa 1 ciclo)</li><li class="break-session" style="padding-left: 35px;">Pausa Longa (ex: 15 min)</li></ul><p class="mb-3">As sess√µes de foco e pausas come√ßam automaticamente. Ap√≥s a pausa longa, no entanto, voc√™ precisar√° iniciar o novo ciclo manualmente.</p><p class="mb-3">A sequ√™ncia di√°ria s√≥ aumenta ap√≥s completar a primeira sess√£o de foco do dia.</p><p>Reinicie o ciclo usando o bot√£o <i class=\'fas fa-sync-alt fa-xs\'></i>.</p>',alert_import_title:"Importar Progresso?",alert_import_body:"Isso ir√° sobrescrever todo o seu progresso, conquistas e configura√ß√µes atuais. Esta a√ß√£o n√£o pode ser desfeita. Voc√™ tem certeza que deseja continuar?",alert_goal_type_change_title:"Mudar tipo de meta?",alert_goal_type_change_body:"Mudar o tipo da meta ir√° reiniciar o hist√≥rico do seu gr√°fico dos √∫ltimos 7 dias para uma melhor visualiza√ß√£o da nova m√©trica. Tem certeza que deseja prosseguir?",today_label:"Hoje",achievements:{"days1":{name:"Iniciante Focado",description:"Complete seu primeiro dia de foco."},"days7":{name:"Compromisso Semanal",description:"Foque por 7 dias."},"days15":{name:"Foco Quinzenal",description:"Foque por 15 dias."},"days30":{name:"Marco Mensal",description:"Foque por 30 dias."},"days50":{name:"Estrela Cadente",description:"Foque por 50 dias."},"days75":{name:"Maratonista do Foco",description:"Foque por 75 dias."},"days100":{name:"Mestre do H√°bito",description:"Foque por 100 dias."},"days120":{name:"Lenda do Foco",description:"Foque por 120 dias."},"days150":{name:"S√°bio do Foco",description:"Foque por 150 dias."},"streak3":{name:"Combo de 3 Dias!",description:"Mantenha uma sequ√™ncia de 3 dias."},"streak7":{name:"Sequ√™ncia Semanal",description:"Mantenha uma sequ√™ncia de 7 dias."},"streak14":{name:"H√°bito Turbinado",description:"Mantenha uma sequ√™ncia de 14 dias."},"streak30":{name:"Impar√°vel",description:"Mantenha uma sequ√™ncia de 30 dias."},"streak50":{name:"Dedica√ß√£o Pura",description:"Mantenha uma sequ√™ncia de 50 dias."},"cycles1":{name:"Primeiro Ciclo",description:"Complete 1 ciclo Pomodoro."},"cycles10":{name:"Dez Ciclos de Foco",description:"Complete 10 ciclos Pomodoro."},"cycles25":{name:"Pro da Produtividade",description:"Complete 25 ciclos Pomodoro."},"cycles50":{name:"Para a Lua",description:"Complete 50 ciclos Pomodoro."},"cycles100":{name:"Centuri√£o de Ciclos",description:"Complete 100 ciclos Pomodoro."},"hours1":{name:"Primeira Hora de Foco",description:"Acumule 1 hora de foco."},"hours10":{name:"Pensador Imersivo",description:"Acumule 10 horas de foco."},"hours50":{name:"Fonte de Sabedoria",description:"Acumule 50 horas de foco."},"hours100":{name:"Erudito do Foco",description:"Acumule 100 horas de foco."},"sb_hours_1":{name:"Respiro R√°pido",description:"Acumule 1 hora em pausas curtas."},"sb_hours_5":{name:"Mestre do Relax",description:"Acumule 5 horas em pausas curtas."},"sb_hours_15":{name:"Campe√£o da Pausa",description:"Acumule 15 horas em pausas curtas."},"lb_hours_3":{name:"Descanso Merecido",description:"Acumule 3 horas em pausas longas."},"lb_hours_10":{name:"Mestre da Recarga",description:"Acumule 10 horas em pausas longas."},"lb_hours_25":{name:"Expert do Lazer",description:"Acumule 25 horas em pausas longas."},"dailySessions5":{name:"Velocista Di√°rio",description:"5 sess√µes de foco em um dia."},"dailySessions10":{name:"M√°quina de Foco",description:"10 sess√µes de foco em um dia."},"dailyCycles3":{name:"Triciclista",description:"3 ciclos completos em um dia."},"dailyHours6":{name:"Trabalho Intenso",description:"6 horas de foco em um dia."}},goal_text:{focusSessions_one:"{0} Sess√£o de Foco",focusSessions_other:"{0} Sess√µes de Foco",completedCycles_one:"{0} Ciclo",completedCycles_other:"{0} Ciclos"}}
        };

        const timerTextEl=document.getElementById("timerText"),modePillEl=document.getElementById("modePill"),cycleDotsContainerEl=document.getElementById("cycleDotsContainer"),resetButton=document.getElementById("resetButton"),resetCycleCountButtonEl=document.getElementById("resetCycleCountButton"),startPauseButton=document.getElementById("startPauseButton"),skipBreakButton=document.getElementById("skipBreakButton"),settingsButton=document.getElementById("settingsButton"),helpButton=document.getElementById("helpButton"),settingsModal=document.getElementById("settingsModal"),saveSettingsButton=document.getElementById("saveSettingsButton"),cancelSettingsButton=document.getElementById("cancelSettingsButton"),studyTimeInput=document.getElementById("studyTimeInput"),shortBreakTimeInput=document.getElementById("shortBreakTimeInput"),longBreakTimeInput=document.getElementById("longBreakTimeInput"),languageSelect=document.getElementById("languageSelect"),soundToggle=document.getElementById("soundToggle"),exportDataButton=document.getElementById("exportDataButton"),importDataButton=document.getElementById("importDataButton"),importFileInput=document.getElementById("importFileInput"),tabButtons=document.querySelectorAll(".tab-button"),tabPanes=document.querySelectorAll(".tab-pane"),tabContentEl=document.getElementById("tabContent"),collapseTabsButton=document.getElementById("collapseTabsButton"),collapseIcon=document.getElementById("collapseIcon"),dailyFocusSessionsEl=document.getElementById("dailyFocusSessions"),dailyCyclesEl=document.getElementById("dailyCycles"),dailyStudyTimeEl=document.getElementById("dailyStudyTime"),dailyTotalTimeEl=document.getElementById("dailyTotalTime"),totalFocusSessionsEl=document.getElementById("totalFocusSessions"),totalDaysStudiedEl=document.getElementById("totalDaysStudied"),totalCyclesEl=document.getElementById("totalCycles"),totalStudyTimeEl=document.getElementById("totalStudyTime"),streakCounterHeaderEl=document.getElementById("streakCounterHeader"),streakFireIconContainerEl=document.getElementById("streakFireIconContainer"),achievementsListEl=document.getElementById("achievementsList"),customAlertModal=document.getElementById("customAlertModal"),customAlertContentEl=document.getElementById("customAlertContent"),customAlertIconEl=document.getElementById("customAlertIcon"),customAlertTitleEl=document.getElementById("customAlertTitle"),customAlertMessageEl=document.getElementById("customAlertMessage"),customAlertConfirmButton=document.getElementById("customAlertConfirmButton"),customAlertCancelButton=document.getElementById("customAlertCancelButton"),customAlertButtonsContainer=document.getElementById("customAlertButtons"),faviconEl=document.getElementById("favicon"),toastNotificationEl=document.getElementById("toastNotification"),toastTitleEl=document.getElementById("toastTitle"),toastBodyEl=document.getElementById("toastBody"),rewardsTabBadgeEl=document.getElementById("rewardsTabBadge"),achievementsTabBadgeEl=document.getElementById("achievementsTabBadge"),languageModal=document.getElementById("languageModal"),languageButtonsContainer=document.getElementById("languageButtonsContainer"),appContainer=document.getElementById("app-container"),goalDisplayView=document.getElementById("goalDisplayView"),goalEditView=document.getElementById("goalEditView"),editGoalButton=document.getElementById("editGoalButton"),saveGoalButton=document.getElementById("saveGoalButton"),cancelGoalButton=document.getElementById("cancelGoalButton"),goalProgressContainer=document.getElementById("goalProgressContainer"),goalTextEl=document.getElementById("goalText"),goalProgressTextEl=document.getElementById("goalProgressText"),goalProgressBarEl=document.getElementById("goalProgressBar"),goalHistoryChartCanvas=document.getElementById("goalHistoryChart");
        let goalHistoryChart,lastSoundScheduledTime=0,justSeenAchievementIds=[],blockUnloadSave=!1,currentTimerInitialDuration=0,activeTabId="stats";const POMODOROS_PER_CYCLE=4,MIN_SOUND_INTERVAL=.05,SOUND_BASE_DELAY=.05;
        
        function getTodayDateString(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}
        function getDefaultAppData(){return{settings:{studyTime:25,shortBreakTime:5,longBreakTime:15,soundEnabled:!0,language:"en"},timerState:{currentMode:"study",timeLeft:1500,isRunning:!1,pomodorosInCycle:0,lastTimerUsed:null},stats:{daily:{date:getTodayDateString(),focusSessions:0,cyclesCompleted:0,pureStudySeconds:0,totalTimeSeconds:0,firstStudySessionCompletedToday:!1},general:{totalDaysStudied:0,totalCyclesCompleted:0,totalFocusSessions:0,totalPureStudySeconds:0,streak:0,lastStudyDate:null,totalShortBreakSeconds:0,totalLongBreakSeconds:0},goalHistory:[]},dailyGoal:{settings:{mode:"all_days",targetAll:4,targetWeekday:4,targetWeekend:2,targetsCustom:[2,4,4,4,4,4,2]},target:0,progress:0,completed:!1,notificationShown:!1},achievements:[],uiState:{newAchievementsCount:0,tabsCollapsed:!1},appVersion:"3.6.0"}}
        let appData=getDefaultAppData(),synth;
        "undefined"!=typeof Tone?synth=new Tone.Synth().toDestination():console.warn("Tone.js not loaded. Sound effects will be disabled.");
        function playSound(e="C4",t="8n",a="timerComplete"){if(!appData.settings.soundEnabled||!synth)return;"running"!==Tone.context.state&&Tone.context.resume().catch(e=>console.error("Error resuming AudioContext:",e)),"started"!==Tone.Transport.state&&Tone.Transport.start();try{let o=e,s=t,n=0;"achievement"===a?(o="C5",s="4n",n=-6):"goal"===a&&(o="E5",s="4n",n=-6);const l=Tone.now(),c=Math.max(l+SOUND_BASE_DELAY,lastSoundScheduledTime+MIN_SOUND_INTERVAL);lastSoundScheduledTime=c,synth.volume.setValueAtTime(n,c),synth.triggerAttackRelease(o,s,c)}catch(e){console.error(`Error playing sound (type: ${a}):`,e)}}
        function formatTime(e){const t=Math.floor(e/60),a=e%60;return`${String(t).padStart(2,"0")}:${String(a).padStart(2,"0")}`}
        function formatHoursMinutes(e){const t=Math.floor(e/3600);return`${t}h ${Math.floor(e%3600/60)}m`}
        function getText(key,...args){const lang=appData.settings.language||"en";let text=(translations[lang]&&translations[lang][key])||translations.en[key];if(!text){for(const langKey in translations){if(translations[langKey]&&translations[langKey][key]){text=translations[langKey][key];break}}}if(!text)return key;if(args.length>0){args.forEach((arg,index)=>{text=text.replace(`{${index}}`,arg)})}return text}
        function getPluralText(e,t){const a=appData.settings.language||"en",o=new Intl.PluralRules(a).select(t),s=`${e}_${o}`;let n=translations[a]?.goal_text?.[s]||translations.en?.goal_text?.[s];return n||(n=translations[a]?.goal_text?.[`${e}_other`]||translations.en?.goal_text?.[`${e}_other`]),n?n.replace("{0}",t):`${t} ${e}`}
        function applyTranslations(){const e=appData.settings.language||"en";document.documentElement.lang=e,document.title=getText("app_title"),document.querySelectorAll("[data-translate-key]").forEach(e=>{const t=e.dataset.translateKey,a=getText(t);if("INPUT"===e.tagName||"TEXTAREA"===e.tagName)e.placeholder&&(e.placeholder=a);else if(e.title)e.title=a;else{const o=e.querySelector("span")||e;o&&o.innerHTML!==a&&(o.innerHTML=a)}});const t=document.querySelector('[data-translate-key="donation_text"]');t&&(t.innerHTML=getText("donation_text",`<a href="https://www.buymeacoffee.com/lemonade299792458" target="_blank" class="donation-section-link">${getText("donation_link_text")}</a>`))}
        const STORAGE_KEY="pomodoroGamifiedAppData_v3";
        function buildAchievements(e,t=[]){const a=(translations[e]&&translations[e].achievements?translations[e].achievements:translations.en.achievements);return baseAchievements.map(e=>{const o=t.find(t=>t.id===e.id)||{},s=a[e.id]||{name:e.id,description:""};return{...e,name:s.name,description:s.description,unlocked:o.unlocked||!1,unlockedDate:o.unlockedDate||null,seen:o.seen||o.unlocked||!1}})}
        function isObject(e){return e&&"object"==typeof e&&!Array.isArray(e)}
        function mergeDeep(e,...t){if(!t.length)return e;const a=t.shift();return isObject(e)&&isObject(a)&&Object.keys(a).forEach(t=>{isObject(a[t])?(e[t]||Object.assign(e,{[t]:{}}),mergeDeep(e[t],a[t])):Object.assign(e,{[t]:a[t]})}),mergeDeep(e,...t)}
        function sanitizeLoadedData(e){const t=e.stats;return t.daily.focusSessions=parseInt(t.daily.focusSessions)||0,t.daily.cyclesCompleted=parseInt(t.daily.cyclesCompleted)||0,t.daily.pureStudySeconds=parseFloat(t.daily.pureStudySeconds)||0,t.daily.totalTimeSeconds=parseFloat(t.daily.totalTimeSeconds)||0,t.general.totalDaysStudied=parseInt(t.general.totalDaysStudied)||0,t.general.totalCyclesCompleted=parseInt(t.general.totalCyclesCompleted)||0,t.general.totalFocusSessions=parseInt(t.general.totalFocusSessions)||0,t.general.totalPureStudySeconds=parseFloat(t.general.totalPureStudySeconds)||0,t.general.streak=parseInt(t.general.streak)||0,t.general.totalShortBreakSeconds=parseFloat(t.general.totalShortBreakSeconds)||0,t.general.totalLongBreakSeconds=parseFloat(t.general.totalLongBreakSeconds)||0,e.timerState.pomodorosInCycle=parseInt(e.timerState.pomodorosInCycle)||0,e.timerState.timeLeft=parseFloat(e.timerState.timeLeft)||60*e.settings.studyTime,e.stats.goalHistory||(e.stats.goalHistory=[]),void 0===e.dailyGoal.target&&(e.dailyGoal.target=0),e}
        function loadData(){const e=localStorage.getItem(STORAGE_KEY),t=getDefaultAppData();if(e)try{const a=JSON.parse(e);appData=mergeDeep(t,a),appData=sanitizeLoadedData(appData),appData.dailyGoal.settings||(()=>{const e=appData.dailyGoal.target||4;appData.dailyGoal.settings={mode:"all_days",targetAll:e,targetWeekday:e,targetWeekend:2,targetsCustom:[2,e,e,e,e,e,2]}})();const o=appData.settings.language||"en";appData.achievements=buildAchievements(o,a.achievements||[])}catch(e){appData=getDefaultAppData(),appData.achievements=buildAchievements(appData.settings.language)}else appData=t,appData.achievements=buildAchievements(appData.settings.language);appData.stats.daily.date!==getTodayDateString()&&(archiveGoalProgress(),resetDailyStats()),studyTimeInput.value=appData.settings.studyTime,shortBreakTimeInput.value=appData.settings.shortBreakTime,longBreakTimeInput.value=appData.settings.longBreakTime,soundToggle.checked=appData.settings.soundEnabled,languageSelect.value=appData.settings.language,updateNotificationBadges()}
        function saveData(){const e=appData.achievements.map(e=>({id:e.id,unlocked:e.unlocked,unlockedDate:e.unlockedDate,seen:e.seen})),t={...appData,achievements:e};localStorage.setItem(STORAGE_KEY,JSON.stringify(t))}
        let toastTimeout;
        function showToast(e,t,a="info",o=4e3){clearTimeout(toastTimeout),toastTitleEl.textContent=e,toastBodyEl.textContent=t,toastNotificationEl.className="fixed top-5 right-5 p-4 rounded-md text-white z-[1000] transition-all duration-500 max-w-xs shadow-lg";switch(a){case"success":toastNotificationEl.classList.add("bg-green-500","show");break;case"error":toastNotificationEl.classList.add("bg-red-500","show");break;case"warning":toastNotificationEl.classList.add("bg-yellow-500","show");break;default:toastNotificationEl.classList.add("bg-sky-500","show")}toastTimeout=setTimeout(()=>{toastNotificationEl.classList.remove("show")},o)}
        function updateNotificationBadges(){const e=appData.achievements.filter(e=>e.unlocked&&!e.seen).length;achievementsTabBadgeEl.style.display=e>0?"inline-block":"none",rewardsTabBadgeEl.style.display=appData.dailyGoal.completed&&!appData.dailyGoal.notificationShown?"inline-block":"none"}
        let currentConfirmCallback=null,currentCancelCallback=null;
        function showCustomAlert(e,t,a="fas fa-info-circle text-sky-400",o="OK",s=null,n=null,l=null,c=!1){customAlertTitleEl.textContent=e,customAlertMessageEl.innerHTML=t,customAlertIconEl.className=`text-3xl mr-4 mt-1 ${a}`,customAlertConfirmButton.textContent=o,currentConfirmCallback=n,c?(customAlertContentEl.classList.remove("max-w-md"),customAlertContentEl.classList.add("max-w-lg")):(customAlertContentEl.classList.remove("max-w-lg"),customAlertContentEl.classList.add("max-w-md")),s&&"function"==typeof l?(customAlertCancelButton.textContent=s,customAlertCancelButton.classList.remove("hidden"),currentCancelCallback=l):(customAlertCancelButton.classList.add("hidden"),currentCancelCallback=null),customAlertModal.classList.add("show")}
        function updateTimerDisplay(){timerTextEl.textContent=formatTime(appData.timerState.timeLeft);let e,t="bg-slate-900",a="text-sky-400",o="bg-sky-400/10 text-sky-400";switch(appData.timerState.currentMode){case"study":e="mode_study",t="bg-slate-900",a="text-sky-400",o="bg-sky-400/10 text-sky-400",skipBreakButton.classList.add("hidden");break;case"shortBreak":e="mode_short_break",t="bg-green-900",a="text-green-400",o="bg-green-400/10 text-green-400",skipBreakButton.classList.remove("hidden");break;case"longBreak":e="mode_long_break",t="bg-purple-900",a="text-purple-400",o="bg-purple-400/10 text-purple-400",skipBreakButton.classList.remove("hidden")}modePillEl.textContent=getText(e),modePillEl.className=`py-1 px-3 rounded-full text-sm font-semibold transition-all duration-500 ${o}`,timerTextEl.className=`timer-text transition-colors duration-500 ${a}`,document.body.className=document.body.className.replace(/bg-(slate|green|purple)-900/g,"")+` ${t}`,document.title=`${formatTime(appData.timerState.timeLeft)} - ${getText(e)}`,updateCycleInfo()}
        function updateCycleInfo(){const e=cycleDotsContainerEl.children,t=appData.timerState.currentMode,a=appData.timerState.pomodorosInCycle;for(let o=0;o<e.length;o++){const s=e[o];s.className="cycle-dot";let n="border-sky-400";"shortBreak"===t?n="border-green-400":"longBreak"===t&&(n="border-purple-400"),o<a?s.classList.add("bg-sky-500"):o!==a||"study"!==t?s.classList.add("bg-slate-600"):s.classList.add("bg-transparent","border-2",n)}}
        function updateStatsDisplay(){dailyFocusSessionsEl.textContent=appData.stats.daily.focusSessions,dailyCyclesEl.textContent=appData.stats.daily.cyclesCompleted,dailyStudyTimeEl.textContent=formatHoursMinutes(appData.stats.daily.pureStudySeconds),dailyTotalTimeEl.textContent=formatHoursMinutes(appData.stats.daily.totalTimeSeconds),totalFocusSessionsEl.textContent=appData.stats.general.totalFocusSessions,totalDaysStudiedEl.textContent=appData.stats.general.totalDaysStudied,totalCyclesEl.textContent=appData.stats.general.totalCyclesCompleted,totalStudyTimeEl.textContent=formatHoursMinutes(appData.stats.general.totalPureStudySeconds);if(streakCounterHeaderEl)streakCounterHeaderEl.textContent=appData.stats.general.streak;if(streakFireIconContainerEl){const e=appData.stats.general.streak;let t="text-slate-400";e>=50?t="text-yellow-400":e>=40?t="text-teal-400":e>=35?t="text-sky-400":e>=30?t="text-blue-500":e>=25?t="text-indigo-500":e>=20?t="text-purple-500":e>=15?t="text-red-600":e>=10?t="text-red-500":e>=5?t="text-red-400":e>=1&&(t="text-orange-400"),streakFireIconContainerEl.className="",streakFireIconContainerEl.classList.add(t),streakFireIconContainerEl.innerHTML='<i class="fas fa-fire"></i>'}}
        function renderAchievements(){achievementsListEl.innerHTML="",appData.achievements.sort((a,b)=>{const c=justSeenAchievementIds.includes(a.id),d=justSeenAchievementIds.includes(b.id);if(c&&!d)return-1;if(!c&&d)return 1;const e=a.unlocked,f=b.unlocked;if(!e&&!f){let c=getAchievementProgress(a.type).current,d=a.threshold>0?c/a.threshold:-1,e=getAchievementProgress(b.type).current,g=b.threshold>0?e/b.threshold:-1;return d>g?-1:d<g?1:a.threshold<b.threshold?-1:a.threshold>b.threshold?1:0}return!e&&f&&!d?-1:e&&!c&&!f?1:e&&!c&&f&&!d?new Date(b.unlockedDate)-new Date(a.unlockedDate):0}),appData.achievements.forEach(ach=>{const isNew=justSeenAchievementIds.includes(ach.id),newIndicatorHTML=isNew?`<span class="ml-1 text-xs font-bold text-yellow-300 animate-pulse new-indicator">${getText("new_badge")}</span>`:"",achEl=document.createElement("div");achEl.className=`achievement-item p-3 rounded-lg shadow-md transition-all ${ach.unlocked?"unlocked bg-sky-600":"locked bg-slate-600"} ${isNew?"ring-1 ring-yellow-400 ring-inset":""}`;let mainContentHTML=`<div class="flex items-start mb-1"><i class="${ach.icon||"fas fa-question-circle"} text-xl ${ach.unlocked?"text-yellow-300":"text-slate-400"} mr-2 mt-1"></i><div class="flex-grow overflow-hidden"><div class="flex items-baseline"><h4 class="font-semibold text-sm ${ach.unlocked?"text-white":"text-sky-300"} truncate mr-1">${ach.name}</h4>${newIndicatorHTML}</div><p class="text-xs ${ach.unlocked?"text-sky-100":"text-slate-300"} leading-tight">${ach.description}</p></div></div>`;let progressSectionHTML='<div class="mt-auto">';if(ach.unlocked){const unlockedDate=new Date(ach.unlockedDate).toLocaleDateString(appData.settings.language.replace("_","-"));progressSectionHTML+=`<p class="text-xs text-yellow-200 font-semibold mt-1"><i class="fas fa-check-circle mr-1"></i>${getText("unlocked_on_date",unlockedDate)}</p>`}else{const{current,displayCurrent,displayTarget}=getAchievementProgress(ach.type,ach.threshold),progressPercent=ach.threshold>0?Math.min(100,current/ach.threshold*100):0;progressSectionHTML+=`<div class="progress-bar-container mt-2"><div class="progress-bar bg-sky-400" style="width: ${progressPercent.toFixed(2)}%;"></div></div><p class="text-xs text-slate-400 mt-1">${displayCurrent} / ${displayTarget}</p>`}progressSectionHTML+="</div>",achEl.innerHTML=mainContentHTML+progressSectionHTML,achievementsListEl.appendChild(achEl)})}
        function getAchievementProgress(e,t){let a=0;switch(e){case"totalDaysStudied":a=appData.stats.general.totalDaysStudied;break;case"totalCyclesCompleted":a=appData.stats.general.totalCyclesCompleted;break;case"totalPureStudyHours":a=appData.stats.general.totalPureStudySeconds/3600;break;case"totalFocusSessions":a=appData.stats.general.totalFocusSessions;break;case"streak":a=appData.stats.general.streak;break;case"totalShortBreakSeconds":a=appData.stats.general.totalShortBreakSeconds;break;case"totalLongBreakSeconds":a=appData.stats.general.totalLongBreakSeconds;break;case"dailyFocusSessions":a=appData.stats.daily.focusSessions;break;case"dailyCyclesCompleted":a=appData.stats.daily.cyclesCompleted;break;case"dailyPureStudyHours":a=appData.stats.daily.pureStudySeconds/3600}let o=t,s=a;return"totalShortBreakSeconds"===e||"totalLongBreakSeconds"===e?t>=3600?(s=(a/3600).toFixed(1),o=(t/3600).toFixed(1)+"h"):(s=(a/60).toFixed(0),o=(t/60).toFixed(0)+"m"):"totalPureStudyHours"===e||"dailyPureStudyHours"===e?(s=a.toFixed(1),o=t+"h"):(s=Math.floor(a),o=t),{current:a,displayCurrent:s,displayTarget:o}}
        function setTimer(e){appData.timerState.currentMode=e,appData.timerState.isRunning=!1,startPauseButton.querySelector("span").textContent=getText("start_button"),startPauseButton.querySelector("i").className="fas fa-play mr-2",timerWorker&&timerWorker.postMessage({command:"pause"});let t;switch(e){case"study":t=60*appData.settings.studyTime;break;case"shortBreak":t=60*appData.settings.shortBreakTime;break;case"longBreak":t=60*appData.settings.longBreakTime;break;default:t=60*appData.settings.studyTime,appData.timerState.currentMode="study"}appData.timerState.timeLeft=t,timerWorker&&timerWorker.postMessage({command:"setMode",mode:appData.timerState.currentMode,duration:appData.timerState.timeLeft}),updateTimerDisplay(),saveData()}
        function startTimer(){if(appData.timerState.timeLeft<=0){setTimer(appData.timerState.currentMode);if(appData.timerState.timeLeft<=0)return startPauseButton.querySelector("span").textContent=getText("start_button"),startPauseButton.querySelector("i").className="fas fa-play mr-2",void(appData.timerState.isRunning=!1))}appData.timerState.isRunning=!0,currentTimerInitialDuration=appData.timerState.timeLeft,startPauseButton.querySelector("span").textContent=getText("pause_button"),startPauseButton.querySelector("i").className="fas fa-pause mr-2",timerWorker&&timerWorker.postMessage({command:"start"}),saveData()}
        function pauseTimer(){appData.timerState.isRunning=!1,startPauseButton.querySelector("span").textContent=getText("resume_button"),startPauseButton.querySelector("i").className="fas fa-play mr-2",timerWorker&&timerWorker.postMessage({command:"pause"}),saveData()}
        function handleTimerEnd(e){appData.timerState.isRunning=!1;const t=appData.timerState.currentMode;appData.timerState.lastTimerUsed=t;let a,o,s="C4",n=null,l=!1,c=!0;if(appData.stats.daily.totalTimeSeconds+=e,"study"===t){if(appData.stats.daily.focusSessions++,appData.stats.general.totalFocusSessions++,appData.stats.daily.pureStudySeconds+=e,appData.stats.general.totalPureStudySeconds+=e,appData.timerState.pomodorosInCycle++,a="toast_study_complete_title",o="toast_study_complete_body",s="C5",!appData.stats.daily.firstStudySessionCompletedToday){appData.stats.daily.firstStudySessionCompletedToday=!0;const e=getTodayDateString();if(appData.stats.general.lastStudyDate!==e){appData.stats.general.totalDaysStudied++;const t=new Date;t.setDate(t.getDate()-1);const a=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`;appData.stats.general.streak=appData.stats.general.lastStudyDate===a?appData.stats.general.streak+1:1,appData.stats.general.lastStudyDate=e}}appData.timerState.pomodorosInCycle>=POMODOROS_PER_CYCLE?(n="longBreak",appData.stats.daily.cyclesCompleted++,appData.stats.general.totalCyclesCompleted++,l=!0):n="shortBreak"}else"shortBreak"===t?(appData.stats.general.totalShortBreakSeconds+=e,a="toast_break_over_title",o="toast_break_over_body",s="E4",n="study"):"longBreak"===t&&(appData.stats.general.totalLongBreakSeconds+=e,a="toast_long_break_over_title",o="toast_long_break_over_body",s="E4",appData.timerState.pomodorosInCycle=0,n="study",c=!1);checkGoalProgress(),checkAchievements(),updateStatsDisplay(),saveData(),playSound(s,"4n","timerComplete"),showToast(getText(a),getText(o),"info"),l&&showToast(getText("toast_cycle_complete_title"),getText("toast_cycle_complete_body"),"success",5e3),n?(setTimer(n),c&&startTimer()):(startPauseButton.querySelector("span").textContent=getText("start_button"),startPauseButton.querySelector("i").className="fas fa-play mr-2")}
        function resetCurrentTimer(){appData.timerState.isRunning&&timerWorker&&timerWorker.postMessage({command:"pause"}),appData.timerState.isRunning=!1;let e;switch(appData.timerState.currentMode){case"study":e=60*appData.settings.studyTime;break;case"shortBreak":e=60*appData.settings.shortBreakTime;break;case"longBreak":e=60*appData.settings.longBreakTime;break;default:e=60*appData.settings.studyTime}appData.timerState.timeLeft=e,timerWorker&&timerWorker.postMessage({command:"setMode",mode:appData.timerState.currentMode,duration:appData.timerState.timeLeft}),startPauseButton.querySelector("span").textContent=getText("start_button"),startPauseButton.querySelector("i").className="fas fa-play mr-2",updateTimerDisplay(),saveData()}
        function archiveGoalProgress(){const e=appData.stats.goalHistory||[],t=new Date;t.setDate(t.getDate()-7);const a=e.filter(e=>new Date(e.date)>=t),o=appData.stats.daily.date;if(appData.dailyGoal.target>0){const e={date:o,target:appData.dailyGoal.target,progress:appData.dailyGoal.progress,completed:appData.dailyGoal.completed},t=a.findIndex(e=>e.date===o);t>-1?a[t]=e:a.push(e)}appData.stats.goalHistory=a.slice(-7)}
        function resetDailyStats(){appData.stats.daily={date:getTodayDateString(),focusSessions:0,cyclesCompleted:0,pureStudySeconds:0,totalTimeSeconds:0,firstStudySessionCompletedToday:!1},appData.dailyGoal.progress=0,appData.dailyGoal.completed=!1,appData.dailyGoal.notificationShown=!1}
        function setTabStyling(isCollapsed){tabButtons.forEach(btn=>{btn.classList.remove("active","text-sky-400"),btn.classList.add("text-slate-400"),!isCollapsed&&btn.dataset.tab===activeTabId&&(btn.classList.add("active","text-sky-400"),btn.classList.remove("text-slate-400"))})}
        function showTab(e){activeTabId=e,setTabStyling(!1),tabPanes.forEach(t=>{const a=t.id===`${e}Content`;t.style.display=a?"flex":"none",t.classList.toggle("active",a)}),"achievements"===e?(justSeenAchievementIds=[],appData.achievements.forEach(e=>{e.unlocked&&!e.seen&&justSeenAchievementIds.push(e.id),e.unlocked&&(e.seen=!0)}),appData.uiState.newAchievementsCount=0,updateNotificationBadges(),saveData(),renderAchievements()):"dailyGoal"===e&&(requestAnimationFrame(()=>{renderGoalHistoryChart()}),appData.dailyGoal.target<=0?showGoalEditView(!0):showGoalEditView(!1))}
        function setTodaysGoal(){const e=appData.dailyGoal.settings,t=(new Date).getDay();let a=0;switch(e.mode){case"weekend":a=0===t||6===t?e.targetWeekend:e.targetWeekday;break;case"custom":a=e.targetsCustom[t];break;case"all_days":default:a=e.targetAll}appData.dailyGoal.target=a||0}
        function checkGoalProgress(){const e=appData.dailyGoal;if(e.target<=0)return void renderDailyGoal();if(e.completed)return renderDailyGoal(),void(goalHistoryChart&&renderGoalHistoryChart());const t=appData.stats.daily.focusSessions;e.progress=t,t>=e.target&&(e.completed=!0,e.notificationShown||(showToast(getText("goal_completed_toast_title"),getText("goal_completed_toast_body"),"success"),playSound("G5","2n","goal"))),renderDailyGoal(),goalHistoryChart&&renderGoalHistoryChart()}
        function renderDailyGoal(){const e=appData.dailyGoal;goalProgressContainer.style.display=e.target>0?"block":"none",e.target<=0?(goalTextEl.textContent=getText("no_goal_set"),editGoalButton.querySelector("span").textContent=getText("set_goal_button"),goalProgressBarEl.style.width="0%",goalProgressTextEl.textContent=""):(editGoalButton.querySelector("span").textContent=getText("edit_goal_button"),goalTextEl.textContent=getPluralText("focusSessions",e.target),goalProgressTextEl.textContent=`${Math.floor(e.progress)} / ${e.target}`,goalProgressBarEl.style.width=`${Math.min(100,e.progress/e.target*100)}%`,goalProgressBarEl.classList.toggle("completed",e.completed))}
        function renderGoalHistoryChart(){if(goalHistoryChart&&goalHistoryChart.destroy(),!goalHistoryChartCanvas)return;const e=appData.stats.goalHistory||[],t=[],a=[],o=[],s=appData.settings.language.replace("_","-");let n=0;const l=new Date;for(let c=6;c>=0;c--){const r=new Date(l);r.setDate(l.getDate()-c);const d=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`,i=r.toLocaleDateString(s,{weekday:"short"}),p=`${String(r.getDate()).padStart(2,"0")}/${String(r.getMonth()+1).padStart(2,"0")}`;t.push([i,p]);const u=e.find(e=>e.date===d);let m=0;0===c?(a.push(appData.dailyGoal.progress),m=appData.dailyGoal.target,o.push(m)):u?(a.push(u.progress),m=u.target,o.push(m)):(a.push(0),o.push(0)),n=Math.max(n,a[a.length-1],m)}const c=Math.max(4,Math.ceil(n)+1),r=goalHistoryChartCanvas.getContext("2d");goalHistoryChart=new Chart(r,{type:"bar",data:{labels:t,datasets:[{label:getText("progress_label"),data:a,backgroundColor:e=>6===e.index?"rgba(56, 189, 248, 1)":"rgba(56, 189, 248, 0.6)",borderColor:"rgba(56, 189, 248, 1)",borderWidth:1,borderRadius:2},{label:getText("chart_target_label"),data:o,type:"line",borderColor:"rgba(239, 68, 68, 0.7)",backgroundColor:"transparent",pointBackgroundColor:"rgba(239, 68, 68, 1)",borderDash:[5,5],fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,max:c,ticks:{color:"#94a3b8",stepSize:1,precision:0},grid:{color:"rgba(255, 255, 255, 0.1)"}},x:{ticks:{color:e=>6===e.index?"#38bdf8":"#94a3b8"},grid:{display:!1}}},plugins:{legend:{display:!0,position:"top",align:"end",labels:{color:"#cbd5e1",boxWidth:12,padding:20,font:{size:10}}},tooltip:{callbacks:{label:function(e){let t=e.dataset.label||"";return t&&(t+=": "),null!==e.parsed.y&&(t+=Math.floor(e.parsed.y)),t}}}}}})}
        function showGoalEditView(e){if(e){goalDisplayView.classList.add("hidden"),goalEditView.classList.remove("hidden");const t=appData.dailyGoal.settings;document.querySelector(`input[name="goalMode"][value="${t.mode}"]`).checked=!0,document.getElementById("goalValueInputAll").value=t.targetAll,document.getElementById("goalValueInputWeekday").value=t.targetWeekday,document.getElementById("goalValueInputWeekend").value=t.targetWeekend;const a=document.querySelector("#goalInputsCustom .custom-day-grid");a.innerHTML="";const o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];t.targetsCustom.forEach((e,t)=>{const s=o[t],n=`<div class="custom-day-input-group"><label for="goalDay${t}" class="block">${s}</label><input type="number" id="goalDay${t}" data-day-index="${t}" min="0" value="${e}" class="w-full p-2 rounded bg-slate-600 text-white border border-slate-500 text-center focus:ring-sky-500 focus:border-sky-500"></div>`;a.insertAdjacentHTML("beforeend",n)}),document.querySelectorAll('input[name="goalMode"]').forEach(e=>{e.dispatchEvent(new Event("change"))})}else goalDisplayView.classList.remove("hidden"),goalEditView.classList.add("hidden")}
        function checkAchievements(){const e=[];appData.achievements.forEach(t=>{if(!t.unlocked){const a=getAchievementProgress(t.type,t.threshold);a.current>=t.threshold&&(t.unlocked=!0,t.unlockedDate=(new Date).toISOString(),t.seen=!1,e.push(t))}});if(e.length>0){e.forEach((e,t)=>{setTimeout(()=>{const a=getText(`achievements.${e.id}.name`);showToast(getText("toast_achievement_unlocked_title"),getText("toast_achievement_unlocked_body",a),"success",5e3),playSound("C5","4n","achievement")},600*t)}),appData.uiState.newAchievementsCount+=e.length,updateNotificationBadges(),"achievements"===activeTabId&&renderAchievements()}}
        let timerWorker;window.Worker&&(timerWorker=new Worker(URL.createObjectURL(new Blob([document.getElementById("timerWorkerScript").textContent],{type:"application/javascript"}))),timerWorker.onmessage=function(e){const{type:t,timeLeft:a,mode:o}=e.data;"tick"===t?(appData.timerState.timeLeft=a,appData.timerState.currentMode===o&&updateTimerDisplay()):"end"===t?appData.timerState.currentMode===o&&handleTimerEnd(currentTimerInitialDuration):"modeSet"===t&&(appData.timerState.timeLeft=a,updateTimerDisplay())},timerWorker.onerror=function(e){timerWorker=null});
        function startMidnightChecker(){setInterval(()=>{getTodayDateString()!==appData.stats.daily.date&&(showToast(getText("toast_new_day_title"),getText("toast_new_day_body"),"info"),archiveGoalProgress(),resetDailyStats(),setTodaysGoal(),saveData(),updateStatsDisplay(),renderAllDynamicContent())},6e4)}
        function renderAllDynamicContent(){updateTimerDisplay(),updateStatsDisplay(),renderDailyGoal(),renderAchievements(),document.getElementById("dailyGoalContent").classList.contains("active")&&renderGoalHistoryChart()}
        function initializeApp(){appContainer.style.display="block",appContainer.classList.remove("hidden"),loadData(),setTodaysGoal(),checkGoalProgress();const e=getTodayDateString();if(appData.stats.general.lastStudyDate&&appData.stats.general.lastStudyDate!==e){const t=new Date(appData.stats.general.lastStudyDate),a=new Date(e),o=new Date(a);o.setDate(a.getDate()-1),t.setHours(0,0,0,0),o.setHours(0,0,0,0),t.getTime()<o.getTime()&&(appData.stats.general.streak=0)}const t={...appData.timerState};appData.timerState.currentMode=t.currentMode||"study",appData.timerState.timeLeft=t.timeLeft,appData.timerState.pomodorosInCycle=t.pomodorosInCycle||0;const a=t.isRunning||!1;appData.timerState.isRunning=!1,timerWorker&&(timerWorker.postMessage({command:"updateSettings",settings:appData.settings}),timerWorker.postMessage({command:"setMode",mode:appData.timerState.currentMode,duration:appData.timerState.timeLeft})),applyTranslations(),a&&appData.timerState.timeLeft>0?(appData.timerState.isRunning=!0,startPauseButton.querySelector("span").textContent=getText("pause_button"),startPauseButton.querySelector("i").className="fas fa-pause mr-2",timerWorker&&timerWorker.postMessage({command:"start"})):(startPauseButton.querySelector("span").textContent=getText("start_button"),startPauseButton.querySelector("i").className="fas fa-play mr-2"),appData.uiState.tabsCollapsed?(tabContentEl.classList.add("collapsed"),collapseIcon.className="fas fa-chevron-down",setTabStyling(!0)):(collapseIcon.className="fas fa-chevron-up",setTabStyling(!1)),renderAllDynamicContent(),updateNotificationBadges(),startMidnightChecker()}
        function setupLanguageChoices(){const e={en:"English","pt-BR":"Portugu√™s",es:"Espa√±ol",fr:"Fran√ßais",de:"Deutsch",ja:"Êó•Êú¨Ë™û",ru:"–†—É—Å—Å–∫–∏–π","zh-CN":"‰∏≠Êñá","hi-IN":"‡§π‡§ø‡§®‡•ç‡§¶‡•Ä"};Object.entries(e).forEach(([e,t])=>{const a=document.createElement("option");a.value=e,a.textContent=t,languageSelect.appendChild(a);const o=document.createElement("button");o.textContent=t,o.dataset.lang=e,o.className="w-full px-4 py-3 bg-slate-700 hover:bg-sky-500 rounded-lg transition-colors font-semibold text-sm",languageButtonsContainer.appendChild(o)});for(const t in translations)if(translations.hasOwnProperty(t)&&"en"!==t)for(const a in translations.en)translations[t][a]||(translations[t][a]=translations.en[a])}
        function handleFirstVisit(){languageModal.classList.add("show"),languageButtonsContainer.addEventListener("click",e=>{if("BUTTON"===e.target.tagName&&e.target.dataset.lang){const t=e.target.dataset.lang;appData.settings.language=t,saveData(),languageModal.classList.remove("show"),initializeApp()}})}
        window.addEventListener("beforeunload",()=>{blockUnloadSave||(archiveGoalProgress(),saveData())}),document.addEventListener("DOMContentLoaded",()=>{setupLanguageChoices(),localStorage.getItem(STORAGE_KEY)?initializeApp():handleFirstVisit(),startPauseButton.addEventListener("click",()=>{if("running"!==Tone.context.state)try{Tone.start()}catch(e){}appData.timerState.isRunning?pauseTimer():startTimer()}),resetButton.addEventListener("click",resetCurrentTimer),resetCycleCountButtonEl.addEventListener("click",()=>{showCustomAlert(getText("alert_reset_cycle_title"),getText("alert_reset_cycle_body"),"fas fa-sync-alt text-sky-400",getText("confirm_button"),getText("cancel_button"),()=>{appData.timerState.pomodorosInCycle=0,"study"!==appData.timerState.currentMode&&setTimer("study"),updateCycleInfo(),saveData()})}),skipBreakButton.addEventListener("click",()=>{("shortBreak"===appData.timerState.currentMode||"longBreak"===appData.timerState.currentMode)&&handleTimerEnd(0)}),settingsButton.addEventListener("click",()=>{studyTimeInput.value=appData.settings.studyTime,shortBreakTimeInput.value=appData.settings.shortBreakTime,longBreakTimeInput.value=appData.settings.longBreakTime,soundToggle.checked=appData.settings.soundEnabled,languageSelect.value=appData.settings.language,settingsModal.classList.add("show")}),helpButton.addEventListener("click",()=>{showCustomAlert(getText("alert_help_title"),getText("alert_help_body"),"fas fa-question-circle text-sky-400",getText("got_it_button"),null,null,null,!0)}),cancelSettingsButton.addEventListener("click",()=>{settingsModal.classList.remove("show")}),saveSettingsButton.addEventListener("click",()=>{const e=parseInt(studyTimeInput.value),t=parseInt(shortBreakTimeInput.value),a=parseInt(longBreakTimeInput.value),o=languageSelect.value,s=soundToggle.checked,n=appData.settings.language;e>0&&(appData.settings.studyTime=e),t>0&&(appData.settings.shortBreakTime=t),a>0&&(appData.settings.longBreakTime=a),appData.settings.language=o,appData.settings.soundEnabled=s,o!==n&&(appData.achievements=buildAchievements(o,appData.achievements),applyTranslations(),renderAllDynamicContent()),timerWorker&&timerWorker.postMessage({command:"updateSettings",settings:appData.settings}),appData.timerState.isRunning||resetCurrentTimer(),saveData(),settingsModal.classList.remove("show"),showToast(getText("toast_settings_saved_title"),getText("toast_settings_saved_body"),"success")}),tabButtons.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.tab;if(tabContentEl.classList.contains("collapsed")){tabContentEl.classList.remove("collapsed"),appData.uiState.tabsCollapsed=!1,collapseIcon.className="fas fa-chevron-up",showTab(t)}else activeTabId!==t&&showTab(t)})}),collapseTabsButton.addEventListener("click",()=>{const e=tabContentEl.classList.contains("collapsed");appData.uiState.tabsCollapsed=!e,e?(tabContentEl.classList.remove("collapsed"),collapseIcon.className="fas fa-chevron-up",setTabStyling(!1)):(tabContentEl.classList.add("collapsed"),collapseIcon.className="fas fa-chevron-down",setTabStyling(!0)),saveData()}),editGoalButton.addEventListener("click",()=>showGoalEditView(!0)),cancelGoalButton.addEventListener("click",()=>{!appData.dailyGoal.target>0&&!Object.values(appData.dailyGoal.settings).some(e=>Array.isArray(e)?e.some(e=>e>0):e>0)||showGoalEditView(!1)}),saveGoalButton.addEventListener("click",()=>{const e=appData.dailyGoal.settings;e.mode=document.querySelector('input[name="goalMode"]:checked').value,e.targetAll=parseInt(document.getElementById("goalValueInputAll").value)||0,e.targetWeekday=parseInt(document.getElementById("goalValueInputWeekday").value)||0,e.targetWeekend=parseInt(document.getElementById("goalValueInputWeekend").value)||0,document.querySelectorAll("#goalInputsCustom input").forEach(t=>{const a=parseInt(t.dataset.dayIndex);e.targetsCustom[a]=parseInt(t.value)||0});const t=appData.settings.studyTime,a=1440;if([e.targetAll,e.targetWeekday,e.targetWeekend,...e.targetsCustom].some(e=>e*t>a))return void showToast(getText("toast_goal_too_long_title"),getText("toast_goal_too_long_body"),"error",5e3);setTodaysGoal(),checkGoalProgress(),saveData(),showGoalEditView(!1),showToast(getText("toast_settings_saved_title"),getText("toast_goal_saved_body"),"success")}),importDataButton.addEventListener("click",()=>{importFileInput.click()}),importFileInput.addEventListener("change",e=>{const t=e.target.files[0];if(!t)return void(e.target.value="");const a=new FileReader;a.onload=t=>{try{const a=t.target.result,o=JSON.parse(a);if(!o.settings||!o.stats||!o.achievements)throw new Error("Invalid backup file structure.");showCustomAlert(getText("alert_import_title"),getText("alert_import_body"),"fas fa-exclamation-triangle text-yellow-400",getText("confirm_button"),getText("cancel_button"),()=>{localStorage.setItem(STORAGE_KEY,a),blockUnloadSave=!0,settingsModal.classList.remove("show"),location.reload()},()=>{e.target.value=""})}catch(t){showToast(getText("toast_import_error_title"),getText("toast_import_error_body"),"error"),e.target.value=""}},a.onerror=()=>{showToast(getText("toast_import_error_title"),"Could not read the selected file.","error"),e.target.value=""},a.readAsText(t)}),customAlertConfirmButton.addEventListener("click",()=>{if("function"==typeof currentConfirmCallback)currentConfirmCallback();customAlertModal.classList.remove("show"),currentConfirmCallback=null,currentCancelCallback=null}),customAlertCancelButton.addEventListener("click",()=>{if("function"==typeof currentCancelCallback)currentCancelCallback();customAlertModal.classList.remove("show"),currentConfirmCallback=null,currentCancelCallback=null}),document.querySelectorAll('input[name="goalMode"]').forEach(e=>{e.addEventListener("change",t=>{document.getElementById("goalInputsAllDays").classList.toggle("hidden","all_days"!==t.target.value),document.getElementById("goalInputsWeekend").classList.toggle("hidden","weekend"!==t.target.value),document.getElementById("goalInputsCustom").classList.toggle("hidden","custom"!==t.target.value)})})});
    </script>
</body>
</html>
