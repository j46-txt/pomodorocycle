<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>PomodoroCycle Timer</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
Â  Â  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
Â  Â  <link rel="preconnect" href="https://fonts.googleapis.com">
Â  Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@700&display=swap" rel="stylesheet">
Â  Â  <link id="favicon" rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text x="50" y="50" font-size="90" dominant-baseline="middle" text-anchor="middle">ğŸ…</text></svg>'>
Â  Â  <style>
Â  Â  Â  Â  body { font-family: 'Inter', sans-serif; transition: background-color 0.5s ease; overflow-y: scroll; }
Â  Â  Â  Â  .timer-text { font-family: 'Roboto Mono', monospace; font-size: 5rem; line-height: 1; letter-spacing: -0.05em; font-weight: 700; }
Â  Â  Â  Â  @media (min-width: 640px) { .timer-text { font-size: 6rem; } }
Â  Â  Â  Â  .tab-button { position: relative; border-bottom: 4px solid transparent; min-height: 54px; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease-in-out; }
Â  Â  Â  Â  .tab-button.active { border-bottom-color: #38bdf8; }
Â  Â  Â  Â  #tabContent { height: 21rem; overflow: hidden; transition: height 0.35s ease-in-out; }
Â  Â  Â  Â  .tab-pane { display: flex; flex-direction: column; width: 100%; height: 100%; }
Â  Â  Â  Â  #tabContent.collapsed { height: 0; }
Â  Â  Â  Â  #achievementsListContainer { max-height: 17rem; overflow-y: auto; padding-right: 0.5rem; }
Â  Â  Â  Â  #achievementsContent { padding-bottom: 1rem; }
Â  Â  Â  Â  .achievement-item { display: flex; flex-direction: column; justify-content: space-between; overflow: hidden; position: relative; min-height: 7rem; }
Â  Â  Â  Â  .progress-bar-container { width: 100%; background-color: #334155; height: 6px; border-radius: 3px; overflow: hidden; }
Â  Â  Â  Â  .progress-bar { height: 100%; transition: width 0.4s ease-in-out; border-radius: 3px; }
Â  Â  Â  Â  .modal { display: none; }
Â  Â  Â  Â  .modal.show { display: flex; }
Â  Â  Â  Â  ::-webkit-scrollbar { width: 8px; }
Â  Â  Â  Â  ::-webkit-scrollbar-track { background: #475569; border-radius: 10px; }
Â  Â  Â  Â  ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
Â  Â  Â  Â  ::-webkit-scrollbar-thumb:hover { background: #cbd5e1; }
Â  Â  Â  Â  @keyframes gradient-flow { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
Â  Â  Â  Â  #goalProgressBar { background: linear-gradient(90deg, #06b6d4, #38bdf8, #06b6d4); background-size: 200% 200%; animation: gradient-flow 3s ease infinite; transition: width 0.5s cubic-bezier(0.25, 1, 0.5, 1); }
Â  Â  Â  Â  #goalProgressBar.completed { box-shadow: 0 0 15px #38bdf8, 0 0 5px #06b6d4; }
Â  Â  Â  Â  .help-content ul { list-style-type: none; padding-left: 0; margin-bottom: 10px; }
Â  Â  Â  Â  .help-content li { margin-bottom: 5px; }
Â  Â  Â  Â  .help-content li.break-session { color: #a0aec0; }
Â  Â  Â  Â  #toastNotification { position: fixed; top: 20px; right: 20px; padding: 1rem; border-radius: 0.5rem; color: white; font-size: 0.875rem; z-index: 1000; opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; max-width: 300px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transform: translateX(100%); }
Â  Â  Â  Â  #toastNotification.show { opacity: 1; transform: translateX(0); }
Â  Â  Â  Â  #toastNotification.success { background-color: #34d399; }
Â  Â  Â  Â  #toastNotification.error { background-color: #ef4444; }
Â  Â  Â  Â  #toastNotification.info { background-color: #3b82f6; }
Â  Â  Â  Â  #toastNotification.warning { background-color: #f59e0b; }
Â  Â  Â  Â  .tab-badge { position: absolute; top: 0.2rem; right: 0.2rem; height: 0.65rem; width: 0.65rem; background-color: #ef4444; border-radius: 9999px; display: none; }
Â  Â  Â  Â  .new-indicator { font-size: 0.65rem; padding: 0.1rem 0.3rem; border-radius: 0.25rem; line-height: 1; }
Â  Â  Â  Â  .cycle-dot { width: 0.75rem; height: 0.75rem; border-radius: 9999px; transition: all 0.3s ease; }
Â  Â  Â  Â  @media (max-width: 639px) {
Â  Â  Â  Â  Â  Â  #tabContent { height: 20rem; }
Â  Â  Â  Â  Â  Â  .tab-button { flex-direction: column; padding-top: 0.5rem; padding-bottom: 0.5rem; font-size: 0.75rem; line-height: 1.2; min-height: 58px; }
Â  Â  Â  Â  Â  Â  .tab-button i { margin-right: 0; margin-bottom: 0.25rem; font-size: 1rem; }
Â  Â  Â  Â  Â  Â  .stats-grid-container { gap: 1rem; }
Â  Â  Â  Â  Â  Â  #statsContent h4 { font-size: 1rem; }
Â  Â  Â  Â  Â  Â  .stats-text-size { font-size: 0.875rem; }
Â  Â  Â  Â  Â  Â  .stats-text-size > p { margin-bottom: 0.25rem; }
Â  Â  Â  Â  Â  Â  .stats-bottom-warning { padding-bottom: 0.5rem; }
Â  Â  Â  Â  }
Â  Â  Â  Â  .donation-section { text-align: center; font-size: 0.75em; color: #5a687d; margin-top: 20px; max-width: 320px; opacity: 0.75; line-height: 1.4; }
Â  Â  Â  Â  .donation-section a { color: #5a687d; text-decoration: none; white-space: nowrap; transition: color 0.3s ease; }
Â  Â  Â  Â  .donation-section a:hover { color: #FFDD00; }
Â  Â  Â  Â  #goalProgressText { font-family: 'Inter', sans-serif; }
Â  Â  Â  Â  #statsContent { overflow-y: auto; overflow-x: hidden; }
Â  Â  Â  Â  #goalEditView { overflow-y: auto; }
Â  Â  Â  Â  .goal-mode-selector{display:flex;border-radius:.5rem;border:1px solid #475569;overflow:hidden;margin-bottom:1.5rem}
        .goal-mode-selector label{flex:1;padding:.5rem .5rem;text-align:center;cursor:pointer;transition:background-color .2s ease-in-out;font-size:.75rem;color:#cbd5e1;position:relative}
        .goal-mode-selector input[type=radio]{display:none}
        .goal-mode-selector input[type=radio]:checked+label{background-color:#38bdf8;color:#fff;font-weight:600}
        .goal-mode-selector label:not(:last-child){border-right:1px solid #475569}
        .custom-day-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(60px,1fr));gap:.75rem}
        .custom-day-input-group{text-align:center}
        .custom-day-input-group label{font-size:.75rem;color:#94a3b8}
Â  Â  </style>
</head>
<body class="bg-slate-900 text-white flex flex-col items-center min-h-screen p-4 selection:bg-sky-400 selection:text-sky-900">

Â  Â  <div id="languageModal" class="modal fixed inset-0 bg-slate-900 bg-opacity-95 items-center justify-center p-4 z-[200]">
Â  Â  Â  Â  <div class="bg-slate-800 p-8 rounded-2xl shadow-2xl w-full max-w-lg text-center">
Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-2 text-sky-300">Select Your Language</h2>
Â  Â  Â  Â  Â  Â  <p class="text-slate-400 mb-6">Choose your preferred language to continue.</p>
Â  Â  Â  Â  Â  Â  <div id="languageButtonsContainer" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <p class="text-xs text-slate-500 mt-6"><i class="fas fa-info-circle fa-fw mr-1.5 opacity-70"></i>You can change this choice later in the settings.</p>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="app-container" class="w-full hidden">
Â  Â  Â  Â  <div class="w-full max-w-3xl mx-auto bg-slate-800 shadow-2xl rounded-lg p-4 sm:p-6 relative mt-4 mb-4">
Â  Â  Â  Â  Â  Â  <div class="absolute top-4 sm:top-6 left-4 sm:left-6 z-10">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="helpButton" data-translate-key="help_tooltip" title="Help / How to Use" class="p-2 rounded-full text-sky-400 hover:bg-slate-700 hover:text-sky-300 transition-colors focus:outline-none">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-question-circle text-xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="absolute top-4 sm:top-6 right-4 sm:right-6 z-10">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="settingsButton" data-translate-key="settings_tooltip" title="Settings" class="p-2 rounded-full hover:bg-slate-700 transition-colors focus:outline-none">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-cog text-xl text-sky-400 hover:text-sky-300"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="timerDisplay" class="relative text-center mb-6 pt-8 md:pt-4 pb-4 rounded-lg bg-slate-700 shadow-inner">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="modeIndicator" class="h-8 flex items-center justify-center mb-2 text-slate-300 font-medium">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span data-translate-key="current_timer_label">Current Timer:</span>&nbsp;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="modePill" class="py-1 px-3 rounded-full text-sm font-semibold transition-all duration-500" data-translate-key="mode_study">Focus</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <p id="timerText" class="timer-text text-sky-400 transition-colors duration-500">25:00</p>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-center items-center mt-4 h-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="cycleDotsContainer" data-translate-key="cycle_tooltip" title="Focus Sessions in Current Cycle" class="flex items-center justify-center space-x-2.5">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="cycle-dot"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="cycle-dot"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="cycle-dot"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="cycle-dot"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="resetCycleCountButton" data-translate-key="reset_cycle_tooltip" title="Reset Cycle" class="ml-3 text-slate-500 hover:text-sky-400 transition-colors focus:outline-none focus:ring-0 text-[11px]">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-sync-alt"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="skipBreakButton" class="absolute bottom-3 right-3 hidden bg-slate-600 hover:bg-slate-500 text-slate-300 text-xs py-1.5 px-3 rounded-md shadow-md transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-forward fa-xs mr-1"></i><span data-translate-key="skip_break_button">Skip Break</span>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="flex justify-center items-center space-x-4 mb-8">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="startPauseButton" class="bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-transform transform hover:scale-105">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-play mr-2"></i><span data-translate-key="start_button">Start</span>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="resetButton" class="bg-slate-600 hover:bg-slate-500 text-slate-300 py-2 px-4 rounded-lg shadow-md transition-colors text-xs">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-undo fa-sm mr-1"></i><span data-translate-key="reset_current_button">Reset Current</span>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="mb-6 border-b border-slate-700">
Â  Â  Â  Â  Â  Â  Â  Â  <nav class="flex space-x-1 -mb-px">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-tab="stats" class="tab-button active text-sky-400 py-3 px-3 md:px-4 text-sm md:text-base font-medium text-center hover:text-sky-300 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-chart-line mr-2"></i><span data-translate-key="tab_stats">Statistics</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-tab="dailyGoal" class="tab-button text-slate-400 py-3 px-3 md:px-4 text-sm md:text-base font-medium text-center hover:text-sky-300 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-bullseye mr-2"></i><span data-translate-key="tab_daily_goal">Daily Goal</span> <span id="rewardsTabBadge" class="tab-badge"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-tab="achievements" class="tab-button text-slate-400 py-3 px-3 md:px-4 text-sm md:text-base font-medium text-center hover:text-sky-300 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-trophy mr-2"></i><span data-translate-key="tab_achievements">Achievements</span> <span id="achievementsTabBadge" class="tab-badge"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-grow"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="collapseTabsButton" title="Collapse/Expand Tabs" class="py-3 px-3 md:px-4 text-slate-400 hover:text-sky-300 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i id="collapseIcon" class="fas fa-chevron-up"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </nav>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="tabContent">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="statsContent" class="tab-pane active p-2 sm:p-4 bg-slate-700 rounded-b-lg justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-full flex flex-col h-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-base sm:text-lg font-semibold text-sky-300 mb-2 sm:mb-0" data-translate-key="stats_title">Your Statistics</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="streakContainerHeader" class="text-sm text-slate-300">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span data-translate-key="stats_streak">Daily Streak</span>: <span id="streakCounterHeader" class="font-semibold">0</span> <span id="streakFireIconContainer"><i class="fas fa-fire"></i></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-grow flex justify-center items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-2xl mx-auto stats-grid-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-slate-600 p-5 rounded-lg shadow">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold text-sky-400 mb-3 text-lg flex items-center"><i class="fas fa-chart-simple mr-2 opacity-80"></i><span data-translate-key="stats_general_title">General:</span></h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stats-text-size space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><span data-translate-key="stats_general_days">Total Focus Days</span>: <span id="totalDaysStudied" class="font-semibold">0</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><span data-translate-key="stats_general_study_time">Total Focus Time</span>: <span id="totalStudyTime" class="font-semibold">0h 0m</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><span data-translate-key="stats_general_sessions">Total Focus Sessions</span>: <span id="totalFocusSessions" class="font-semibold">0</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><span data-translate-key="stats_general_cycles">Total Cycles Completed</span>: <span id="totalCycles" class="font-semibold">0</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-slate-600 p-5 rounded-lg shadow">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold text-sky-400 mb-3 text-lg flex items-center"><i class="fas fa-calendar-day mr-2 opacity-80"></i><span data-translate-key="stats_daily_title">Daily:</span></h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stats-text-size space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><span data-translate-key="stats_daily_total_time">Total Time Today</span>: <span id="dailyTotalTime" class="font-semibold">0h 0m</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><span data-translate-key="stats_daily_study_time">Focus Time Today</span>: <span id="dailyStudyTime" class="font-semibold">0h 0m</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><span data-translate-key="stats_daily_focus_sessions">Focus Sessions Today</span>: <span id="dailyFocusSessions" class="font-semibold">0</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><span data-translate-key="stats_daily_cycles">Cycles Completed Today</span>: <span id="dailyCycles" class="font-semibold">0</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  _200c_ Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-auto pt-4 text-center stats-bottom-warning">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-slate-400">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-info-circle mr-1"></i><span data-translate-key="storage_warning">Your progress is saved in your browser's local storage. Clearing browser data may delete your progress.</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="dailyGoalContent" class="tab-pane hidden p-2 sm:p-4 bg-slate-700 rounded-b-lg justify-between">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="goalDisplayView" class="h-full flex flex-col">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-base sm:text-lg font-semibold text-sky-300" data-translate-key="daily_goal_title">Today's Goal</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="editGoalButton" class="text-sm text-sky-400 hover:text-sky-300"><i class="fas fa-edit mr-1"></i> <span data-translate-key="edit_goal_button">Edit Goal</span></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="goalProgressContainer" class="bg-slate-600 p-4 rounded-lg mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center justify-between mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="goalText" class="font-semibold text-base leading-tight"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="goalProgressText" class="text-sm text-slate-300"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-full bg-slate-800/70 rounded-full h-3 shadow-inner">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="goalProgressBar" class="h-3 rounded-full"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relative flex-grow min-h-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="goalHistoryChart"></canvas>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="goalEditView" class="hidden h-full flex flex-col items-center justify-center p-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-full max-w-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-lg font-semibold mb-4 text-sky-300 text-center" data-translate-key="set_goal_title">Set Your Daily Goal</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="goalModeSelector" class="goal-mode-selector">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="radio" id="goalModeAllDays" name="goalMode" value="all_days" checked>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="goalModeAllDays" data-translate-key="goal_mode_all">All Days</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="radio" id="goalModeWeekend" name="goalMode" value="weekend">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="goalModeWeekend" data-translate-key="goal_mode_week_weekend">Week/Weekend</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="radio" id="goalModeCustom" name="goalMode" value="custom">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="goalModeCustom" data-translate-key="goal_mode_custom">Custom Days</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="goalInputsAllDays" class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="goalValueInputAll" class="block text-sm font-medium text-slate-300 mb-1" data-translate-key="goal_sessions_per_day">Sessions per day:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="goalValueInputAll" min="1" class="w-full p-2 rounded bg-slate-600 text-white border border-slate-500 focus:ring-sky-500 focus:border-sky-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="goalInputsWeekend" class="hidden space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="goalValueInputWeekday" class="block text-sm font-medium text-slate-300 mb-1" data-translate-key="goal_sessions_weekdays">Sessions on Weekdays:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="goalValueInputWeekday" min="1" class="w-full p-2 rounded bg-slate-600 text-white border border-slate-500 focus:ring-sky-500 focus:border-sky-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="goalValueInputWeekend" class="block text-sm font-medium text-slate-300 mb-1" data-translate-key="goal_sessions_weekends">Sessions on Weekends:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="goalValueInputWeekend" min="1" class="w-full p-2 rounded bg-slate-600 text-white border border-slate-500 focus:ring-sky-500 focus:border-sky-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="goalInputsCustom" class="hidden space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="custom-day-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-end space-x-2 pt-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="cancelGoalButton" class="bg-slate-600 hover:bg-slate-500 text-slate-300 font-bold py-2 px-4 rounded transition-colors" data-translate-key="cancel_button">Cancel</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="saveGoalButton" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition-colors" data-translate-key="save_goal_button">Save Goal</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="achievementsContent" class="tab-pane hidden p-2 sm:p-4 bg-slate-700 rounded-b-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-grow flex flex-col min-h-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-base sm:text-lg font-semibold mb-4 text-sky-300" data-translate-key="achievements_title">Your Achievements</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="achievementsListContainer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="achievementsList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="donation-section mx-auto">
Â  Â  Â  Â  Â  Â  Â <p data-translate-key="donation_text">If you'd like to support this app, you can do so <a href="https://www.buymeacoffee.com/lemonade299792458" target="_blank">here â˜•</a></p>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="settingsModal" class="modal fixed inset-0 bg-black bg-opacity-75 items-center justify-center p-4 z-50 max-h-screen overflow-y-auto md:overflow-y-visible">
Â  Â  Â  Â  <div class="bg-slate-800 p-6 rounded-2xl shadow-2xl w-full max-w-md my-8">
Â  Â  Â  Â  Â  Â  <div class="p-4 bg-slate-700 rounded-lg mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-lg font-semibold mb-3 text-sky-400" data-translate-key="settings_section_timer">Timer Durations</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="studyTimeInput" class="block text-sm font-medium text-slate-300 mb-1" data-translate-key="settings_study_time">Focus Time (minutes):</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="studyTimeInput" min="1" class="w-full p-2 bg-slate-600 border border-slate-500 rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="shortBreakTimeInput" class="block text-sm font-medium text-slate-300 mb-1" data-translate-key="settings_short_break">Short Break (minutes):</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="shortBreakTimeInput" min="1" class="w-full p-2 bg-slate-600 border border-slate-500 rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="longBreakTimeInput" class="block text-sm font-medium text-slate-300 mb-1" data-translate-key="settings_long_break">Long Break (minutes):</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="longBreakTimeInput" min="1" class="w-full p-2 bg-slate-600 border border-slate-500 rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="p-4 bg-slate-700 rounded-lg mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-lg font-semibold mb-3 text-sky-400" data-translate-key="settings_section_prefs">Preferences</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center justify-between">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm font-medium text-slate-300" data-translate-key="settings_enable_sounds">Enable Sounds:</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="relative inline-flex items-center cursor-pointer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="soundToggle" class="sr-only peer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-sky-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-sky-500"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="languageSelect" class="block text-sm font-medium text-slate-300 mb-1" data-translate-key="settings_language">Language:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="languageSelect" class="w-full p-2 bg-slate-600 border border-slate-500 rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="p-4 bg-slate-700 rounded-lg">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-lg font-semibold mb-2 text-sky-400" data-translate-key="settings_data_management">Data Management</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-slate-400 mb-3" data-translate-key="settings_data_info">Save your progress to a file or load it on another device.</p>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="exportDataButton" class="flex-1 px-4 py-2 text-sm font-medium text-white bg-slate-600 hover:bg-slate-500 rounded-md transition-colors flex items-center justify-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-download"></i><span data-translate-key="settings_export_button">Export Data</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="importDataButton" class="flex-1 px-4 py-2 text-sm font-medium text-white bg-slate-600 hover:bg-slate-500 rounded-md transition-colors flex items-center justify-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-upload"></i><span data-translate-key="settings_import_button">Import Data</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="importFileInput" class="hidden" accept=".json">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="mt-6 flex justify-end space-x-3">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="cancelSettingsButton" class="px-4 py-2 text-sm font-medium text-slate-300 bg-slate-600 hover:bg-slate-500 rounded-md transition-colors" data-translate-key="cancel_button">Cancel</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="saveSettingsButton" class="px-4 py-2 text-sm font-medium text-white bg-sky-500 hover:bg-sky-600 rounded-md transition-colors" data-translate-key="save_button">Save Settings</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div id="customAlertModal" class="modal fixed inset-0 bg-black bg-opacity-75 items-center justify-center p-4 z-[100]">
Â  Â  Â  Â  <div id="customAlertContent" class="bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-md text-left">
Â  Â  Â  Â  Â  Â  <div class="flex items-start">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="customAlertIcon" class="text-3xl mr-4 mt-1"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 id="customAlertTitle" class="text-xl font-bold mb-2"></h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="customAlertMessage" class="text-slate-300 mb-6 help-content text-sm"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="customAlertButtons" class="flex justify-end space-x-3">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="customAlertCancelButton" class="px-4 py-2 text-sm font-medium text-slate-300 bg-slate-600 hover:bg-slate-500 rounded-md transition-colors">Cancel</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="customAlertConfirmButton" class="px-4 py-2 text-sm font-medium text-white bg-sky-500 hover:bg-sky-600 rounded-md transition-colors">OK</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div id="toastNotification">
Â  Â  Â  Â  <strong id="toastTitle" class="font-bold"></strong>
Â  Â  Â  Â  <p id="toastBody"></p>
Â  Â  </div>

Â  Â  <script id="timerWorkerScript" type="javascript/worker">
Â  Â  Â  Â  let workerTimeLeft;let workerIsRunning=!1;let workerTimerInterval;let workerCurrentMode;let workerSettings={};function startWorkerTimer(){if(workerIsRunning)return;if(workerTimeLeft<=0){postMessage({type:"end",mode:workerCurrentMode});return}workerIsRunning=!0;workerTimerInterval=setInterval(()=>{if(!workerIsRunning){clearInterval(workerTimerInterval);return}workerTimeLeft--;postMessage({type:"tick",timeLeft:workerTimeLeft,mode:workerCurrentMode});if(workerTimeLeft<=0){clearInterval(workerTimerInterval);workerIsRunning=!1;postMessage({type:"end",mode:workerCurrentMode})}},1e3)}self.onmessage=function(e){const{command:o,mode:t,duration:s,settings:i}=e.data;switch(o){case"start":workerIsRunning||startWorkerTimer();break;case"pause":workerIsRunning=!1;clearInterval(workerTimerInterval);break;case"setMode":workerCurrentMode=t;workerTimeLeft=s;workerIsRunning=!1;clearInterval(workerTimerInterval);postMessage({type:"modeSet",timeLeft:workerTimeLeft,mode:workerCurrentMode});break;case"updateSettings":workerSettings=i;if(!workerIsRunning&&workerCurrentMode){let e;e="study"===workerCurrentMode?workerSettings.studyTime*60:"shortBreak"===workerCurrentMode?workerSettings.shortBreakTime*60:"longBreak"===workerCurrentMode?workerSettings.longBreakTime*60:null;e&&workerTimeLeft!==e&&(workerTimeLeft=e,postMessage({type:"tick",timeLeft:workerTimeLeft,mode:workerCurrentMode}))}}};
Â  Â  </script>

Â  Â  <script>
Â  Â  Â  Â  const baseAchievements = [{id:"days1",type:"totalDaysStudied",threshold:1,icon:"fas fa-seedling"},{id:"days7",type:"totalDaysStudied",threshold:7,icon:"fas fa-calendar-check"},{id:"days15",type:"totalDaysStudied",threshold:15,icon:"fas fa-medal"},{id:"days30",type:"totalDaysStudied",threshold:30,icon:"fas fa-award"},{id:"days50",type:"totalDaysStudied",threshold:50,icon:"fas fa-star"},{id:"days75",type:"totalDaysStudied",threshold:75,icon:"fas fa-running"},{id:"days100",type:"totalDaysStudied",threshold:100,icon:"fas fa-crown"},{id:"days120",type:"totalDaysStudied",threshold:120,icon:"fas fa-book-reader"},{id:"days150",type:"totalDaysStudied",threshold:150,icon:"fas fa-graduation-cap"},{id:"streak3",type:"streak",threshold:3,icon:"fas fa-fire"},{id:"streak7",type:"streak",threshold:7,icon:"fas fa-bolt"},{id:"streak14",type:"streak",threshold:14,icon:"fas fa-dumbbell"},{id:"streak30",type:"streak",threshold:30,icon:"fas fa-calendar-alt"},{id:"streak50",type:"streak",threshold:50,icon:"fas fa-shield-alt"},{id:"cycles1",type:"totalCyclesCompleted",threshold:1,icon:"fas fa-flag-checkered"},{id:"cycles10",type:"totalCyclesCompleted",threshold:10,icon:"fas fa-history"},{id:"cycles25",type:"totalCyclesCompleted",threshold:25,icon:"fas fa-cogs"},{id:"cycles50",type:"totalCyclesCompleted",threshold:50,icon:"fas fa-rocket"},{id:"cycles100",type:"totalCyclesCompleted",threshold:100,icon:"fas fa-gem"},{id:"hours1",type:"totalPureStudyHours",threshold:1,icon:"fas fa-hourglass-start"},{id:"hours10",type:"totalPureStudyHours",threshold:10,icon:"fas fa-brain"},{id:"hours50",type:"totalPureStudyHours",threshold:50,icon:"fas fa-microscope"},{id:"hours100",type:"totalPureStudyHours",threshold:100,icon:"fas fa-university"},{id:"sb_hours_1",type:"totalShortBreakSeconds",threshold:3600,icon:"fas fa-coffee"},{id:"sb_hours_5",type:"totalShortBreakSeconds",threshold:18e3,icon:"fas fa-mug-hot"},{id:"sb_hours_15",type:"totalShortBreakSeconds",threshold:54e3,icon:"fas fa-couch"},{id:"lb_hours_3",type:"totalLongBreakSeconds",threshold:10800,icon:"fas fa-bed"},{id:"lb_hours_10",type:"totalLongBreakSeconds",threshold:36e3,icon:"fas fa-battery-full"},{id:"lb_hours_25",type:"totalLongBreakSeconds",threshold:9e4,icon:"fas fa-umbrella-beach"},{id:"dailySessions5",type:"dailyFocusSessions",threshold:5,icon:"fas fa-bolt"},{id:"dailySessions10",type:"dailyFocusSessions",threshold:10,icon:"fas fa-rocket"},{id:"dailyCycles3",type:"dailyCyclesCompleted",threshold:3,icon:"fas fa-cogs"},{id:"dailyHours6",type:"dailyPureStudyHours",threshold:6,icon:"fas fa-brain"}];
Â  Â  Â  Â  const translations = {
Â  Â  Â  Â  Â  Â  en: {
Â  Â  Â  Â  Â  Â  Â  Â  app_title: "PomodoroCycle Timer", goal_mode_all: "All Days", goal_mode_week_weekend: "Week/Weekend", goal_mode_custom: "Custom Days", goal_sessions_per_day: "Sessions per day:", goal_sessions_weekdays: "Sessions on Weekdays:", goal_sessions_weekends: "Sessions on Weekends:", toast_goal_too_long_title: "Goal Exceeds 24 Hours", toast_goal_too_long_body: "A daily goal cannot exceed 24 hours of focus time. Please adjust your values.", help_tooltip:"Help / How to Use",settings_tooltip:"Settings",current_timer_label:"Current Timer:",mode_study:"Focus",mode_short_break:"Short Break",mode_long_break:"Long Break",cycle_tooltip:"Focus Sessions in Current Cycle",reset_cycle_tooltip:"Reset Cycle",skip_break_button:"Skip Break",start_button:"Start",pause_button:"Pause",resume_button:"Resume",reset_current_button:"Reset Current",tab_stats:"Statistics",tab_daily_goal:"Daily Goal",tab_achievements:"Achievements",stats_title:"Your Statistics",stats_streak:"Daily Streak",stats_daily_title:"Daily:",stats_daily_total_time:"Total Time Today",stats_daily_focus_sessions:"Focus Sessions Today",stats_daily_cycles:"Cycles Completed Today",stats_daily_study_time:"Focus Time Today",stats_general_title:"General:",stats_general_cycles:"Total Cycles Completed",stats_general_sessions:"Total Focus Sessions",stats_general_study_time:"Total Focus Time",stats_general_days:"Total Focus Days",storage_warning:"Your progress is saved in your browser's local storage. Clearing browser data may delete your progress.",donation_text:"If you'd like to support this app, you can do so {0}",donation_link_text:"here â˜•",settings_title:"Timer Settings",settings_section_timer:"Timer Durations",settings_section_prefs:"Preferences",settings_study_time:"Focus Time (minutes):",settings_short_break:"Short Break (minutes):",settings_long_break:"Long Break (minutes):",settings_language:"Language:",settings_enable_sounds:"Enable Sounds:",settings_data_management:"Data Management",settings_data_info:"Save your progress to a file or load it on another device.",settings_export_button:"Export Data",settings_import_button:"Import Data",cancel_button:"Cancel",save_button:"Save Settings",save_goal_button:"Save Goal",confirm_button:"Confirm",ok_button:"OK",got_it_button:"Got it!",new_badge:"NEW!",unlocked_on_date:"Unlocked on: {0}",progress_label:"Progress",chart_target_label:"Target",daily_goal_title:"Today's Goal",edit_goal_button:"Edit Goal",set_goal_button:"Set Goal",set_goal_title:"Set Your Daily Goal",no_goal_set:"No goal set for today.",goal_type_label:"Goal Type:",goal_type_sessions:"Focus Sessions",goal_type_cycles:"Completed Cycles",goal_value_label:"Target Value:",goal_completed_toast_title:"Goal Achieved!",goal_completed_toast_body:"Congratulations! You've reached your daily goal!",toast_goal_saved_body:"Your new daily goals have been saved.",achievements_title:"Your Achievements",toast_error_title:"Error",toast_goal_error:"Please enter a valid target value (must be a number greater than 0).",toast_settings_saved_title:"Settings Saved",toast_settings_saved_body:"Your new timer durations have been applied.",toast_achievement_unlocked_title:"Achievement Unlocked!",toast_achievement_unlocked_body:'You unlocked the achievement: "{0}"!',toast_study_complete_title:"Focus Session Complete!",toast_study_complete_body:"Time for a break. Good job!",toast_break_over_title:"Break Over!",toast_break_over_body:"Time to get back to focus!",toast_long_break_over_title:"Long Break Over!",toast_long_break_over_body:"Cycle complete! Ready for a new one?",toast_cycle_complete_title:"Cycle Complete!",toast_cycle_complete_body:"Congratulations! You've completed a full Pomodoro cycle.",toast_new_day_title:"A New Day!",toast_new_day_body:"Your daily statistics have been reset.",toast_import_success_title:"Import Successful",toast_import_success_body:"Your progress has been restored. The page will now reload.",toast_import_error_title:"Import Failed",toast_import_error_body:"The selected file is not a valid backup file or is corrupted.",alert_reset_cycle_title:"Confirm Reset",alert_reset_cycle_body:"Are you sure you want to reset the current cycle? This will set the focus session to 1/4.",alert_help_title:"How This Pomodoro Timer Works",alert_help_body:'<p class="mb-3">The <strong>Pomodoro Technique</strong> is a time management method that uses a timer to break down work into intervals, traditionally 25 minutes in length, separated by short breaks.</p><p class="mb-1 font-semibold">The timer\'s cycle:</p><ul><li>1. Focus Session (e.g., 25 min)</li><li class="break-session" style="padding-left: 35px;">Short Break (e.g., 5 min)</li><li>2. Focus Session</li><li class="break-session" style="padding-left: 35px;">Short Break</li><li>3. Focus Session</li><li class="break-session" style="padding-left: 35px;">Short Break</li><li>4. Focus Session (completes 1 cycle)</li><li class="break-session" style="padding-left: 35px;">Long Break (e.g., 15 min)</li></ul><p class="mb-3">Focus sessions and breaks begin automatically. After the long break, however, you\'ll need to start the new cycle manually.</p><p class="mb-3">The daily streak only increases after completing the first session of the day.</p><p>Reset the cycle using the <i class=\'fas fa-sync-alt fa-xs\'></i> button.</p>',alert_import_title:"Import Progress?",alert_import_body:"This will overwrite all your current progress, achievements, and settings. This action cannot be undone. Are you sure you want to continue?",alert_goal_type_change_title:"Change Goal Type?",alert_goal_type_change_body:"Changing the goal type will reset your goal history chart for the past 7 days to provide a clean slate for the new metric. Are you sure you want to proceed?",today_label:"Today",achievements:{"days1":{name:"Focused Beginner",description:"Complete your first day of focus."},"days7":{name:"Weekly Commitment",description:"Focus for 7 days."},"days15":{name:"Fortnightly Focus",description:"Focus for 15 days."},"days30":{name:"Monthly Landmark",description:"Focus for 30 days."},"days50":{name:"Shooting Star",description:"Focus for 50 days."},"days75":{name:"Focus Marathoner",description:"Focus for 75 days."},"days100":{name:"Habit Master",description:"Focus for 100 days."},"days120":{name:"Focus Legend",description:"Focus for 120 days."},"days150":{name:"Focus Sage",description:"Focus for 150 days."},"streak3":{name:"3-Day Combo!",description:"Maintain a 3-day daily streak."},"streak7":{name:"A Week Streak",description:"Maintain a 7-day daily streak."},"streak14":{name:"Habit Power-Up",description:"Maintain a 14-day daily streak."},"streak30":{name:"Unstoppable",description:"Maintain a 30-day daily streak."},"streak50":{name:"True Dedication",description:"Maintain a 50-day daily streak."},"cycles1":{name:"First Full Cycle",description:"Complete 1 Pomodoro cycle."},"cycles10":{name:"Ten Cycles of Focus",description:"Complete 10 Pomodoro cycles."},"cycles25":{name:"Productivity Pro",description:"Complete 25 Pomodoro cycles."},"cycles50":{name:"To The Moon",description:"Complete 50 Pomodoro cycles."},"cycles100":{name:"Cycle Centurion",description:"Complete 100 Pomodoro cycles."},"hours1":{name:"First Hour of Focus",description:"Accumulate 1 hour of focus."},"hours10":{name:"Immersive Thinker",description:"Accumulate 10 hours of focus."},"hours50":{name:"Knowledge Fountain",description:"Accumulate 50 hours of focus."},"hours100":{name:"Focus Scholar",description:"Accumulate 100 hours of focus."},"sb_hours_1":{name:"Quick Breather",description:"Accumulate 1 hour in short breaks."},"sb_hours_5":{name:"Relaxation Adept",description:"Accumulate 5 hours in short breaks."},"sb_hours_15":{name:"Short Break Pro",description:"Accumulate 15 hours in short breaks."},"lb_hours_3":{name:"Well Deserved Rest",description:"Accumulate 3 hours in long breaks."},"lb_hours_10":{name:"Recharge Master",description:"Accumulate 10 hours in long breaks."},"lb_hours_25":{name:"Leisure Expert",description:"Accumulate 25 hours in long breaks."},"dailySessions5":{name:"Daily Sprinter",description:"5 focus sessions in one day."},"dailySessions10":{name:"Focus Machine",description:"10 focus sessions in one day."},"dailyCycles3":{name:"Tricycler",description:"3 full cycles in one day."},"dailyHours6":{name:"Deep Work",description:"6 focus hours in one day."}},goal_text:{focusSessions_one:"{0} Focus Session",focusSessions_other:"{0} Focus Sessions",completedCycles_one:"{0} Cycle",completedCycles_other:"{0} Cycles"}},
Â  Â  Â  Â  Â  Â  'pt-BR': {
Â  Â  Â  Â  Â  Â  Â  Â  app_title: "PomodoroCycle Timer", goal_mode_all: "Todos os Dias", goal_mode_week_weekend: "Semana/Fim de Semana", goal_mode_custom: "Dias Customizados", goal_sessions_per_day: "SessÃµes por dia:", goal_sessions_weekdays: "SessÃµes na Semana:", goal_sessions_weekends: "SessÃµes no Fim de Semana:", toast_goal_too_long_title: "Meta Excede 24 Horas", toast_goal_too_long_body: "A meta diÃ¡ria nÃ£o pode exceder 24h de foco. Por favor, ajuste os valores.", help_tooltip:"Ajuda / Como Usar",settings_tooltip:"ConfiguraÃ§Ãµes",current_timer_label:"Timer Atual:",mode_study:"Foco",mode_short_break:"Pausa Curta",mode_long_break:"Pausa Longa",cycle_tooltip:"SessÃµes de foco no ciclo atual",reset_cycle_tooltip:"Reiniciar Ciclo",skip_break_button:"Pular Pausa",start_button:"Iniciar",pause_button:"Pausar",resume_button:"Retomar",reset_current_button:"Resetar Atual",tab_stats:"EstatÃ­sticas",tab_daily_goal:"Meta DiÃ¡ria",tab_achievements:"Conquistas",stats_title:"Suas EstatÃ­sticas",stats_streak:"SequÃªncia DiÃ¡ria",stats_daily_title:"Hoje:",stats_daily_total_time:"Tempo Total Hoje",stats_daily_focus_sessions:"SessÃµes de Foco Hoje",stats_daily_cycles:"Ciclos Completos Hoje",stats_daily_study_time:"Tempo de Foco Hoje",stats_general_title:"Geral:",stats_general_cycles:"Total de Ciclos Completos",stats_general_sessions:"Total de SessÃµes de Foco",stats_general_study_time:"Total de Tempo de Foco",stats_general_days:"Total de Dias de Foco",storage_warning:"Seu progresso Ã© salvo no armazenamento local do navegador. Limpar os dados pode apagar seu progresso.",donation_text:"Se quiser apoiar este app, vocÃª pode fazÃª-lo {0}",donation_link_text:"aqui â˜•",settings_title:"ConfiguraÃ§Ãµes do Timer",settings_section_timer:"DuraÃ§Ãµes do Timer",settings_section_prefs:"PreferÃªncias",settings_study_time:"Tempo de Foco (minutos):",settings_short_break:"Pausa Curta (minutos):",settings_long_break:"Pausa Longa (minutos):",settings_language:"Idioma:",settings_enable_sounds:"Habilitar Sons:",settings_data_management:"GestÃ£o de Dados",settings_data_info:"Salve seu progresso em um arquivo ou carregue-o em outro dispositivo.",settings_export_button:"Exportar Dados",settings_import_button:"Importar Dados",cancel_button:"Cancelar",save_button:"Salvar",save_goal_button:"Salvar Meta",confirm_button:"Confirmar",ok_button:"OK",got_it_button:"Entendi!",new_badge:"NOVO!",unlocked_on_date:"Desbloqueado em: {0}",progress_label:"Progresso",chart_target_label:"Meta",daily_goal_title:"Meta de Hoje",edit_goal_button:"Editar Meta",set_goal_button:"Definir Meta",set_goal_title:"Defina Sua Meta DiÃ¡ria",no_goal_set:"Nenhuma meta definida para hoje.",goal_type_label:"Tipo de Meta:",goal_type_sessions:"SessÃµes de Foco",goal_type_cycles:"Ciclos Completos",goal_value_label:"Valor Alvo:",goal_completed_toast_title:"Meta AlcanÃ§ada!",goal_completed_toast_body:"ParabÃ©ns! VocÃª atingiu sua meta diÃ¡ria!",toast_goal_saved_body:"Suas novas metas diÃ¡rias foram salvas.",achievements_title:"Suas Conquistas",toast_error_title:"Erro",toast_goal_error:"Por favor, insira um valor alvo vÃ¡lido (deve ser um nÃºmero maior que 0).",toast_settings_saved_title:"ConfiguraÃ§Ãµes Salvas",toast_settings_saved_body:"As novas duraÃ§Ãµes do timer foram aplicadas.",toast_achievement_unlocked_title:"Conquista Desbloqueada!",toast_achievement_unlocked_body:'VocÃª desbloqueou a conquista: "{0}"!',toast_study_complete_title:"SessÃ£o de Foco Completa!",toast_study_complete_body:"Hora de uma pausa. Bom trabalho!",toast_break_over_title:"Pausa Terminada!",toast_break_over_body:"Hora de voltar ao foco!",toast_long_break_over_title:"Pausa Longa Terminada!",toast_long_break_over_body:"Ciclo completo! Pronto para um novo?",toast_cycle_complete_title:"Ciclo Completo!",toast_cycle_complete_body:"ParabÃ©ns! VocÃª completou um ciclo Pomodoro.",toast_new_day_title:"Um Novo Dia!",toast_new_day_body:"Suas estatÃ­sticas diÃ¡rias foram reiniciadas.",toast_import_success_title:"ImportaÃ§Ã£o ConcluÃ­da",toast_import_success_body:"Seu progresso foi restaurado. A pÃ¡gina serÃ¡ recarregada.",toast_import_error_title:"Falha na ImportaÃ§Ã£o",toast_import_error_body:"O arquivo selecionado nÃ£o Ã© um backup vÃ¡lido ou estÃ¡ corrompido.",alert_reset_cycle_title:"Confirmar ReinÃ­cio",alert_reset_cycle_body:"Tem certeza que quer reiniciar o ciclo atual? A sessÃ£o de foco voltarÃ¡ para 1/4.",alert_help_title:"Como o Timer Pomodoro Funciona",alert_help_body:'<p class="mb-3">A <strong>TÃ©cnica Pomodoro</strong> Ã© um mÃ©todo de gerenciamento de tempo que usa um timer para dividir o trabalho em intervalos, tradicionalmente de 25 minutos, separados por pausas curtas.</p><p class="mb-1 font-semibold">O ciclo deste timer:</p><ul><li>1. SessÃ£o de Foco (ex: 25 min)</li><li class="break-session" style="padding-left: 35px;">Pausa Curta (ex: 5 min)</li><li>2. SessÃ£o de Foco</li><li class="break-session" style="padding-left: 35px;">Pausa Curta</li><li>3. SessÃ£o de Foco</li><li class="break-session" style="padding-left: 35px;">Pausa Curta</li><li>4. SessÃ£o de Foco (completa 1 ciclo)</li><li class="break-session" style="padding-left: 35px;">Pausa Longa (ex: 15 min)</li></ul><p class="mb-3">As sessÃµes de foco e pausas comeÃ§am automaticamente. ApÃ³s a pausa longa, no entanto, vocÃª precisarÃ¡ iniciar o novo ciclo manualmente.</p><p class="mb-3">A sequÃªncia diÃ¡ria sÃ³ aumenta apÃ³s completar a primeira sessÃ£o de foco do dia.</p><p>Reinicie o ciclo usando o botÃ£o <i class=\'fas fa-sync-alt fa-xs\'></i>.</p>',alert_import_title:"Importar Progresso?",alert_import_body:"Isso irÃ¡ sobrescrever todo o seu progresso, conquistas e configuraÃ§Ãµes atuais. Esta aÃ§Ã£o nÃ£o pode ser desfeita. VocÃª tem certeza que deseja continuar?",alert_goal_type_change_title:"Mudar tipo de meta?",alert_goal_type_change_body:"Mudar o tipo da meta irÃ¡ reiniciar o histÃ³rico do seu grÃ¡fico dos Ãºltimos 7 dias para uma melhor visualizaÃ§Ã£o da nova mÃ©trica. Tem certeza que deseja prosseguir?",today_label:"Hoje",achievements:{"days1":{name:"Iniciante Focado",description:"Complete seu primeiro dia de foco."},"days7":{name:"Compromisso Semanal",description:"Foque por 7 dias."},"days15":{name:"Foco Quinzenal",description:"Foque por 15 dias."},"days30":{name:"Marco Mensal",description:"Foque por 30 dias."},"days50":{name:"Estrela Cadente",description:"Foque por 50 dias."},"days75":{name:"Maratonista do Foco",description:"Foque por 75 dias."},"days100":{name:"Mestre do HÃ¡bito",description:"Foque por 100 dias."},"days120":{name:"Lenda do Foco",description:"Foque por 120 dias."},"days150":{name:"SÃ¡bio do Foco",description:"Foque por 150 dias."},"streak3":{name:"Combo de 3 Dias!",description:"Mantenha uma sequÃªncia de 3 dias."},"streak7":{name:"SequÃªncia Semanal",description:"Mantenha uma sequÃªncia de 7 dias."},"streak14":{name:"HÃ¡bito Turbinado",description:"Mantenha uma sequÃªncia de 14 dias."},"streak30":{name:"ImparÃ¡vel",description:"Mantenha uma sequÃªncia de 30 dias."},"streak50":{name:"DedicaÃ§Ã£o Pura",description:"Mantenha uma sequÃªncia de 50 dias."},"cycles1":{name:"Primeiro Ciclo",description:"Complete 1 ciclo Pomodoro."},"cycles10":{name:"Dez Ciclos de Foco",description:"Complete 10 ciclos Pomodoro."},"cycles25":{name:"Pro da Produtividade",description:"Complete 25 ciclos Pomodoro."},"cycles50":{name:"Para a Lua",description:"Complete 50 ciclos Pomodoro."},"cycles100":{name:"CenturiÃ£o de Ciclos",description:"Complete 100 ciclos Pomodoro."},"hours1":{name:"Primeira Hora de Foco",description:"Acumule 1 hora de foco."},"hours10":{name:"Pensador Imersivo",description:"Acumule 10 horas de foco."},"hours50":{name:"Fonte de Sabedoria",description:"Acumule 50 horas de foco."},"hours100":{name:"Erudito do Foco",description:"Acumule 100 horas de foco."},"sb_hours_1":{name:"Respiro RÃ¡pido",description:"Acumule 1 hora em pausas curtas."},"sb_hours_5":{name:"Mestre do Relax",description:"Acumule 5 horas em pausas curtas."},"sb_hours_15":{name:"CampeÃ£o da Pausa",description:"Acumule 15 horas em pausas curtas."},"lb_hours_3":{name:"Descanso Merecido",description:"Acumule 3 horas em pausas longas."},"lb_hours_10":{name:"Mestre da Recarga",description:"Acumule 10 horas em pausas longas."},"lb_hours_25":{name:"Expert do Lazer",description:"Acumule 25 horas em pausas longas."},"dailySessions5":{name:"Velocista DiÃ¡rio",description:"5 sessÃµes de foco em um dia."},"dailySessions10":{name:"MÃ¡quina de Foco",description:"10 sessÃµes de foco em um dia."},"dailyCycles3":{name:"Triciclista",description:"3 ciclos completos em um dia."},"dailyHours6":{name:"Trabalho Intenso",description:"6 horas de foco em um dia."}},goal_text:{focusSessions_one:"{0} SessÃ£o de Foco",focusSessions_other:"{0} SessÃµes de Foco",completedCycles_one:"{0} Ciclo",completedCycles_other:"{0} Ciclos"}}
Â  Â  Â  Â  };

Â  Â  Â  Â  const timerTextEl = document.getElementById('timerText');
Â  Â  Â  Â  const modePillEl = document.getElementById('modePill');
Â  Â  Â  Â  const cycleDotsContainerEl = document.getElementById('cycleDotsContainer');
Â  Â  Â  Â  const resetButton = document.getElementById('resetButton');
Â  Â  Â  Â  const resetCycleCountButtonEl = document.getElementById('resetCycleCountButton');
Â  Â  Â  Â  const startPauseButton = document.getElementById('startPauseButton');
Â  Â  Â  Â  const skipBreakButton = document.getElementById('skipBreakButton');
Â  Â  Â  Â  const settingsButton = document.getElementById('settingsButton');
Â  Â  Â  Â  const helpButton = document.getElementById('helpButton');
Â  Â  Â  Â  const settingsModal = document.getElementById('settingsModal');
Â  Â  Â  Â  const saveSettingsButton = document.getElementById('saveSettingsButton');
Â  Â  Â  Â  const cancelSettingsButton = document.getElementById('cancelSettingsButton');
Â  Â  Â  Â  const studyTimeInput = document.getElementById('studyTimeInput');
Â  Â  Â  Â  const shortBreakTimeInput = document.getElementById('shortBreakTimeInput');
Â  Â  Â  Â  const longBreakTimeInput = document.getElementById('longBreakTimeInput');
Â  Â  Â  Â  const languageSelect = document.getElementById('languageSelect');
Â  Â  Â  Â  const soundToggle = document.getElementById('soundToggle');
Â  Â  Â  Â  const exportDataButton = document.getElementById('exportDataButton');
Â  Â  Â  Â  const importDataButton = document.getElementById('importDataButton');
Â  Â  Â  Â  const importFileInput = document.getElementById('importFileInput');
Â  Â  Â  Â  const tabButtons = document.querySelectorAll('.tab-button');
Â  Â  Â  Â  const tabPanes = document.querySelectorAll('.tab-pane');
Â  Â  Â  Â  const tabContentEl = document.getElementById('tabContent');
Â  Â  Â  Â  const collapseTabsButton = document.getElementById('collapseTabsButton');
Â  Â  Â  Â  const collapseIcon = document.getElementById('collapseIcon');
Â  Â  Â  Â  const dailyFocusSessionsEl = document.getElementById('dailyFocusSessions');
Â  Â  Â  Â  const dailyCyclesEl = document.getElementById('dailyCycles');
Â  Â  Â  Â  const dailyStudyTimeEl = document.getElementById('dailyStudyTime');
Â  Â  Â  Â  const dailyTotalTimeEl = document.getElementById('dailyTotalTime');
Â  Â  Â  Â  const totalFocusSessionsEl = document.getElementById('totalFocusSessions');
Â  Â  Â  Â  const totalDaysStudiedEl = document.getElementById('totalDaysStudied');
Â  Â  Â  Â  const totalCyclesEl = document.getElementById('totalCycles');
Â  Â  Â  Â  const totalStudyTimeEl = document.getElementById('totalStudyTime');
Â  Â  Â  Â  const streakCounterHeaderEl = document.getElementById('streakCounterHeader');
Â  Â  Â  Â  const streakFireIconContainerEl = document.getElementById('streakFireIconContainer');
Â  Â  Â  Â  const achievementsListEl = document.getElementById('achievementsList');
Â  Â  Â  Â  const customAlertModal = document.getElementById('customAlertModal');
Â  Â  Â  Â  const customAlertContentEl = document.getElementById('customAlertContent');
Â  Â  Â  Â  const customAlertIconEl = document.getElementById('customAlertIcon');
Â  Â  Â  Â  const customAlertTitleEl = document.getElementById('customAlertTitle');
Â  Â  Â  Â  const customAlertMessageEl = document.getElementById('customAlertMessage');
Â  Â  Â  Â  const customAlertConfirmButton = document.getElementById('customAlertConfirmButton');
Â  Â  Â  Â  const customAlertCancelButton = document.getElementById('customAlertCancelButton');
Â  Â  Â  Â  const customAlertButtonsContainer = document.getElementById('customAlertButtons');
Â  Â  Â  Â  const faviconEl = document.getElementById('favicon');
Â  Â  Â  Â  const toastNotificationEl = document.getElementById('toastNotification');
Â  Â  Â  Â  const toastTitleEl = document.getElementById('toastTitle');
Â  Â  Â  Â  const toastBodyEl = document.getElementById('toastBody');
Â  Â  Â  Â  const rewardsTabBadgeEl = document.getElementById('rewardsTabBadge');
Â  Â  Â  Â  const achievementsTabBadgeEl = document.getElementById('achievementsTabBadge');
Â  Â  Â  Â  const languageModal = document.getElementById('languageModal');
Â  Â  Â  Â  const languageButtonsContainer = document.getElementById('languageButtonsContainer');
Â  Â  Â  Â  const appContainer = document.getElementById('app-container');
Â  Â  Â  Â  const goalDisplayView = document.getElementById('goalDisplayView');
Â  Â  Â  Â  const goalEditView = document.getElementById('goalEditView');
Â  Â  Â  Â  const editGoalButton = document.getElementById('editGoalButton');
Â  Â  Â  Â  const saveGoalButton = document.getElementById('saveGoalButton');
Â  Â  Â  Â  const cancelGoalButton = document.getElementById('cancelGoalButton');
Â  Â  Â  Â  const goalProgressContainer = document.getElementById('goalProgressContainer');
Â  Â  Â  Â  const goalTextEl = document.getElementById('goalText');
Â  Â  Â  Â  const goalProgressTextEl = document.getElementById('goalProgressText');
Â  Â  Â  Â  const goalProgressBarEl = document.getElementById('goalProgressBar');
Â  Â  Â  Â  const goalHistoryChartCanvas = document.getElementById('goalHistoryChart');

Â  Â  Â  Â  let goalHistoryChart;
Â  Â  Â  Â  const POMODOROS_PER_CYCLE = 4;
Â  Â  Â  Â  let lastSoundScheduledTime = 0;
Â  Â  Â  Â  const MIN_SOUND_INTERVAL = 0.05, SOUND_BASE_DELAY = 0.05;
Â  Â  Â  Â  let justSeenAchievementIds = [];
Â  Â  Â  Â  let blockUnloadSave = false;
Â  Â  Â  Â  let currentTimerInitialDuration = 0;
Â  Â  Â  Â  let activeTabId = 'stats';
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- INÃCIO DO BLOCO DE SCRIPT COMPLETO ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  function getTodayDateString() {
Â  Â  Â  Â  Â  Â  const today = new Date();
Â  Â  Â  Â  Â  Â  return `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
Â  Â  Â  Â  }

Â  Â  Â  Â  function getDefaultAppData() {
Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  settings: { studyTime: 25, shortBreakTime: 5, longBreakTime: 15, soundEnabled: true, language: 'en' },
Â  Â  Â  Â  Â  Â  Â  Â  timerState: { currentMode: "study", timeLeft: 25 * 60, isRunning: false, pomodorosInCycle: 0, lastTimerUsed: null },
Â  Â  Â  Â  Â  Â  Â  Â  stats: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  daily: { date: getTodayDateString(), focusSessions: 0, cyclesCompleted: 0, pureStudySeconds: 0, totalTimeSeconds: 0, firstStudySessionCompletedToday: false },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  general: { totalDaysStudied: 0, totalCyclesCompleted: 0, totalFocusSessions: 0, totalPureStudySeconds: 0, streak: 0, lastStudyDate: null, totalShortBreakSeconds: 0, totalLongBreakSeconds: 0 },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  goalHistory: []
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  dailyGoal: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  settings: { mode: 'all_days', targetAll: 4, targetWeekday: 4, targetWeekend: 2, targetsCustom: [2, 4, 4, 4, 4, 4, 2] },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  target: 0, progress: 0, completed: false, notificationShown: false
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  achievements: [],
Â  Â  Â  Â  Â  Â  Â  Â  uiState: { newAchievementsCount: 0, tabsCollapsed: false },
Â  Â  Â  Â  Â  Â  Â  Â  appVersion: "3.7.1"
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }

Â  Â  Â  Â  let appData = getDefaultAppData();
Â  Â  Â  Â  let synth;
Â  Â  Â  Â  if (typeof Tone !== 'undefined') {
Â  Â  Â  Â  Â  Â  synth = new Tone.Synth().toDestination();
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.warn("Tone.js not loaded. Sound effects will be disabled.");
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function playSound(note = 'C4', duration = '8n', type = 'timerComplete') {
Â  Â  Â  Â  Â  Â  if (!appData.settings.soundEnabled || !synth) return;
Â  Â  Â  Â  Â  Â  if (Tone.context.state !== 'running') {
Â  Â  Â  Â  Â  Â  Â  Â  Tone.context.resume().catch(e => console.error("Error resuming AudioContext:", e));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (Tone.Transport.state !== "started") {
Â  Â  Â  Â  Â  Â  Â  Â  Tone.Transport.start();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  let soundNote = note, soundDuration = duration, soundVolume = 0;
Â  Â  Â  Â  Â  Â  Â  Â  if (type === 'achievement') { soundNote = "C5"; soundDuration = "4n"; soundVolume = -6; }
Â  Â  Â  Â  Â  Â  Â  Â  else if (type === 'goal') { soundNote = "E5"; soundDuration = "4n"; soundVolume = -6; }
Â  Â  Â  Â  Â  Â  Â  Â  const currentTime = Tone.now();
Â  Â  Â  Â  Â  Â  Â  Â  const scheduledTime = Math.max(currentTime + SOUND_BASE_DELAY, lastSoundScheduledTime + MIN_SOUND_INTERVAL);
Â  Â  Â  Â  Â  Â  Â  Â  lastSoundScheduledTime = scheduledTime;
Â  Â  Â  Â  Â  Â  Â  Â  synth.volume.setValueAtTime(soundVolume, scheduledTime);
Â  Â  Â  Â  Â  Â  Â  Â  synth.triggerAttackRelease(soundNote, soundDuration, scheduledTime);
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error(`Error playing sound (type: ${type}):`, error);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function formatTime(seconds) {
Â  Â  Â  Â  Â  Â  const mins = Math.floor(seconds / 60);
Â  Â  Â  Â  Â  Â  const secs = seconds % 60;
Â  Â  Â  Â  Â  Â  return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function formatHoursMinutes(totalSeconds) {
Â  Â  Â  Â  Â  Â  const hours = Math.floor(totalSeconds / 3600);
Â  Â  Â  Â  Â  Â  const minutes = Math.floor((totalSeconds % 3600) / 60);
Â  Â  Â  Â  Â  Â  return `${hours}h ${minutes}m`;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function getText(key, ...args) {
Â  Â  Â  Â  Â  Â  const lang = appData.settings.language || 'en';
Â  Â  Â  Â  Â  Â  let text = (translations[lang] && translations[lang][key]) || translations['en'][key];
Â  Â  Â  Â  Â  Â  if (!text) {
Â  Â  Â  Â  Â  Â  Â  Â  for (const langKey in translations) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (translations[langKey] && translations[langKey][key]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text = translations[langKey][key];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (!text) return key;
Â  Â  Â  Â  Â  Â  if (args.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  args.forEach((arg, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text = text.replace(`{${index}}`, arg);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return text;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function getPluralText(key, count) {
Â  Â  Â  Â  Â  Â  const lang = appData.settings.language || 'en';
Â  Â  Â  Â  Â  Â  const rules = new Intl.PluralRules(lang);
Â  Â  Â  Â  Â  Â  const pluralCategory = rules.select(count);
Â  Â  Â  Â  Â  Â  const keyToUse = `${key}_${pluralCategory}`;
Â  Â  Â  Â  Â  Â  let text = (translations[lang]?.goal_text?.[keyToUse]) || (translations['en']?.goal_text?.[keyToUse]);
Â  Â  Â  Â  Â  Â  if (!text) text = (translations[lang]?.goal_text?.[`${key}_other`]) || (translations['en']?.goal_text?.[`${key}_other`]);
Â  Â  Â  Â  Â  Â  if (!text) return `${count} ${key}`;
Â  Â  Â  Â  Â  Â  return text.replace(`{0}`, count);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function applyTranslations() {
Â  Â  Â  Â  Â  Â  document.documentElement.lang = appData.settings.language || 'en';
Â  Â  Â  Â  Â  Â  document.title = getText('app_title');
Â  Â  Â  Â  Â  Â  document.querySelectorAll('[data-translate-key]').forEach(el => {
Â  Â  Â  Â  Â  Â  Â  Â  const key = el.dataset.translateKey;
Â  Â  Â  Â  Â  Â  Â  Â  const translation = getText(key);
Â  Â  Â  Â  Â  Â  Â  Â  if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (el.placeholder) el.placeholder = translation;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (el.title) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.title = translation;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const targetEl = el.querySelector('span') || el;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(targetEl && targetEl.innerHTML !== translation) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  targetEl.innerHTML = translation;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  const donationEl = document.querySelector('[data-translate-key="donation_text"]');
Â  Â  Â  Â  Â  Â  if(donationEl) {
Â  Â  Â  Â  Â  Â  Â  Â  const linkHtml = `<a href="https://www.buymeacoffee.com/lemonade299792458" target="_blank" class="donation-section-link">${getText('donation_link_text')}</a>`;
Â  Â  Â  Â  Â  Â  Â  Â  donationEl.innerHTML = getText('donation_text', linkHtml);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const STORAGE_KEY = 'pomodoroGamifiedAppData_v3';
Â  Â  Â  Â  function buildAchievements(lang, savedAchievements = []) {
Â  Â  Â  Â  Â  Â const achievementTexts = (translations[lang] && translations[lang].achievements) ? translations[lang].achievements : translations['en'].achievements;
Â  Â  Â  Â  Â  Â return baseAchievements.map(baseAch => {
Â  Â  Â  Â  Â  Â  Â  Â const userAchData = savedAchievements.find(ua => ua.id === baseAch.id) || {};
Â  Â  Â  Â  Â  Â  Â  Â const translatedText = achievementTexts[baseAch.id] || { name: baseAch.id, description: '' };
Â  Â  Â  Â  Â  Â  Â  Â return {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ...baseAch, name: translatedText.name, description: translatedText.description,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â unlocked: userAchData.unlocked || false, unlockedDate: userAchData.unlockedDate || null, seen: userAchData.seen || (userAchData.unlocked || false)
Â  Â  Â  Â  Â  Â  Â  Â };
Â  Â  Â  Â  Â  Â });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function isObject(item) {
Â  Â  Â  Â  Â  Â  return (item && typeof item === 'object' && !Array.isArray(item));
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function mergeDeep(target, ...sources) {
Â  Â  Â  Â  Â  Â  if (!sources.length) return target;
Â  Â  Â  Â  Â  Â  const source = sources.shift();
Â  Â  Â  Â  Â  Â  if (isObject(target) && isObject(source)) {
Â  Â  Â  Â  Â  Â  Â  Â  for (const key in source) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isObject(source[key])) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!target[key]) Object.assign(target, { [key]: {} });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mergeDeep(target[key], source[key]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Object.assign(target, { [key]: source[key] });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return mergeDeep(target, ...sources);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function sanitizeLoadedData(data) {
Â  Â  Â  Â  Â  Â  const stats = data.stats;
Â  Â  Â  Â  Â  Â  stats.daily.focusSessions=parseInt(stats.daily.focusSessions)||0;
Â  Â  Â  Â  Â  Â  stats.daily.cyclesCompleted=parseInt(stats.daily.cyclesCompleted)||0;
Â  Â  Â  Â  Â  Â  stats.daily.pureStudySeconds=parseFloat(stats.daily.pureStudySeconds)||0;
Â  Â  Â  Â  Â  Â  stats.daily.totalTimeSeconds=parseFloat(stats.daily.totalTimeSeconds)||0;
Â  Â  Â  Â  Â  Â  stats.general.totalDaysStudied=parseInt(stats.general.totalDaysStudied)||0;
Â  Â  Â  Â  Â  Â  stats.general.totalCyclesCompleted=parseInt(stats.general.totalCyclesCompleted)||0;
Â  Â  Â  Â  Â  Â  stats.general.totalFocusSessions=parseInt(stats.general.totalFocusSessions)||0;
Â  Â  Â  Â  Â  Â  stats.general.totalPureStudySeconds=parseFloat(stats.general.totalPureStudySeconds)||0;
Â  Â  Â  Â  Â  Â  stats.general.streak=parseInt(stats.general.streak)||0;
Â  Â  Â  Â  Â  Â  stats.general.totalShortBreakSeconds=parseFloat(stats.general.totalShortBreakSeconds)||0;
Â  Â  Â  Â  Â  Â  stats.general.totalLongBreakSeconds=parseFloat(stats.general.totalLongBreakSeconds)||0;
Â  Â  Â  Â  Â  Â  data.timerState.pomodorosInCycle=parseInt(data.timerState.pomodorosInCycle)||0;
Â  Â  Â  Â  Â  Â  data.timerState.timeLeft=parseFloat(data.timerState.timeLeft)||data.settings.studyTime*60;
Â  Â  Â  Â  Â  Â  if (!data.stats.goalHistory) data.stats.goalHistory = [];
Â  Â  Â  Â  Â  Â  if (data.dailyGoal.target === undefined) data.dailyGoal.target = 0;
Â  Â  Â  Â  Â  Â  return data;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function loadData() {
Â  Â  Â  Â  Â  Â  const storedData = localStorage.getItem(STORAGE_KEY);
Â  Â  Â  Â  Â  Â  const defaultData = getDefaultAppData();
Â  Â  Â  Â  Â  Â  if (storedData) {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const parsedData = JSON.parse(storedData);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appData = mergeDeep(defaultData, parsedData);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appData = sanitizeLoadedData(appData);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!appData.dailyGoal.settings) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const oldTarget = appData.dailyGoal.target || 4;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appData.dailyGoal.settings={mode:'all_days',targetAll:oldTarget,targetWeekday:oldTarget,targetWeekend:2,targetsCustom:[2,oldTarget,oldTarget,oldTarget,oldTarget,oldTarget,2]};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lang = appData.settings.language || 'en';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appData.achievements = buildAchievements(lang, parsedData.achievements || []);
Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appData = getDefaultAppData();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appData.achievements = buildAchievements(appData.settings.language);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â appData = defaultData;
Â  Â  Â  Â  Â  Â  Â  Â  Â appData.achievements = buildAchievements(appData.settings.language);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (appData.stats.daily.date !== getTodayDateString()) {
Â  Â  Â  Â  Â  Â  Â  Â  archiveGoalProgress();
Â  Â  Â  Â  Â  Â  Â  Â  resetDailyStats();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  studyTimeInput.value=appData.settings.studyTime;
Â  Â  Â  Â  Â  Â  shortBreakTimeInput.value=appData.settings.shortBreakTime;
Â  Â  Â  Â  Â  Â  longBreakTimeInput.value=appData.settings.longBreakTime;
Â  Â  Â  Â  Â  Â  soundToggle.checked=appData.settings.soundEnabled;
Â  Â  Â  Â  Â  Â  languageSelect.value=appData.settings.language;
Â  Â  Â  Â  Â  Â  updateNotificationBadges();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function saveData() {
Â  Â  Â  Â  Â  Â  const achievementsToSave = appData.achievements.map(ach => ({ id: ach.id, unlocked: ach.unlocked, unlockedDate: ach.unlockedDate, seen: ach.seen }));
Â  Â  Â  Â  Â  Â  const dataToSave = { ...appData, achievements: achievementsToSave };
Â  Â  Â  Â  Â  Â  localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  let toastTimeout;
Â  Â  Â  Â  function showToast(title, body, type = 'info', duration = 4000) {
Â  Â  Â  Â  Â  Â  clearTimeout(toastTimeout);
Â  Â  Â  Â  Â  Â  toastTitleEl.textContent=title;
Â  Â  Â  Â  Â  Â  toastBodyEl.textContent=body;
Â  Â  Â  Â  Â  Â  toastNotificationEl.className='fixed top-5 right-5 p-4 rounded-md text-white z-[1000] transition-all duration-500 max-w-xs shadow-lg';
Â  Â  Â  Â  Â  Â  switch (type) {
Â  Â  Â  Â  Â  Â  Â  Â  case 'success': toastNotificationEl.classList.add('bg-green-500','show'); break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'error': toastNotificationEl.classList.add('bg-red-500','show'); break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'warning': toastNotificationEl.classList.add('bg-yellow-500','show'); break;
Â  Â  Â  Â  Â  Â  Â  Â  default: toastNotificationEl.classList.add('bg-sky-500','show');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  toastTimeout = setTimeout(() => { toastNotificationEl.classList.remove('show'); }, duration);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function updateNotificationBadges() {
Â  Â  Â  Â  Â  Â  const unseenAchievements = appData.achievements.filter(ach => ach.unlocked && !ach.seen).length;
Â  Â  Â  Â  Â  Â  achievementsTabBadgeEl.style.display = unseenAchievements > 0 ? 'inline-block' : 'none';
Â  Â  Â  Â  Â  Â  rewardsTabBadgeEl.style.display = (appData.dailyGoal.completed && !appData.dailyGoal.notificationShown) ? 'inline-block' : 'none';
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  let currentConfirmCallback=null, currentCancelCallback=null;
Â  Â  Â  Â  function showCustomAlert(title, message, iconClass="fas fa-info-circle text-sky-400", confirmText="OK", cancelText=null, confirmCallback=null, cancelCallback=null, isHelp=false) {
Â  Â  Â  Â  Â  Â  customAlertTitleEl.textContent=title;
Â  Â  Â  Â  Â  Â  customAlertMessageEl.innerHTML=message;
Â  Â  Â  Â  Â  Â  customAlertIconEl.className=`text-3xl mr-4 mt-1 ${iconClass}`;
Â  Â  Â  Â  Â  Â  customAlertConfirmButton.textContent=confirmText;
Â  Â  Â  Â  Â  Â  currentConfirmCallback=confirmCallback;
Â  Â  Â  Â  Â  Â  if (isHelp) {
Â  Â  Â  Â  Â  Â  Â  Â  customAlertContentEl.classList.remove('max-w-md'); customAlertContentEl.classList.add('max-w-lg');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  customAlertContentEl.classList.remove('max-w-lg'); customAlertContentEl.classList.add('max-w-md');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (cancelText && typeof cancelCallback === 'function') {
Â  Â  Â  Â  Â  Â  Â  Â  customAlertCancelButton.textContent=cancelText;
Â  Â  Â  Â  Â  Â  Â  Â  customAlertCancelButton.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  currentCancelCallback=cancelCallback;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  customAlertCancelButton.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  currentCancelCallback=null;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  customAlertModal.classList.add('show');
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function updateTimerDisplay() {
Â  Â  Â  Â  Â  Â  timerTextEl.textContent = formatTime(appData.timerState.timeLeft);
Â  Â  Â  Â  Â  Â  let modeKey = '', bodyClass = 'bg-slate-900', timerColorClass = 'text-sky-400', pillClass = 'bg-sky-400/10 text-sky-400';
Â  Â  Â  Â  Â  Â  switch (appData.timerState.currentMode) {
Â  Â  Â  Â  Â  Â  Â  Â  case 'study':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modeKey='mode_study'; bodyClass='bg-slate-900'; timerColorClass='text-sky-400'; pillClass='bg-sky-400/10 text-sky-400'; skipBreakButton.classList.add('hidden'); break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'shortBreak':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modeKey='mode_short_break'; bodyClass='bg-green-900'; timerColorClass='text-green-400'; pillClass='bg-green-400/10 text-green-400'; skipBreakButton.classList.remove('hidden'); break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'longBreak':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modeKey='mode_long_break'; bodyClass='bg-purple-900'; timerColorClass='text-purple-400'; pillClass='bg-purple-400/10 text-purple-400'; skipBreakButton.classList.remove('hidden'); break;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  modePillEl.textContent=getText(modeKey);
Â  Â  Â  Â  Â  Â  modePillEl.className=`py-1 px-3 rounded-full text-sm font-semibold transition-all duration-500 ${pillClass}`;
Â  Â  Â  Â  Â  Â  timerTextEl.className=`timer-text transition-colors duration-500 ${timerColorClass}`;
Â  Â  Â  Â  Â  Â  document.body.className = document.body.className.replace(/bg-(slate|green|purple)-900/g, '') + ` ${bodyClass}`;
Â  Â  Â  Â  Â  Â  document.title = `${formatTime(appData.timerState.timeLeft)} - ${getText(modeKey)}`;
Â  Â  Â  Â  Â  Â  updateCycleInfo();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function updateCycleInfo() {
Â  Â  Â  Â  Â  Â  const dots = cycleDotsContainerEl.children;
Â  Â  Â  Â  Â  Â  const currentMode = appData.timerState.currentMode;
Â  Â  Â  Â  Â  Â  const pomodorosInCycle = appData.timerState.pomodorosInCycle;
Â  Â  Â  Â  Â  Â  for (let i = 0; i < dots.length; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  const dot = dots[i];
Â  Â  Â  Â  Â  Â  Â  Â  dot.className = 'cycle-dot';
Â  Â  Â  Â  Â  Â  Â  Â  let borderColorClass = 'border-sky-400';
Â  Â  Â  Â  Â  Â  Â  Â  if(currentMode === 'shortBreak') borderColorClass = 'border-green-400';
Â  Â  Â  Â  Â  Â  Â  Â  else if(currentMode === 'longBreak') borderColorClass = 'border-purple-400';
Â  Â  Â  Â  Â  Â  Â  Â  if (i < pomodorosInCycle) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dot.classList.add('bg-sky-500');
Â  Â  Â  Â  Â  Â  Â  Â  } else if (i === pomodorosInCycle && currentMode === 'study') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dot.classList.add('bg-transparent', 'border-2', borderColorClass);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dot.classList.add('bg-slate-600');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function updateStatsDisplay() {
Â  Â  Â  Â  Â  Â  dailyFocusSessionsEl.textContent=appData.stats.daily.focusSessions; dailyCyclesEl.textContent=appData.stats.daily.cyclesCompleted; dailyStudyTimeEl.textContent=formatHoursMinutes(appData.stats.daily.pureStudySeconds); dailyTotalTimeEl.textContent=formatHoursMinutes(appData.stats.daily.totalTimeSeconds); totalFocusSessionsEl.textContent=appData.stats.general.totalFocusSessions; totalDaysStudiedEl.textContent=appData.stats.general.totalDaysStudied; totalCyclesEl.textContent=appData.stats.general.totalCyclesCompleted; totalStudyTimeEl.textContent=formatHoursMinutes(appData.stats.general.totalPureStudySeconds);
Â  Â  Â  Â  Â  Â  if (streakCounterHeaderEl) streakCounterHeaderEl.textContent = appData.stats.general.streak;
Â  Â  Â  Â  Â  Â  if (streakFireIconContainerEl) {
Â  Â  Â  Â  Â  Â  Â  Â  const streak = appData.stats.general.streak; let fireColorClass = 'text-slate-400';
Â  Â  Â  Â  Â  Â  Â  Â  if(streak>=50)fireColorClass='text-yellow-400';else if(streak>=40)fireColorClass='text-teal-400';else if(streak>=35)fireColorClass='text-sky-400';else if(streak>=30)fireColorClass='text-blue-500';else if(streak>=25)fireColorClass='text-indigo-500';else if(streak>=20)fireColorClass='text-purple-500';else if(streak>=15)fireColorClass='text-red-600';else if(streak>=10)fireColorClass='text-red-500';else if(streak>=5)fireColorClass='text-red-400';else if(streak>=1)fireColorClass='text-orange-400';
Â  Â  Â  Â  Â  Â  Â  Â  streakFireIconContainerEl.className = ''; streakFireIconContainerEl.classList.add(fireColorClass); streakFireIconContainerEl.innerHTML = '<i class="fas fa-fire"></i>';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function renderAchievements() {
Â  Â  Â  Â  Â  Â  achievementsListEl.innerHTML = "";
Â  Â  Â  Â  Â  Â  appData.achievements.sort((a,b)=>{const c=justSeenAchievementIds.includes(a.id),d=justSeenAchievementIds.includes(b.id);if(c&&!d)return-1;if(!c&&d)return 1;const e=a.unlocked,f=b.unlocked;if(!e&&!f){let c=getAchievementProgress(a.type).current,d=a.threshold>0?c/a.threshold:-1,e=getAchievementProgress(b.type).current,g=b.threshold>0?e/b.threshold:-1;return d>g?-1:d<g?1:a.threshold<b.threshold?-1:a.threshold>b.threshold?1:0}return!e&&f&&!d?-1:e&&!c&&!f?1:e&&!c&&f&&!d?new Date(b.unlockedDate)-new Date(a.unlockedDate):0});
Â  Â  Â  Â  Â  Â  appData.achievements.forEach(ach => {
Â  Â  Â  Â  Â  Â  Â  Â  const isNew = justSeenAchievementIds.includes(ach.id);
Â  Â  Â  Â  Â  Â  Â  Â  const newIndicatorHTML = isNew ? `<span class="ml-1 text-xs font-bold text-yellow-300 animate-pulse new-indicator">${getText('new_badge')}</span>` : '';
Â  Â  Â  Â  Â  Â  Â  Â  const achEl = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  achEl.className = `achievement-item p-3 rounded-lg shadow-md transition-all ${ach.unlocked ? 'unlocked bg-sky-600' : 'locked bg-slate-600'} ${isNew ? 'ring-1 ring-yellow-400 ring-inset' : ''}`;
Â  Â  Â  Â  Â  Â  Â  Â  let mainContentHTML = `<div class="flex items-start mb-1"><i class="${ach.icon||"fas fa-question-circle"} text-xl ${ach.unlocked?'text-yellow-300':'text-slate-400'} mr-2 mt-1"></i><div class="flex-grow overflow-hidden"><div class="flex items-baseline"><h4 class="font-semibold text-sm ${ach.unlocked?'text-white':'text-sky-300'} truncate mr-1">${ach.name}</h4>${newIndicatorHTML}</div><p class="text-xs ${ach.unlocked?'text-sky-100':'text-slate-300'} leading-tight">${ach.description}</p></div></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  let progressSectionHTML = '<div class="mt-auto">';
Â  Â  Â  Â  Â  Â  Â  Â  if (ach.unlocked) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const unlockedDate = new Date(ach.unlockedDate).toLocaleDateString(appData.settings.language.replace('_', '-'));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  progressSectionHTML += `<p class="text-xs text-yellow-200 font-semibold mt-1"><i class="fas fa-check-circle mr-1"></i>${getText('unlocked_on_date', unlockedDate)}</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { current, displayCurrent, displayTarget } = getAchievementProgress(ach.type, ach.threshold);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const progressPercent = ach.threshold > 0 ? Math.min(100, (current / ach.threshold) * 100) : 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  progressSectionHTML += `<div class="progress-bar-container mt-2"><div class="progress-bar bg-sky-400" style="width: ${progressPercent.toFixed(2)}%;"></div></div><p class="text-xs text-slate-400 mt-1">${displayCurrent} / ${displayTarget}</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  progressSectionHTML += '</div>';
Â  Â  Â  Â  Â  Â  Â  Â  achEl.innerHTML = mainContentHTML + progressSectionHTML;
Â  Â  Â  Â  Â  Â  Â  Â  achievementsListEl.appendChild(achEl);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function getAchievementProgress(type, threshold) {
Â  Â  Â  Â  Â  Â  let currentValue=0;
Â  Â  Â  Â  Â  Â  switch(type){case'totalDaysStudied':currentValue=appData.stats.general.totalDaysStudied;break;case'totalCyclesCompleted':currentValue=appData.stats.general.totalCyclesCompleted;break;case'totalPureStudyHours':currentValue=appData.stats.general.totalPureStudySeconds/3600;break;case'totalFocusSessions':currentValue=appData.stats.general.totalFocusSessions;break;case'streak':currentValue=appData.stats.general.streak;break;case'totalShortBreakSeconds':currentValue=appData.stats.general.totalShortBreakSeconds;break;case'totalLongBreakSeconds':currentValue=appData.stats.general.totalLongBreakSeconds;break;case'dailyFocusSessions':currentValue=appData.stats.daily.focusSessions;break;case'dailyCyclesCompleted':currentValue=appData.stats.daily.cyclesCompleted;break;case'dailyPureStudyHours':currentValue=appData.stats.daily.pureStudySeconds/3600;break;}
Â  Â  Â  Â  Â  Â  let displayThreshold=threshold,displayCurrentValue=currentValue;
Â  Â  Â  Â  Â  Â  if(type==='totalShortBreakSeconds'||type==='totalLongBreakSeconds'){if(threshold>=3600){displayCurrentValue=(currentValue/3600).toFixed(1);displayThreshold=(threshold/3600).toFixed(1)+"h";}else{displayCurrentValue=(currentValue/60).toFixed(0);displayThreshold=(threshold/60).toFixed(0)+"m";}}else if(type==='totalPureStudyHours'||type==='dailyPureStudyHours'){displayCurrentValue=currentValue.toFixed(1);displayThreshold=threshold+"h";}else{displayCurrentValue=Math.floor(currentValue);displayThreshold=threshold;}
Â  Â  Â  Â  Â  Â  return {current:currentValue,displayCurrent:displayCurrentValue,displayTarget:displayThreshold};
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function setTimer(mode) {
Â  Â  Â  Â  Â  Â  appData.timerState.currentMode = mode;
Â  Â  Â  Â  Â  Â  appData.timerState.isRunning = false;
Â  Â  Â  Â  Â  Â  startPauseButton.querySelector('span').textContent = getText('start_button');
Â  Â  Â  Â  Â  Â  startPauseButton.querySelector('i').className = 'fas fa-play mr-2';
Â  Â  Â  Â  Â  Â  if (timerWorker) timerWorker.postMessage({ command: 'pause' });
Â  Â  Â  Â  Â  Â  let newTimeLeft;
Â  Â  Â  Â  Â  Â  switch (mode) {
Â  Â  Â  Â  Â  Â  Â  Â  case 'study': newTimeLeft = appData.settings.studyTime * 60; break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'shortBreak': newTimeLeft = appData.settings.shortBreakTime * 60; break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'longBreak': newTimeLeft = appData.settings.longBreakTime * 60; break;
Â  Â  Â  Â  Â  Â  Â  Â  default: newTimeLeft = appData.settings.studyTime * 60, appData.timerState.currentMode = 'study';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  appData.timerState.timeLeft = newTimeLeft;
Â  Â  Â  Â  Â  Â  if (timerWorker) timerWorker.postMessage({ command: 'setMode', mode: appData.timerState.currentMode, duration: appData.timerState.timeLeft });
Â  Â  Â  Â  Â  Â  updateTimerDisplay();
Â  Â  Â  Â  Â  Â  saveData();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function startTimer() {
Â  Â  Â  Â  Â  Â  if (appData.timerState.timeLeft <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  setTimer(appData.timerState.currentMode);
Â  Â  Â  Â  Â  Â  Â  Â  if (appData.timerState.timeLeft <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startPauseButton.querySelector('span').textContent = getText('start_button');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startPauseButton.querySelector('i').className = 'fas fa-play mr-2';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appData.timerState.isRunning = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  appData.timerState.isRunning = true;
Â  Â  Â  Â  Â  Â  currentTimerInitialDuration = appData.timerState.timeLeft;
Â  Â  Â  Â  Â  Â  startPauseButton.querySelector('span').textContent = getText('pause_button');
Â  Â  Â  Â  Â  Â  startPauseButton.querySelector('i').className = 'fas fa-pause mr-2';
Â  Â  Â  Â  Â  Â  if (timerWorker) timerWorker.postMessage({ command: 'start' });
Â  Â  Â  Â  Â  Â  saveData();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function pauseTimer() {
Â  Â  Â  Â  Â  Â  appData.timerState.isRunning = false;
Â  Â  Â  Â  Â  Â  startPauseButton.querySelector('span').textContent = getText('resume_button');
Â  Â  Â  Â  Â  Â  startPauseButton.querySelector('i').className = 'fas fa-play mr-2';
Â  Â  Â  Â  Â  Â  if (timerWorker) timerWorker.postMessage({ command: 'pause' });
Â  Â  Â  Â  Â  Â  saveData();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function handleTimerEnd(completedDurationInSeconds) {
Â  Â  Â  Â  Â  Â  appData.timerState.isRunning = false;
Â  Â  Â  Â  Â  Â  const endedMode = appData.timerState.currentMode;
Â  Â  Â  Â  Â  Â  appData.timerState.lastTimerUsed = endedMode;
Â  Â  Â  Â  Â  Â  let notificationTitleKey="",notificationBodyKey="",soundNoteForEndedMode='C4';
Â  Â  Â  Â  Â  Â  let nextModeToTransitionTo=null,showCycleCompleteNotification=false,shouldAutoStart=true;
Â  Â  Â  Â  Â  Â  appData.stats.daily.totalTimeSeconds+=completedDurationInSeconds;
Â  Â  Â  Â  Â  Â  if (endedMode === 'study') {
Â  Â  Â  Â  Â  Â  Â  Â  appData.stats.daily.focusSessions++; appData.stats.general.totalFocusSessions++;
Â  Â  Â  Â  Â  Â  Â  Â  appData.stats.daily.pureStudySeconds+=completedDurationInSeconds; appData.stats.general.totalPureStudySeconds+=completedDurationInSeconds;
Â  Â  Â  Â  Â  Â  Â  Â  appData.timerState.pomodorosInCycle++;
Â  Â  Â  Â  Â  Â  Â  Â  notificationTitleKey="toast_study_complete_title"; notificationBodyKey="toast_study_complete_body"; soundNoteForEndedMode='C5';
Â  Â  Â  Â  Â  Â  Â  Â  if (!appData.stats.daily.firstStudySessionCompletedToday) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appData.stats.daily.firstStudySessionCompletedToday = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const todayStr = getTodayDateString();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (appData.stats.general.lastStudyDate !== todayStr) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appData.stats.general.totalDaysStudied++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const yesterdayStr = `${yesterday.getFullYear()}-${String(yesterday.getMonth()+1).padStart(2,'0')}-${String(yesterday.getDate()).padStart(2,'0')}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appData.stats.general.streak = appData.stats.general.lastStudyDate === yesterdayStr ? appData.stats.general.streak + 1 : 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appData.stats.general.lastStudyDate = todayStr;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if (appData.timerState.pomodorosInCycle >= POMODOROS_PER_CYCLE) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  nextModeToTransitionTo = 'longBreak';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appData.stats.daily.cyclesCompleted++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appData.stats.general.totalCyclesCompleted++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showCycleCompleteNotification = true;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  nextModeToTransitionTo = 'shortBreak';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else if (endedMode === 'shortBreak') {
Â  Â  Â  Â  Â  Â  Â  Â  appData.stats.general.totalShortBreakSeconds+=completedDurationInSeconds;
Â  Â  Â  Â  Â  Â  Â  Â  notificationTitleKey="toast_break_over_title"; notificationBodyKey="toast_break_over_body"; soundNoteForEndedMode='E4'; nextModeToTransitionTo='study';
Â  Â  Â  Â  Â  Â  } else if (endedMode === 'longBreak') {
Â  Â  Â  Â  Â  Â  Â  Â  appData.stats.general.totalLongBreakSeconds+=completedDurationInSeconds;
Â  Â  Â  Â  Â  Â  Â  Â  notificationTitleKey="toast_long_break_over_title"; notificationBodyKey="toast_long_break_over_body"; soundNoteForEndedMode='E4';
Â  Â  Â  Â  Â  Â  Â  Â  appData.timerState.pomodorosInCycle = 0;
Â  Â  Â  Â  Â  Â  Â  Â  nextModeToTransitionTo = 'study'; shouldAutoStart = false;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  checkGoalProgress();
Â  Â  Â  Â  Â  Â  checkAchievements();
Â  Â  Â  Â  Â  Â  updateStatsDisplay();
Â  Â  Â  Â  Â  Â  saveData();
Â  Â  Â  Â  Â  Â  playSound(soundNoteForEndedMode, '4n', 'timerComplete');
Â  Â  Â  Â  Â  Â  showToast(getText(notificationTitleKey), getText(notificationBodyKey), 'info');
Â  Â  Â  Â  Â  Â  if (showCycleCompleteNotification) {
Â  Â  Â  Â  Â  Â  Â  Â  showToast(getText("toast_cycle_complete_title"), getText("toast_cycle_complete_body"), 'success', 5000);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (nextModeToTransitionTo) {
Â  Â  Â  Â  Â  Â  Â  Â  setTimer(nextModeToTransitionTo);
Â  Â  Â  Â  Â  Â  Â  Â  if (shouldAutoStart) startTimer();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  startPauseButton.querySelector('span').textContent = getText('start_button');
Â  Â  Â  Â  Â  Â  Â  Â  startPauseButton.querySelector('i').className = 'fas fa-play mr-2';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function resetCurrentTimer() {
Â  Â  Â  Â  Â  Â  if(appData.timerState.isRunning && timerWorker) timerWorker.postMessage({command:'pause'});
Â  Â  Â  Â  Â  Â  appData.timerState.isRunning = false;
Â  Â  Â  Â  Â  Â  let newTimeLeft;
Â  Â  Â  Â  Â  Â  switch(appData.timerState.currentMode){case'study':newTimeLeft=appData.settings.studyTime*60;break;case'shortBreak':newTimeLeft=appData.settings.shortBreakTime*60;break;case'longBreak':newTimeLeft=appData.settings.longBreakTime*60;break;default:newTimeLeft=appData.settings.studyTime*60;}
Â  Â  Â  Â  Â  Â  appData.timerState.timeLeft=newTimeLeft;
Â  Â  Â  Â  Â  Â  if(timerWorker)timerWorker.postMessage({command:'setMode',mode:appData.timerState.currentMode,duration:appData.timerState.timeLeft});
Â  Â  Â  Â  Â  Â  startPauseButton.querySelector('span').textContent=getText('start_button');
Â  Â  Â  Â  Â  Â  startPauseButton.querySelector('i').className='fas fa-play mr-2';
Â  Â  Â  Â  Â  Â  updateTimerDisplay();
Â  Â  Â  Â  Â  Â  saveData();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function archiveGoalProgress() {
Â  Â  Â  Â  Â  Â  const history = appData.stats.goalHistory || [];
Â  Â  Â  Â  Â  Â  const sevenDaysAgo = new Date();
Â  Â  Â  Â  Â  Â  sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
Â  Â  Â  Â  Â  Â  const recentHistory = history.filter(entry => new Date(entry.date) >= sevenDaysAgo);
Â  Â  Â  Â  Â  Â  const todayStr = appData.stats.daily.date;
Â  Â  Â  Â  Â  Â  if (appData.dailyGoal.target > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const existingEntryIndex = recentHistory.findIndex(e => e.date === todayStr);
Â  Â  Â  Â  Â  Â  Â  Â  const entry = { date: todayStr, target: appData.dailyGoal.target, progress: appData.dailyGoal.progress, completed: appData.dailyGoal.completed };
Â  Â  Â  Â  Â  Â  Â  Â  if (existingEntryIndex > -1) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recentHistory[existingEntryIndex] = entry;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recentHistory.push(entry);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  appData.stats.goalHistory = recentHistory.slice(-7);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function resetDailyStats() {
Â  Â  Â  Â  Â  Â  appData.stats.daily={date:getTodayDateString(),focusSessions:0,cyclesCompleted:0,pureStudySeconds:0,totalTimeSeconds:0,firstStudySessionCompletedToday:false};
Â  Â  Â  Â  Â  Â  appData.dailyGoal.progress=0;appData.dailyGoal.completed=false;appData.dailyGoal.notificationShown=false;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function setTabStyling(isCollapsed) {
Â  Â  Â  Â  Â  Â  tabButtons.forEach(btn => {
Â  Â  Â  Â  Â  Â  Â  Â  const isActive = btn.dataset.tab === activeTabId;
Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.remove('active', 'text-sky-400', 'text-slate-400');
Â  Â  Â  Â  Â  Â  Â  Â  if (isCollapsed) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.add('text-slate-400');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isActive) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.add('active', 'text-sky-400');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.add('text-slate-400');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function showTab(tabId) {
Â  Â  Â  Â  Â  Â  activeTabId = tabId;
Â  Â  Â  Â  Â  Â  setTabStyling(false);
Â  Â  Â  Â  Â  Â  tabPanes.forEach(pane => {
Â  Â  Â  Â  Â  Â  Â  Â  const isTargetPane = pane.id === `${tabId}Content`;
Â  Â  Â  Â  Â  Â  Â  Â  pane.style.display = isTargetPane ? 'flex' : 'none';
Â  Â  Â  Â  Â  Â  Â  Â  pane.classList.toggle('active', isTargetPane);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  if (tabId === 'achievements') {
Â  Â  Â  Â  Â  Â  Â  Â  justSeenAchievementIds = [];
Â  Â  Â  Â  Â  Â  Â  Â  appData.achievements.forEach(ach => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (ach.unlocked && !ach.seen) justSeenAchievementIds.push(ach.id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (ach.unlocked) ach.seen = true;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  appData.uiState.newAchievementsCount = 0;
Â  Â  Â  Â  Â  Â  Â  Â  updateNotificationBadges();
Â  Â  Â  Â  Â  Â  Â  Â  saveData();
Â  Â  Â  Â  Â  Â  Â  Â  renderAchievements();
Â  Â  Â  Â  Â  Â  } else if (tabId === 'dailyGoal') {
Â  Â  Â  Â  Â  Â  Â  Â  requestAnimationFrame(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderGoalHistoryChart();
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  if (appData.dailyGoal.target <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showGoalEditView(true);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showGoalEditView(false);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function setTodaysGoal() {
Â  Â  Â  Â  Â  Â  const settings = appData.dailyGoal.settings;
Â  Â  Â  Â  Â  Â  const today = new Date().getDay();
Â  Â  Â  Â  Â  Â  let newTarget = 0;
Â  Â  Â  Â  Â  Â  switch(settings.mode){case'weekend':newTarget=(today===0||today===6)?settings.targetWeekend:settings.targetWeekday;break;case'custom':newTarget=settings.targetsCustom[today];break;case'all_days':default:newTarget=settings.targetAll;break;}
Â  Â  Â  Â  Â  Â  appData.dailyGoal.target = newTarget || 0;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function checkGoalProgress() {
Â  Â  Â  Â  Â  Â  const goal = appData.dailyGoal;
Â  Â  Â  Â  Â  Â  if (goal.target <= 0) { renderDailyGoal(); return; }
Â  Â  Â  Â  Â  Â  if(goal.completed) { renderDailyGoal(); if(goalHistoryChart) renderGoalHistoryChart(); return; }
Â  Â  Â  Â  Â  Â  const currentProgress = appData.stats.daily.focusSessions;
Â  Â  Â  Â  Â  Â  goal.progress = currentProgress;
Â  Â  Â  Â  Â  Â  if (currentProgress >= goal.target) {
Â  Â  Â  Â  Â  Â  Â  Â  goal.completed = true;
Â  Â  Â  Â  Â  Â  Â  Â  if (!goal.notificationShown) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(getText('goal_completed_toast_title'), getText('goal_completed_toast_body'), 'success');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playSound('G5', '2n', 'goal');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  renderDailyGoal();
Â  Â  Â  Â  Â  Â  if(goalHistoryChart) renderGoalHistoryChart();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function renderDailyGoal() {
Â  Â  Â  Â  Â  Â  const goal = appData.dailyGoal;
Â  Â  Â  Â  Â  Â  goalProgressContainer.style.display = goal.target > 0 ? 'block' : 'none';
Â  Â  Â  Â  Â  Â  if (goal.target <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  goalTextEl.textContent = getText('no_goal_set');
Â  Â  Â  Â  Â  Â  Â  Â  editGoalButton.querySelector('span').textContent = getText('set_goal_button');
Â  Â  Â  Â  Â  Â  Â  Â  goalProgressBarEl.style.width = '0%';
Â  Â  Â  Â  Â  Â  Â  Â  goalProgressTextEl.textContent = '';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  editGoalButton.querySelector('span').textContent = getText('edit_goal_button');
Â  Â  Â  Â  Â  Â  goalTextEl.textContent = getPluralText('focusSessions', goal.target);
Â  Â  Â  Â  Â  Â  const progressValue = Math.floor(goal.progress);
Â  Â  Â  Â  Â  Â  goalProgressTextEl.textContent = `${progressValue} / ${goal.target}`;
Â  Â  Â  Â  Â  Â  const progressPercent = Math.min(100, (goal.progress / goal.target) * 100);
Â  Â  Â  Â  Â  Â  goalProgressBarEl.style.width = `${progressPercent}%`;
Â  Â  Â  Â  Â  Â  goalProgressBarEl.classList.toggle('completed', goal.completed);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function renderGoalHistoryChart() {
Â  Â  Â  Â  Â  Â  if (goalHistoryChart) {
Â  Â  Â  Â  Â  Â  Â  Â  goalHistoryChart.destroy();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (!goalHistoryChartCanvas) return;
Â  Â  Â  Â  Â  Â  const history = appData.stats.goalHistory || [];
Â  Â  Â  Â  Â  Â  const labels = [];
Â  Â  Â  Â  Â  Â  const progressData = [];
Â  Â  Â  Â  Â  Â  const targetData = [];
Â  Â  Â  Â  Â  Â  let maxVal = 0;
Â  Â  Â  Â  Â  Â  const today = new Date();
Â  Â  Â  Â  Â  Â  const langCode = appData.settings.language.replace('_', '-');

Â  Â  Â  Â  Â  Â  for (let i = 6; i >= 0; i--) {
Â  Â  Â  Â  Â  Â  Â  Â  const date = new Date(today);
Â  Â  Â  Â  Â  Â  Â  Â  date.setDate(today.getDate() - i);
Â  Â  Â  Â  Â  Â  Â  Â  const dateStr = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const dayOfWeek = date.toLocaleDateString(langCode, { weekday: 'short' });
Â  Â  Â  Â  Â  Â  Â  Â  const dayMonth = `${String(date.getDate()).padStart(2,'0')}/${String(date.getMonth()+1).padStart(2,'0')}`;
Â  Â  Â  Â  Â  Â  Â  Â  labels.push([dayOfWeek, dayMonth]);

Â  Â  Â  Â  Â  Â  Â  Â  const entry = history.find(e => e.date === dateStr);
Â  Â  Â  Â  Â  Â  Â  Â  let currentDayTarget = 0;

Â  Â  Â  Â  Â  Â  Â  Â  if (i === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  progressData.push(appData.dailyGoal.progress);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentDayTarget = appData.dailyGoal.target;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  targetData.push(currentDayTarget);
Â  Â  Â  Â  Â  Â  Â  Â  } else if (entry) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  progressData.push(entry.progress);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentDayTarget = entry.target;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  targetData.push(currentDayTarget);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  progressData.push(0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  targetData.push(0);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  maxVal = Math.max(maxVal, progressData[progressData.length - 1], currentDayTarget);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const suggestedMax = Math.max(4, Math.ceil(maxVal) + 1);
Â  Â  Â  Â  Â  Â  const ctx = goalHistoryChartCanvas.getContext('2d');
Â  Â  Â  Â  Â  Â  goalHistoryChart = new Chart(ctx, {
Â  Â  Â  Â  Â  Â  Â  Â  type: 'bar',
Â  Â  Â  Â  Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: labels,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datasets: [{
Â  Â  Â  Â  _200c_ Â  Â  Â  Â  Â  Â  Â  Â  label: getText('progress_label'), data: progressData,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: (context) => context.index === 6 ? 'rgba(56, 189, 248, 1)' : 'rgba(56, 189, 248, 0.6)',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: 'rgba(56, 189, 248, 1)', borderWidth: 1, borderRadius: 2,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label: getText('chart_target_label'), data: targetData, type: 'line',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: 'rgba(239, 68, 68, 0.7)', backgroundColor: 'transparent',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pointBackgroundColor: 'rgba(239, 68, 68, 1)', borderDash: [5, 5], fill: false
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }]
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  options: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  responsive: true, maintainAspectRatio: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scales: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  y: { beginAtZero: true, max: suggestedMax, ticks: { color: '#94a3b8', stepSize: 1, precision: 0 }, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  x: { ticks: { color: (context) => context.index === 6 ? '#38bdf8' : '#94a3b8' }, grid: { display: false } }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  plugins: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  legend: { display: true, position: 'top', align: 'end', labels: { color: '#cbd5e1', boxWidth: 12, padding: 20, font: { size: 10 } } },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tooltip: { callbacks: { label: function(context) { let label = context.dataset.label || ''; if (label) { label += ': '; } if (context.parsed.y !== null) { label += Math.floor(context.parsed.y); } return label; } } }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function showGoalEditView(show) {
Â  Â  Â  Â  Â  Â  if (show) {
Â  Â  Â  Â  Â  Â  Â  Â  goalDisplayView.classList.add('hidden'); goalEditView.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  const settings = appData.dailyGoal.settings;
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector(`input[name="goalMode"][value="${settings.mode}"]`).checked = true;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('goalValueInputAll').value=settings.targetAll;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('goalValueInputWeekday').value=settings.targetWeekday;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('goalValueInputWeekend').value=settings.targetWeekend;
Â  Â  Â  Â  Â  Â  Â  Â  const customContainer=document.querySelector('#goalInputsCustom .custom-day-grid');
Â  Â  Â  Â  Â  Â  Â  Â  customContainer.innerHTML='';
Â  Â  Â  Â  Â  Â  Â  Â  const dayNames=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
Â  Â  Â  Â  Â  Â  Â  Â  settings.targetsCustom.forEach((val,i)=>{const dayName=dayNames[i];const inputHtml=`<div class="custom-day-input-group"><label for="goalDay${i}" class="block">${dayName}</label><input type="number" id="goalDay${i}" data-day-index="${i}" min="0" value="${val}" class="w-full p-2 rounded bg-slate-600 text-white border border-slate-500 text-center focus:ring-sky-500 focus:border-sky-500"></div>`;customContainer.insertAdjacentHTML('beforeend',inputHtml);});
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('input[name="goalMode"]').forEach(radio=>radio.dispatchEvent(new Event('change')));
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  goalDisplayView.classList.remove('hidden'); goalEditView.classList.add('hidden');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function checkAchievements(){const e=[];appData.achievements.forEach(t=>{if(!t.unlocked){const a=getAchievementProgress(t.type,t.threshold);a.current>=t.threshold&&(t.unlocked=!0,t.unlockedDate=(new Date).toISOString(),t.seen=!1,e.push(t))}});if(e.length>0){e.forEach((e,t)=>{setTimeout(()=>{const a=getText(`achievements.${e.id}.name`);showToast(getText("toast_achievement_unlocked_title"),getText("toast_achievement_unlocked_body",a),"success",5e3),playSound("C5","4n","achievement")},600*t)}),appData.uiState.newAchievementsCount+=e.length,updateNotificationBadges(),"achievements"===activeTabId&&renderAchievements()}}
Â  Â  Â  Â Â 
Â  Â  Â  Â  let timerWorker;
Â  Â  Â  Â  if (window.Worker) {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const workerScript = document.getElementById('timerWorkerScript').textContent;
Â  Â  Â  Â  Â  Â  Â  Â  const blob = new Blob([workerScript], { type: 'application/javascript' });
Â  Â  Â  Â  Â  Â  Â  Â  timerWorker = new Worker(URL.createObjectURL(blob));
Â  Â  Â  Â  Â  Â  Â  Â  timerWorker.onmessage = function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { type, timeLeft: workerTimeLeftUpdate, mode: workerMode } = e.data;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(type==='tick'){appData.timerState.timeLeft=workerTimeLeftUpdate;if(appData.timerState.currentMode===workerMode)updateTimerDisplay();}else if(type==='end'){if(appData.timerState.currentMode===workerMode)handleTimerEnd(currentTimerInitialDuration);}else if(type==='modeSet'){appData.timerState.timeLeft=workerTimeLeftUpdate;updateTimerDisplay();}
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  timerWorker.onerror = function(error) { timerWorker = null; };
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  timerWorker = null;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function startMidnightChecker() {
Â  Â  Â  Â  Â  Â  setInterval(() => {
Â  Â  Â  Â  Â  Â  Â  Â  const todayString = getTodayDateString();
Â  Â  Â  Â  Â  Â  Â  Â  if (appData.stats.daily.date !== todayString) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(getText("toast_new_day_title"), getText("toast_new_day_body"), "info");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  archiveGoalProgress(); resetDailyStats(); setTodaysGoal(); saveData(); updateStatsDisplay(); renderAllDynamicContent();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }, 60000);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function renderAllDynamicContent() {
Â  Â  Â  Â  Â  Â  Â updateTimerDisplay(); updateStatsDisplay(); renderDailyGoal(); renderAchievements();
Â  Â  Â  Â  Â  Â  Â if (document.getElementById('dailyGoalContent').classList.contains('active')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â renderGoalHistoryChart();
Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function initializeApp() {
Â  Â  Â  Â  Â  Â  appContainer.style.display = 'block';
Â  Â  Â  Â  Â  Â  appContainer.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  loadData();
Â  Â  Â  Â  Â  Â  setTodaysGoal();
Â  Â  Â  Â  Â  Â  checkGoalProgress();
Â  Â  Â  Â  Â  Â  const todayStrInitialize = getTodayDateString();
Â  Â  Â  Â  Â  Â  if (appData.stats.general.lastStudyDate && appData.stats.general.lastStudyDate !== todayStrInitialize) {
Â  Â  Â  Â  Â  Â  Â  Â  const lastStudy=new Date(appData.stats.general.lastStudyDate), today=new Date(todayStrInitialize), yesterday=new Date(today);
Â  Â  Â  Â  Â  Â  Â  Â  yesterday.setDate(today.getDate() - 1);
Â  Â  Â  Â  Â  Â  Â  Â  lastStudy.setHours(0,0,0,0); yesterday.setHours(0,0,0,0);
Â  Â  Â  Â  Â  _200c_ Â  Â  if (lastStudy.getTime() < yesterday.getTime()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appData.stats.general.streak = 0;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const persistedState = { ...appData.timerState };
Â  Â  Â  Â  Â  Â  appData.timerState.currentMode = persistedState.currentMode || 'study';
Â  Â  Â  Â  Â  Â  appData.timerState.timeLeft = persistedState.timeLeft;
Â  Â  Â  Â  Â  Â  appData.timerState.pomodorosInCycle = persistedState.pomodorosInCycle || 0;
Â  Â  Â  Â  Â  Â  const wasRunning = persistedState.isRunning || false;
Â  Â  Â  Â  Â  Â  appData.timerState.isRunning = false;
Â  Â  Â  Â  Â  Â  if (timerWorker) {
Â  Â  Â  Â  Â  Â  Â  Â  timerWorker.postMessage({ command: 'updateSettings', settings: appData.settings });
Â  Â  Â  Â  Â  Â  Â  Â  timerWorker.postMessage({ command: 'setMode', mode: appData.timerState.currentMode, duration: appData.timerState.timeLeft });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  applyTranslations();
Â  Â  Â  Â  Â  Â  if (wasRunning && appData.timerState.timeLeft > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  appData.timerState.isRunning = true;
Â  Â  Â  Â  Â  Â  Â  Â  startPauseButton.querySelector('span').textContent = getText('pause_button');
Â  Â  Â  Â  Â  Â  Â  Â  startPauseButton.querySelector('i').className = 'fas fa-pause mr-2';
Â  Â  Â  Â  Â  Â  Â  Â  if (timerWorker) timerWorker.postMessage({ command: 'start' });
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  startPauseButton.querySelector('span').textContent = getText('start_button');
Â  Â  Â  Â  Â  Â  Â  Â  startPauseButton.querySelector('i').className = 'fas fa-play mr-2';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (appData.uiState.tabsCollapsed) {
Â  Â  Â  Â  Â  Â  Â  Â  tabContentEl.classList.add('collapsed');
Â  Â  Â  Â  Â  Â  Â  Â  collapseIcon.className = 'fas fa-chevron-down';
Â  Â  Â  Â  Â  Â  Â  Â  setTabStyling(true);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  collapseIcon.className = 'fas fa-chevron-up';
Â  Â  Â  Â  Â  Â  Â  Â  setTabStyling(false);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  renderAllDynamicContent();
Â  Â  Â  Â  Â  Â  updateNotificationBadges();
Â  Â  Â  Â  Â  Â  startMidnightChecker();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function setupLanguageChoices() {
Â  Â  Â  Â  Â  Â  const languageDisplayNames = { 'en': 'English', 'pt-BR': 'PortuguÃªs', 'es': 'EspaÃ±ol', 'fr': 'FranÃ§ais', 'de': 'Deutsch', 'ja': 'æ—¥æœ¬èª', 'ru': 'Ğ ÑƒÑÑĞºĞ¸Ğ¹', 'zh-CN': 'ä¸­æ–‡', 'hi-IN': 'à¤¹à¤¿à¤¨à¥à¤¦à¥€' };
Â  Â  Â  Â  Â  Â  Object.entries(languageDisplayNames).forEach(([code, name]) => {
Â  Â  Â  Â  Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  Â  Â  Â  Â  option.value = code; option.textContent = name;
Â  Â  Â  Â  Â  Â  Â  Â  languageSelect.appendChild(option);
Â  Â  Â  Â  Â  Â  Â  Â  const button = document.createElement('button');
Â  Â  Â  Â  Â  Â  Â  Â  button.textContent = name; button.dataset.lang = code;
Â  Â  Â  Â  Â  Â  Â  Â  button.className = "w-full px-4 py-3 bg-slate-700 hover:bg-sky-500 rounded-lg transition-colors font-semibold text-sm";
Â  Â  Â  Â  Â  Â  Â  Â  languageButtonsContainer.appendChild(button);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  for (const lang in translations) {
Â  Â  Â  Â  Â  Â  Â  Â  if (translations.hasOwnProperty(lang) && lang !== 'en') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (const key in translations.en) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!translations[lang][key]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  translations[lang][key] = translations.en[key];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function handleFirstVisit() {
Â  Â  Â  Â  Â  Â  languageModal.classList.add('show');
Â  Â  Â  Â  Â  Â  languageButtonsContainer.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (e.target.tagName === 'BUTTON' && e.target.dataset.lang) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const selectedLang = e.target.dataset.lang;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appData.settings.language = selectedLang;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveData();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  languageModal.classList.remove('show');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  initializeApp();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  window.addEventListener('beforeunload', () => {
Â  Â  Â  Â  Â  Â  if (!blockUnloadSave) {
Â  Â  Â  Â  Â  Â  Â  Â  archiveGoalProgress();
Â  Â  Â  Â  Â  Â  Â  Â  saveData();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  setupLanguageChoices();
Â  Â  Â  Â  Â  Â  if (!localStorage.getItem(STORAGE_KEY)) {
Â  Â  Â  Â  Â  Â  Â  Â  handleFirstVisit();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  initializeApp();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  startPauseButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  if (Tone.context.state !== 'running') { try { Tone.start(); } catch (e) {} }
Â  Â  Â  Â  Â  Â  Â  Â  if (appData.timerState.isRunning) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pauseTimer();
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startTimer();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  resetButton.addEventListener('click', resetCurrentTimer);
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  resetCycleCountButtonEl.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  showCustomAlert(getText('alert_reset_cycle_title'), getText('alert_reset_cycle_body'), 'fas fa-sync-alt text-sky-400', getText('confirm_button'), getText('cancel_button'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appData.timerState.pomodorosInCycle = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(appData.timerState.currentMode !== 'study') { setTimer('study'); }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateCycleInfo();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveData();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  skipBreakButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  if (appData.timerState.currentMode === 'shortBreak' || appData.timerState.currentMode === 'longBreak') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleTimerEnd(0);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  settingsButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  studyTimeInput.value=appData.settings.studyTime; shortBreakTimeInput.value=appData.settings.shortBreakTime; longBreakTimeInput.value=appData.settings.longBreakTime;
Â  Â  Â  Â  Â  Â  Â  Â  soundToggle.checked=appData.settings.soundEnabled; languageSelect.value=appData.settings.language;
Â  Â  Â  Â  Â  Â  Â  Â  settingsModal.classList.add('show');
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  helpButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  showCustomAlert(getText('alert_help_title'), getText('alert_help_body'), 'fas fa-question-circle text-sky-400', getText('got_it_button'), null, null, null, true);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  cancelSettingsButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  settingsModal.classList.remove('show');
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  saveSettingsButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  const newStudyTime = parseInt(studyTimeInput.value);
Â  Â  Â  Â  Â  Â  Â  Â  const newShortBreakTime = parseInt(shortBreakTimeInput.value);
Â  Â  Â  Â  Â  Â  Â  Â  const newLongBreakTime = parseInt(longBreakTimeInput.value);
Â  Â  Â  Â  Â  Â  Â  Â  const newLang = languageSelect.value;
Â  Â  Â  Â  Â  Â  Â  Â  const soundEnabled = soundToggle.checked;
Â  Â  Â  Â  Â  Â  Â  Â  const oldLang = appData.settings.language;
Â  Â  Â  Â  Â  Â  Â  Â  if (newStudyTime>0)appData.settings.studyTime=newStudyTime;
Â  Â  Â  Â  Â  Â  Â  Â  if (newShortBreakTime>0)appData.settings.shortBreakTime=newShortBreakTime;
Â  Â  Â  Â  Â  Â  Â  Â  if (newLongBreakTime>0)appData.settings.longBreakTime=newLongBreakTime;
Â  Â  Â  Â  Â  Â  Â  Â  appData.settings.language = newLang;
Â  Â  Â  Â  Â  Â  Â  Â  appData.settings.soundEnabled = soundEnabled;
Â  Â  Â  Â  Â  Â  Â  Â  if (newLang !== oldLang) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appData.achievements = buildAchievements(newLang, appData.achievements);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  applyTranslations();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderAllDynamicContent();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if (timerWorker) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timerWorker.postMessage({ command: 'updateSettings', settings: appData.settings });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if (!appData.timerState.isRunning) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resetCurrentTimer();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  saveData();
Â  Â  Â  Â  Â  Â  Â  Â  settingsModal.classList.remove('show');
Â  Â  Â  Â  Â  Â  Â  Â  showToast(getText('toast_settings_saved_title'), getText('toast_settings_saved_body'), 'success');
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  tabButtons.forEach(button => {
Â  Â  Â  Â  Â  Â  Â  Â  button.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const targetTab = button.dataset.tab;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (tabContentEl.classList.contains('collapsed')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tabContentEl.classList.remove('collapsed');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appData.uiState.tabsCollapsed = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  collapseIcon.className = 'fas fa-chevron-up';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (activeTabId !== targetTab) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showTab(targetTab);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  collapseTabsButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  const isCollapsed = tabContentEl.classList.contains('collapsed');
Â  Â  Â  Â  Â  Â  Â  Â  appData.uiState.tabsCollapsed = !isCollapsed;
Â  Â  Â  Â  Â  Â  Â  Â  if (isCollapsed) {
Â  Â  Â  Â  Â  _200c_ Â  Â  Â  Â  tabContentEl.classList.remove('collapsed');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  collapseIcon.className = 'fas fa-chevron-up';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTabStyling(false);Â 
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tabContentEl.classList.add('collapsed');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  collapseIcon.className = 'fas fa-chevron-down';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTabStyling(true);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  saveData();
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  editGoalButton.addEventListener('click', () => showGoalEditView(true));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  cancelGoalButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  if(appData.dailyGoal.target > 0 || Object.values(appData.dailyGoal.settings).some(v => Array.isArray(v) ? v.some(n => n > 0) : v > 0)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showGoalEditView(false);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  saveGoalButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  const settings = appData.dailyGoal.settings;
Â  Â  Â  Â  Â  Â  Â  Â  settings.mode = document.querySelector('input[name="goalMode"]:checked').value;
Â  Â  Â  Â  Â  Â  Â  Â  settings.targetAll = parseInt(document.getElementById('goalValueInputAll').value) || 0;
Â  Â  Â  Â  Â  Â  Â  Â  settings.targetWeekday = parseInt(document.getElementById('goalValueInputWeekday').value) || 0;
Â  Â  Â  Â  Â  Â  Â  Â  settings.targetWeekend = parseInt(document.getElementById('goalValueInputWeekend').value) || 0;
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('#goalInputsCustom input').forEach(input => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dayIndex = parseInt(input.dataset.dayIndex);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  settings.targetsCustom[dayIndex] = parseInt(input.value) || 0;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const studyTime = appData.settings.studyTime;
Â  Â  Â  Â  Â  Â  Â  Â  const maxMinutes = 24 * 60;
Â  Â  Â  Â  Â  Â  Â  Â  const allTargets = [settings.targetAll, settings.targetWeekday, settings.targetWeekend, ...settings.targetsCustom];
Â  Â  Â  Â  Â  Â  Â  Â  if (allTargets.some(target => (target * studyTime) > maxMinutes)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(getText('toast_goal_too_long_title'), getText('toast_goal_too_long_body'), 'error', 5000);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  setTodaysGoal();
Â  Â  Â  Â  Â  Â  Â  Â  checkGoalProgress();
Â  Â  Â  Â  Â  Â  Â  Â  saveData();
Â  Â  Â  Â  Â  Â  Â  Â  showGoalEditView(false);
Â  Â  Â  Â  Â  Â  Â  Â  showToast(getText("toast_settings_saved_title"), getText("toast_goal_saved_body"), "success");
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  importDataButton.addEventListener('click', () => { importFileInput.click(); });

Â  Â  Â  Â  Â  Â  importFileInput.addEventListener('change', (event) => {
Â  Â  Â  Â  Â  Â  Â  Â  const file = event.target.files[0];
Â  Â  Â  Â  Â  Â  Â  Â  if (!file) { event.target.value = ''; return; }
Â  Â  Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  Â  Â  reader.onload = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const importedFileContent = e.target.result;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let importedData = JSON.parse(importedFileContent);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!importedData.settings || !importedData.stats || !importedData.achievements) { throw new Error("Invalid backup file structure."); }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (importedData.stats?.general?.totalCyclesCompleted > 0 && (!importedData.stats?.general?.totalFocusSessions || importedData.stats.general.totalFocusSessions === 0)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  importedData.stats.general.totalFocusSessions = importedData.stats.general.totalCyclesCompleted * 4;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const finalImportedContent = JSON.stringify(importedData);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showCustomAlert(getText("alert_import_title"), getText("alert_import_body"), "fas fa-exclamation-triangle text-yellow-400", getText("confirm_button"), getText("cancel_button"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  () => { localStorage.setItem(STORAGE_KEY, finalImportedContent); blockUnloadSave = true; settingsModal.classList.remove('show'); location.reload(); },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  () => { event.target.value = ''; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(getText('toast_import_error_title'), getText('toast_import_error_body'), 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  event.target.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  reader.onerror = () => { showToast(getText('toast_import_error_title'), 'Could not read the selected file.', 'error'); event.target.value = ''; };
Â  Â  Â  Â  Â  Â  Â  Â  reader.readAsText(file);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  customAlertConfirmButton.addEventListener('click', () => { if (typeof currentConfirmCallback === 'function') currentConfirmCallback(); customAlertModal.classList.remove('show'); currentConfirmCallback = null; currentCancelCallback = null; });
Â  Â  Â  Â  Â  Â  customAlertCancelButton.addEventListener('click', () => { if (typeof currentCancelCallback === 'function') currentCancelCallback(); customAlertModal.classList.remove('show'); currentConfirmCallback = null; currentCancelCallback = null; });

Â  Â  Â  Â  Â  Â  document.querySelectorAll('input[name="goalMode"]').forEach(radio => {
Â  Â  Â  Â  Â  Â  Â  Â  radio.addEventListener('change', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('goalInputsAllDays').classList.toggle('hidden', e.target.value !== 'all_days');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('goalInputsWeekend').classList.toggle('hidden', e.target.value !== 'weekend');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('goalInputsCustom').classList.toggle('hidden', e.target.value !== 'custom');
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
